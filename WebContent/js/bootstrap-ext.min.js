function collapsibleFieldsets(a){$(function(){$("fieldset."+a+" legend").append(' (<span style="font-family: monospace;">+</span>)');$("fieldset."+a+" legend").click(function(){var b=$(this).siblings();b.toggle();$(this).find("span").text(function(){return(b.is(":visible"))?"-":"+"})})})}!function(d){function f(){return new Date(Date.UTC.apply(Date,arguments))}function b(){var g=new Date();return f(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate())}var a=function(h,g){var i=this;this.element=d(h);this.language=g.language||this.element.data("date-language")||"en";this.language=this.language in e?this.language:"en";this.isRTL=e[this.language].rtl||false;this.format=c.parseFormat(g.format||this.element.data("date-format")||"mm/dd/yyyy");this.isInline=false;this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):false;this.hasInput=this.component&&this.element.find("input").length;if(this.component&&this.component.length===0){this.component=false}this._attachEvents();this.forceParse=true;if("forceParse" in g){this.forceParse=g.forceParse}else{if("dateForceParse" in this.element.data()){this.forceParse=this.element.data("date-force-parse")}}this.picker=d(c.template).appendTo(this.isInline?this.element:"body").on({click:d.proxy(this.click,this),mousedown:d.proxy(this.mousedown,this)});if(this.isInline){this.picker.addClass("datepicker-inline")}else{this.picker.addClass("datepicker-dropdown dropdown-menu")}if(this.isRTL){this.picker.addClass("datepicker-rtl");this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")}d(document).on("mousedown",function(j){if(d(j.target).closest(".datepicker").length===0){i.hide()}});this.autoclose=false;if("autoclose" in g){this.autoclose=g.autoclose}else{if("dateAutoclose" in this.element.data()){this.autoclose=this.element.data("date-autoclose")}}this.keyboardNavigation=true;if("keyboardNavigation" in g){this.keyboardNavigation=g.keyboardNavigation}else{if("dateKeyboardNavigation" in this.element.data()){this.keyboardNavigation=this.element.data("date-keyboard-navigation")}}this.viewMode=this.startViewMode=0;switch(g.startView||this.element.data("date-start-view")){case 2:case"decade":this.viewMode=this.startViewMode=2;break;case 1:case"year":this.viewMode=this.startViewMode=1;break}this.todayBtn=(g.todayBtn||this.element.data("date-today-btn")||false);this.todayHighlight=(g.todayHighlight||this.element.data("date-today-highlight")||false);this.weekStart=((g.weekStart||this.element.data("date-weekstart")||e[this.language].weekStart||0)%7);this.weekEnd=((this.weekStart+6)%7);this.startDate=-Infinity;this.endDate=Infinity;this.daysOfWeekDisabled=[];this.setStartDate(g.startDate||this.element.data("date-startdate"));this.setEndDate(g.endDate||this.element.data("date-enddate"));this.setDaysOfWeekDisabled(g.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled"));this.fillDow();this.fillMonths();this.update();this.showMode();if(this.isInline){this.show()}};a.prototype={constructor:a,_events:[],_attachEvents:function(){this._detachEvents();if(this.isInput){this._events=[[this.element,{focus:d.proxy(this.show,this),keyup:d.proxy(this.update,this),keydown:d.proxy(this.keydown,this)}]]}else{if(this.component&&this.hasInput){this._events=[[this.element.find("input"),{focus:d.proxy(this.show,this),keyup:d.proxy(this.update,this),keydown:d.proxy(this.keydown,this)}],[this.component,{click:d.proxy(this.show,this)}]]}else{if(this.element.is("div")){this.isInline=true}else{this._events=[[this.element,{click:d.proxy(this.show,this)}]]}}}for(var g=0,h,j;g<this._events.length;g++){h=this._events[g][0];j=this._events[g][1];h.on(j)}},_detachEvents:function(){for(var g=0,h,j;g<this._events.length;g++){h=this._events[g][0];j=this._events[g][1];h.off(j)}this._events=[]},show:function(g){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.update();this.place();d(window).on("resize",d.proxy(this.place,this));if(g){g.stopPropagation();g.preventDefault()}this.element.trigger({type:"show",date:this.date})},hide:function(g){if(this.isInline){return}this.picker.hide();d(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){d(document).off("mousedown",this.hide)}if(this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())){this.setValue()}this.element.trigger({type:"hide",date:this.date})},remove:function(){this._detachEvents();this.picker.remove();delete this.element.data().datepicker},getDate:function(){var g=this.getUTCDate();return new Date(g.getTime()+(g.getTimezoneOffset()*60000))},getUTCDate:function(){return this.date},setDate:function(g){this.setUTCDate(new Date(g.getTime()-(g.getTimezoneOffset()*60000)))},setUTCDate:function(g){this.date=g;this.setValue()},setValue:function(){var g=this.getFormattedDate();if(!this.isInput){if(this.component){this.element.find("input").prop("value",g)}this.element.data("date",g)}else{this.element.prop("value",g)}},getFormattedDate:function(g){if(g==undefined){g=this.format}return c.formatDate(this.date,g,this.language)},setStartDate:function(g){this.startDate=g||-Infinity;if(this.startDate!==-Infinity){this.startDate=c.parseDate(this.startDate,this.format,this.language)}this.update();this.updateNavArrows()},setEndDate:function(g){this.endDate=g||Infinity;if(this.endDate!==Infinity){this.endDate=c.parseDate(this.endDate,this.format,this.language)}this.update();this.updateNavArrows()},setDaysOfWeekDisabled:function(g){this.daysOfWeekDisabled=g||[];if(!d.isArray(this.daysOfWeekDisabled)){this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)}this.daysOfWeekDisabled=d.map(this.daysOfWeekDisabled,function(h){return parseInt(h,10)});this.update();this.updateNavArrows()},place:function(){if(this.isInline){return}var h=parseInt(this.element.parents().filter(function(){return d(this).css("z-index")!="auto"}).first().css("z-index"))+10;var g=this.component?this.component.offset():this.element.offset();this.picker.css({top:g.top+this.height,left:g.left,zIndex:h})},update:function(){var h,i=false;if(arguments&&arguments.length&&(typeof arguments[0]==="string"||arguments[0] instanceof Date)){h=arguments[0];i=true}else{h=this.isInput?this.element.prop("value"):this.element.data("date")||this.element.find("input").prop("value")}this.date=c.parseDate(h,this.format,this.language);if(i){this.setValue()}var g=this.viewDate;if(this.date<this.startDate){this.viewDate=new Date(this.startDate)}else{if(this.date>this.endDate){this.viewDate=new Date(this.endDate)}else{this.viewDate=new Date(this.date)}}if(g&&g.getTime()!=this.viewDate.getTime()){this.element.trigger({type:"changeDate",date:this.viewDate})}this.fill()},fillDow:function(){var g=this.weekStart,h="<tr>";while(g<this.weekStart+7){h+='<th class="dow">'+e[this.language].daysMin[(g++)%7]+"</th>"}h+="</tr>";this.picker.find(".datepicker-days thead").append(h)},fillMonths:function(){var h="",g=0;while(g<12){h+='<span class="month">'+e[this.language].monthsShort[g++]+"</span>"}this.picker.find(".datepicker-months td").html(h)},fill:function(){var u=new Date(this.viewDate),m=u.getUTCFullYear(),v=u.getUTCMonth(),o=this.startDate!==-Infinity?this.startDate.getUTCFullYear():-Infinity,s=this.startDate!==-Infinity?this.startDate.getUTCMonth():-Infinity,j=this.endDate!==Infinity?this.endDate.getUTCFullYear():Infinity,p=this.endDate!==Infinity?this.endDate.getUTCMonth():Infinity,k=this.date&&this.date.valueOf(),t=new Date();this.picker.find(".datepicker-days thead th:eq(1)").text(e[this.language].months[v]+" "+m);this.picker.find("tfoot th.today").text(e[this.language].today).toggle(this.todayBtn!==false);this.updateNavArrows();this.fillMonths();var x=f(m,v-1,28,0,0,0,0),r=c.getDaysInMonth(x.getUTCFullYear(),x.getUTCMonth());x.setUTCDate(r);x.setUTCDate(r-(x.getUTCDay()-this.weekStart+7)%7);var g=new Date(x);g.setUTCDate(g.getUTCDate()+42);g=g.valueOf();var l=[];var n;while(x.valueOf()<g){if(x.getUTCDay()==this.weekStart){l.push("<tr>")}n="";if(x.getUTCFullYear()<m||(x.getUTCFullYear()==m&&x.getUTCMonth()<v)){n+=" old"}else{if(x.getUTCFullYear()>m||(x.getUTCFullYear()==m&&x.getUTCMonth()>v)){n+=" new"}}if(this.todayHighlight&&x.getUTCFullYear()==t.getFullYear()&&x.getUTCMonth()==t.getMonth()&&x.getUTCDate()==t.getDate()){n+=" today"}if(k&&x.valueOf()==k){n+=" active"}if(x.valueOf()<this.startDate||x.valueOf()>this.endDate||d.inArray(x.getUTCDay(),this.daysOfWeekDisabled)!==-1){n+=" disabled"}l.push('<td class="day'+n+'">'+x.getUTCDate()+"</td>");if(x.getUTCDay()==this.weekEnd){l.push("</tr>")}x.setUTCDate(x.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(l.join(""));var y=this.date&&this.date.getUTCFullYear();var h=this.picker.find(".datepicker-months").find("th:eq(1)").text(m).end().find("span").removeClass("active");if(y&&y==m){h.eq(this.date.getUTCMonth()).addClass("active")}if(m<o||m>j){h.addClass("disabled")}if(m==o){h.slice(0,s).addClass("disabled")}if(m==j){h.slice(p+1).addClass("disabled")}l="";m=parseInt(m/10,10)*10;var w=this.picker.find(".datepicker-years").find("th:eq(1)").text(m+"-"+(m+9)).end().find("td");m-=1;for(var q=-1;q<11;q++){l+='<span class="year'+(q==-1||q==10?" old":"")+(y==m?" active":"")+(m<o||m>j?" disabled":"")+'">'+m+"</span>";m+=1}w.html(l)},updateNavArrows:function(){var i=new Date(this.viewDate),g=i.getUTCFullYear(),h=i.getUTCMonth();switch(this.viewMode){case 0:if(this.startDate!==-Infinity&&g<=this.startDate.getUTCFullYear()&&h<=this.startDate.getUTCMonth()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.endDate!==Infinity&&g>=this.endDate.getUTCFullYear()&&h>=this.endDate.getUTCMonth()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break;case 1:case 2:if(this.startDate!==-Infinity&&g<=this.startDate.getUTCFullYear()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.endDate!==Infinity&&g>=this.endDate.getUTCFullYear()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break}},click:function(m){m.stopPropagation();m.preventDefault();var l=d(m.target).closest("span, td, th");if(l.length==1){switch(l[0].nodeName.toLowerCase()){case"th":switch(l[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var i=c.modes[this.viewMode].navStep*(l[0].className=="prev"?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,i);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,i);break}this.fill();break;case"today":var h=new Date();h=f(h.getFullYear(),h.getMonth(),h.getDate(),0,0,0);this.showMode(-2);var n=this.todayBtn=="linked"?null:"view";this._setDate(h,n);break}break;case"span":if(!l.is(".disabled")){this.viewDate.setUTCDate(1);if(l.is(".month")){var k=l.parent().find("span").index(l);this.viewDate.setUTCMonth(k);this.element.trigger({type:"changeMonth",date:this.viewDate})}else{var j=parseInt(l.text(),10)||0;this.viewDate.setUTCFullYear(j);this.element.trigger({type:"changeYear",date:this.viewDate})}this.showMode(-1);this.fill()}break;case"td":if(l.is(".day")&&!l.is(".disabled")){var g=parseInt(l.text(),10)||1;var j=this.viewDate.getUTCFullYear(),k=this.viewDate.getUTCMonth();if(l.is(".old")){if(k===0){k=11;j-=1}else{k-=1}}else{if(l.is(".new")){if(k==11){k=0;j+=1}else{k+=1}}}this._setDate(f(j,k,g,0,0,0,0))}break}}},_setDate:function(g,i){if(!i||i=="date"){this.date=g}if(!i||i=="view"){this.viewDate=g}this.fill();this.setValue();this.element.trigger({type:"changeDate",date:this.date});var h;if(this.isInput){h=this.element}else{if(this.component){h=this.element.find("input")}}if(h){h.change();if(this.autoclose&&(!i||i=="date")){this.hide()}}},moveMonth:function(g,h){if(!h){return g}var l=new Date(g.valueOf()),p=l.getUTCDate(),m=l.getUTCMonth(),k=Math.abs(h),o,n;h=h>0?1:-1;if(k==1){n=h==-1?function(){return l.getUTCMonth()==m}:function(){return l.getUTCMonth()!=o};o=m+h;l.setUTCMonth(o);if(o<0||o>11){o=(o+12)%12}}else{for(var j=0;j<k;j++){l=this.moveMonth(l,h)}o=l.getUTCMonth();l.setUTCDate(p);n=function(){return o!=l.getUTCMonth()}}while(n()){l.setUTCDate(--p);l.setUTCMonth(o)}return l},moveYear:function(h,g){return this.moveMonth(h,g*12)},dateWithinRange:function(g){return g>=this.startDate&&g<=this.endDate},keydown:function(n){if(this.picker.is(":not(:visible)")){if(n.keyCode==27){this.show()}return}var j=false,i,h,m,g,l;switch(n.keyCode){case 27:this.hide();n.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation){break}i=n.keyCode==37?-1:1;if(n.ctrlKey){g=this.moveYear(this.date,i);l=this.moveYear(this.viewDate,i)}else{if(n.shiftKey){g=this.moveMonth(this.date,i);l=this.moveMonth(this.viewDate,i)}else{g=new Date(this.date);g.setUTCDate(this.date.getUTCDate()+i);l=new Date(this.viewDate);l.setUTCDate(this.viewDate.getUTCDate()+i)}}if(this.dateWithinRange(g)){this.date=g;this.viewDate=l;this.setValue();this.update();n.preventDefault();j=true}break;case 38:case 40:if(!this.keyboardNavigation){break}i=n.keyCode==38?-1:1;if(n.ctrlKey){g=this.moveYear(this.date,i);l=this.moveYear(this.viewDate,i)}else{if(n.shiftKey){g=this.moveMonth(this.date,i);l=this.moveMonth(this.viewDate,i)}else{g=new Date(this.date);g.setUTCDate(this.date.getUTCDate()+i*7);l=new Date(this.viewDate);l.setUTCDate(this.viewDate.getUTCDate()+i*7)}}if(this.dateWithinRange(g)){this.date=g;this.viewDate=l;this.setValue();this.update();n.preventDefault();j=true}break;case 13:this.hide();n.preventDefault();break;case 9:this.hide();break}if(j){this.element.trigger({type:"changeDate",date:this.date});var k;if(this.isInput){k=this.element}else{if(this.component){k=this.element.find("input")}}if(k){k.change()}}},showMode:function(g){if(g){this.viewMode=Math.max(0,Math.min(2,this.viewMode+g))}this.picker.find(">div").hide().filter(".datepicker-"+c.modes[this.viewMode].clsName).css("display","block");this.updateNavArrows()}};d.fn.datepicker=function(h){var g=Array.apply(null,arguments);g.shift();return this.each(function(){var k=d(this),j=k.data("datepicker"),i=typeof h=="object"&&h;if(!j){k.data("datepicker",(j=new a(this,d.extend({},d.fn.datepicker.defaults,i))))}if(typeof h=="string"&&typeof j[h]=="function"){j[h].apply(j,g)}})};d.fn.datepicker.defaults={};d.fn.datepicker.Constructor=a;var e=d.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today"}};var c={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(g){return(((g%4===0)&&(g%100!==0))||(g%400===0))},getDaysInMonth:function(g,h){return[31,(c.isLeapYear(g)?29:28),31,30,31,30,31,31,30,31,30,31][h]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(i){var g=i.replace(this.validParts,"\0").split("\0"),h=i.match(this.validParts);if(!g||!g.length||!h||h.length==0){throw new Error("Invalid date format.")}return{separators:g,parts:h}},parseDate:function(k,u,n){if(k instanceof Date){return k}if(/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(k)){var w=/([-+]\d+)([dmwy])/,m=k.match(/([-+]\d+)([dmwy])/g),g,l;k=new Date();for(var o=0;o<m.length;o++){g=w.exec(m[o]);l=parseInt(g[1]);switch(g[2]){case"d":k.setUTCDate(k.getUTCDate()+l);break;case"m":k=a.prototype.moveMonth.call(a.prototype,k,l);break;case"w":k.setUTCDate(k.getUTCDate()+l*7);break;case"y":k=a.prototype.moveYear.call(a.prototype,k,l);break}}return f(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate(),0,0,0)}var m=k&&k.match(this.nonpunctuation)||[],k=new Date(),r={},t=["yyyy","yy","M","MM","m","mm","d","dd"],v={yyyy:function(s,i){return s.setUTCFullYear(i)},yy:function(s,i){return s.setUTCFullYear(2000+i)},m:function(s,i){i-=1;while(i<0){i+=12}i%=12;s.setUTCMonth(i);while(s.getUTCMonth()!=i){s.setUTCDate(s.getUTCDate()-1)}return s},d:function(s,i){return s.setUTCDate(i)}},j,p,g;v.M=v.MM=v.mm=v.m;v.dd=v.d;k=f(k.getFullYear(),k.getMonth(),k.getDate(),0,0,0);var q=u.parts.slice();if(m.length!=q.length){q=d(q).filter(function(s,y){return d.inArray(y,t)!==-1}).toArray()}if(m.length==q.length){for(var o=0,h=q.length;o<h;o++){j=parseInt(m[o],10);g=q[o];if(isNaN(j)){switch(g){case"MM":p=d(e[n].months).filter(function(){var i=this.slice(0,m[o].length),s=m[o].slice(0,i.length);return i==s});j=d.inArray(p[0],e[n].months)+1;break;case"M":p=d(e[n].monthsShort).filter(function(){var i=this.slice(0,m[o].length),s=m[o].slice(0,i.length);return i==s});j=d.inArray(p[0],e[n].monthsShort)+1;break}}r[g]=j}for(var o=0,x;o<t.length;o++){x=t[o];if(x in r&&!isNaN(r[x])){v[x](k,r[x])}}}return k},formatDate:function(g,l,n){var m={d:g.getUTCDate(),D:e[n].daysShort[g.getUTCDay()],DD:e[n].days[g.getUTCDay()],m:g.getUTCMonth()+1,M:e[n].monthsShort[g.getUTCMonth()],MM:e[n].months[g.getUTCMonth()],yy:g.getUTCFullYear().toString().substring(2),yyyy:g.getUTCFullYear()};m.dd=(m.d<10?"0":"")+m.d;m.mm=(m.m<10?"0":"")+m.m;var g=[],k=d.extend([],l.separators);for(var j=0,h=l.parts.length;j<h;j++){if(k.length){g.push(k.shift())}g.push(m[l.parts[j]])}return g.join("")},headTemplate:'<thead><tr><th class="prev"><i class="icon-arrow-left"/></th><th colspan="5" class="switch"></th><th class="next"><i class="icon-arrow-right"/></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};c.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+c.headTemplate+"<tbody></tbody>"+c.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+c.headTemplate+c.contTemplate+c.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+c.headTemplate+c.contTemplate+c.footTemplate+"</table></div></div>";d.fn.datepicker.DPGlobal=c}(window.jQuery);(function(a){a.fn.datepicker.dates.bg={days:["������","����������","�������","�����","���������","�����","������","������"],daysShort:["���","���","���","���","���","���","���","���"],daysMin:["�","�","�","�","�","�","�","�"],months:["������","��������","����","�����","���","���","���","������","���������","��������","�������","��������"],monthsShort:["��","���","���","���","���","���","���","���","���","���","���","���"],today:"����"}}(jQuery));
/*! X-editable - v1.4.3 
* In-place editing with Twitter Bootstrap, jQuery UI or pure jQuery
* http://github.com/vitalets/x-editable
* Copyright (c) 2013 Vitaliy Potapov; Licensed MIT */
(function(b){var a=function(d,c){this.options=b.extend({},b.fn.editableform.defaults,c);this.$div=b(d);if(!this.options.scope){this.options.scope=this}};a.prototype={constructor:a,initInput:function(){this.input=this.options.input;this.value=this.input.str2value(this.options.value)},initTemplate:function(){this.$form=b(b.fn.editableform.template)},initButtons:function(){this.$form.find(".editable-buttons").append(b.fn.editableform.buttons)},render:function(){this.$loading=b(b.fn.editableform.loading);this.$div.empty().append(this.$loading);this.initTemplate();if(this.options.showbuttons){this.initButtons()}else{this.$form.find(".editable-buttons").remove()}this.showLoading();this.$div.triggerHandler("rendering");this.initInput();this.input.prerender();this.$form.find("div.editable-input").append(this.input.$tpl);this.$div.append(this.$form);b.when(this.input.render()).then(b.proxy(function(){if(!this.options.showbuttons){this.input.autosubmit()}this.$form.find(".editable-cancel").click(b.proxy(this.cancel,this));if(this.input.error){this.error(this.input.error);this.$form.find(".editable-submit").attr("disabled",true);this.input.$input.attr("disabled",true);this.$form.submit(function(c){c.preventDefault()})}else{this.error(false);this.input.$input.removeAttr("disabled");this.$form.find(".editable-submit").removeAttr("disabled");this.input.value2input(this.value);this.$form.submit(b.proxy(this.submit,this))}this.$div.triggerHandler("rendered");this.showForm();if(this.input.postrender){this.input.postrender()}},this))},cancel:function(){this.$div.triggerHandler("cancel")},showLoading:function(){var c,d;if(this.$form){c=this.$form.outerWidth();d=this.$form.outerHeight();if(c){this.$loading.width(c)}if(d){this.$loading.height(d)}this.$form.hide()}else{c=this.$loading.parent().width();if(c){this.$loading.width(c)}}this.$loading.show()},showForm:function(c){this.$loading.hide();this.$form.show();if(c!==false){this.input.activate()}this.$div.triggerHandler("show")},error:function(g){var e=this.$form.find(".control-group"),f=this.$form.find(".editable-error-block"),c;if(g===false){e.removeClass(b.fn.editableform.errorGroupClass);f.removeClass(b.fn.editableform.errorBlockClass).empty().hide()}else{if(g){c=g.split("\n");for(var d=0;d<c.length;d++){c[d]=b("<div>").text(c[d]).html()}g=c.join("<br>")}e.addClass(b.fn.editableform.errorGroupClass);f.addClass(b.fn.editableform.errorBlockClass).html(g).show()}},submit:function(f){f.stopPropagation();f.preventDefault();var c,d=this.input.input2value();if(c=this.validate(d)){this.error(c);this.showForm();return}if(!this.options.savenochange&&this.input.value2str(d)==this.input.value2str(this.value)){this.$div.triggerHandler("nochange");return}b.when(this.save(d)).done(b.proxy(function(e){var g=typeof this.options.success==="function"?this.options.success.call(this.options.scope,e,d):null;if(g===false){this.error(false);this.showForm(false);return}if(typeof g==="string"){this.error(g);this.showForm();return}if(g&&typeof g==="object"&&g.hasOwnProperty("newValue")){d=g.newValue}this.error(false);this.value=d;this.$div.triggerHandler("save",{newValue:d,response:e})},this)).fail(b.proxy(function(e){this.error(typeof e==="string"?e:e.responseText||e.statusText||"Unknown error!");this.showForm()},this))},save:function(f){var d=this.input.value2submit(f);this.options.pk=b.fn.editableutils.tryParseJson(this.options.pk,true);var c=(typeof this.options.pk==="function")?this.options.pk.call(this.options.scope):this.options.pk,e=!!(typeof this.options.url==="function"||(this.options.url&&((this.options.send==="always")||(this.options.send==="auto"&&c)))),g;if(e){this.showLoading();g={name:this.options.name||"",value:d,pk:c};if(typeof this.options.params==="function"){g=this.options.params.call(this.options.scope,g)}else{this.options.params=b.fn.editableutils.tryParseJson(this.options.params,true);b.extend(g,this.options.params)}if(typeof this.options.url==="function"){return this.options.url.call(this.options.scope,g)}else{return b.ajax(b.extend({url:this.options.url,data:g,type:"POST"},this.options.ajaxOptions))}}},validate:function(c){if(c===undefined){c=this.value}if(typeof this.options.validate==="function"){return this.options.validate.call(this.options.scope,c)}},option:function(c,d){if(c in this.options){this.options[c]=d}if(c==="value"){this.setValue(d)}},setValue:function(c,d){if(d){this.value=this.input.str2value(c)}else{this.value=c}if(this.$form&&this.$form.is(":visible")){this.input.value2input(this.value)}}};b.fn.editableform=function(d){var c=arguments;return this.each(function(){var g=b(this),f=g.data("editableform"),e=typeof d==="object"&&d;if(!f){g.data("editableform",(f=new a(this,e)))}if(typeof d==="string"){f[d].apply(f,Array.prototype.slice.call(c,1))}})};b.fn.editableform.Constructor=a;b.fn.editableform.defaults={type:"text",url:null,params:null,name:null,pk:null,value:null,send:"auto",validate:null,success:null,ajaxOptions:null,showbuttons:true,scope:null,savenochange:false};b.fn.editableform.template='<form class="form-inline editableform"><div class="control-group"><div><div class="editable-input"></div><div class="editable-buttons"></div></div><div class="editable-error-block"></div></div></form>';b.fn.editableform.loading='<div class="editableform-loading"></div>';b.fn.editableform.buttons='<button type="submit" class="editable-submit">ok</button><button type="button" class="editable-cancel">cancel</button>';b.fn.editableform.errorGroupClass=null;b.fn.editableform.errorBlockClass="editable-error"}(window.jQuery));(function(a){a.fn.editableutils={inherit:function(c,b){var d=function(){};d.prototype=b.prototype;c.prototype=new d();c.prototype.constructor=c;c.superclass=b.prototype},setCursorPosition:function(c,d){if(c.setSelectionRange){c.setSelectionRange(d,d)}else{if(c.createTextRange){var b=c.createTextRange();b.collapse(true);b.moveEnd("character",d);b.moveStart("character",d);b.select()}}},tryParseJson:function(b,c){if(typeof b==="string"&&b.length&&b.match(/^[\{\[].*[\}\]]$/)){if(c){try{b=(new Function("return "+b))()}catch(d){}finally{return b}}else{b=(new Function("return "+b))()}}return b},sliceObj:function(h,g,b){var f,e,c={};if(!a.isArray(g)||!g.length){return c}for(var d=0;d<g.length;d++){f=g[d];if(h.hasOwnProperty(f)){c[f]=h[f]}if(b===true){continue}e=f.toLowerCase();if(h.hasOwnProperty(e)){c[f]=h[e]}}return c},getConfigData:function(b){var c={};a.each(b.data(),function(e,d){if(typeof d!=="object"||(d&&typeof d==="object"&&(d.constructor===Object||d.constructor===Array))){c[e]=d}});return c},objectKeys:function(d){if(Object.keys){return Object.keys(d)}else{if(d!==Object(d)){throw new TypeError("Object.keys called on a non-object")}var b=[],c;for(c in d){if(Object.prototype.hasOwnProperty.call(d,c)){b.push(c)}}return b}},escape:function(b){return a("<div>").text(b).html()},itemsByValue:function(g,f,d){if(!f||g===null){return[]}d=d||"value";var c=a.isArray(g),b=[],e=this;a.each(f,function(h,j){if(j.children){b=b.concat(e.itemsByValue(g,j.children,d))}else{if(c){if(a.grep(g,function(i){return i==(j&&typeof j==="object"?j[d]:j)}).length){b.push(j)}}else{if(g==(j&&typeof j==="object"?j[d]:j)){b.push(j)}}}});return b},createInput:function(c){var e,f,b,d=c.type;if(d==="date"){if(c.mode==="inline"){if(a.fn.editabletypes.datefield){d="datefield"}else{if(a.fn.editabletypes.dateuifield){d="dateuifield"}}}else{if(a.fn.editabletypes.date){d="date"}else{if(a.fn.editabletypes.dateui){d="dateui"}}}if(d==="date"&&!a.fn.editabletypes.date){d="combodate"}}if(d==="wysihtml5"&&!a.fn.editabletypes[d]){d="textarea"}if(typeof a.fn.editabletypes[d]==="function"){e=a.fn.editabletypes[d];f=this.sliceObj(c,this.objectKeys(e.defaults));b=new e(f);return b}else{a.error("Unknown type: "+d);return false}}}}(window.jQuery));(function(c){var b=function(e,d){this.init(e,d)};var a=function(e,d){this.init(e,d)};b.prototype={containerName:null,innerCss:null,init:function(e,d){this.$element=c(e);this.options=c.extend({},c.fn.editableContainer.defaults,d);this.splitOptions();this.formOptions.scope=this.$element[0];this.initContainer();this.$element.on("destroyed",c.proxy(function(){this.destroy()},this));if(!c(document).data("editable-handlers-attached")){c(document).on("keyup.editable",function(f){if(f.which===27){c(".editable-open").editableContainer("hide")}});c(document).on("click.editable",function(j){var f=c(j.target),g,h=[".editable-container",".ui-datepicker-header",".modal-backdrop",".bootstrap-wysihtml5-insert-image-modal",".bootstrap-wysihtml5-insert-link-modal"];for(g=0;g<h.length;g++){if(f.is(h[g])||f.parents(h[g]).length){return}}b.prototype.closeOthers(j.target)});c(document).data("editable-handlers-attached",true)}},splitOptions:function(){this.containerOptions={};this.formOptions={};var e=c.fn[this.containerName].defaults;for(var d in this.options){if(d in e){this.containerOptions[d]=this.options[d]}else{this.formOptions[d]=this.options[d]}}},tip:function(){return this.container()?this.container().$tip:null},container:function(){return this.$element.data(this.containerDataName||this.containerName)},call:function(){this.$element[this.containerName].apply(this.$element,arguments)},initContainer:function(){this.call(this.containerOptions)},renderForm:function(){this.$form.editableform(this.formOptions).on({save:c.proxy(this.save,this),nochange:c.proxy(function(){this.hide("nochange")},this),cancel:c.proxy(function(){this.hide("cancel")},this),show:c.proxy(this.setPosition,this),rendering:c.proxy(this.setPosition,this),resize:c.proxy(this.setPosition,this),rendered:c.proxy(function(){this.$element.triggerHandler("shown")},this)}).editableform("render")},show:function(d){this.$element.addClass("editable-open");if(d!==false){this.closeOthers(this.$element[0])}this.innerShow();this.tip().addClass("editable-container");if(this.$form){}this.$form=c("<div>");if(this.tip().is(this.innerCss)){this.tip().append(this.$form)}else{this.tip().find(this.innerCss).append(this.$form)}this.renderForm()},hide:function(d){if(!this.tip()||!this.tip().is(":visible")||!this.$element.hasClass("editable-open")){return}this.$element.removeClass("editable-open");this.innerHide();this.$element.triggerHandler("hidden",d)},innerShow:function(){},innerHide:function(){},toggle:function(d){if(this.container()&&this.tip()&&this.tip().is(":visible")){this.hide()}else{this.show(d)}},setPosition:function(){},save:function(d,f){this.$element.triggerHandler("save",f);this.hide("save")},option:function(d,e){this.options[d]=e;if(d in this.containerOptions){this.containerOptions[d]=e;this.setContainerOption(d,e)}else{this.formOptions[d]=e;if(this.$form){this.$form.editableform("option",d,e)}}},setContainerOption:function(d,e){this.call("option",d,e)},destroy:function(){this.hide();this.innerDestroy();this.$element.off("destroyed");this.$element.removeData("editableContainer")},innerDestroy:function(){},closeOthers:function(d){c(".editable-open").each(function(g,h){if(h===d||c(h).find(d).length){return}var f=c(h),e=f.data("editableContainer");if(!e){return}if(e.options.onblur==="cancel"){f.data("editableContainer").hide("onblur")}else{if(e.options.onblur==="submit"){f.data("editableContainer").tip().find("form").submit()}}})},activate:function(){if(this.tip&&this.tip().is(":visible")&&this.$form){this.$form.data("editableform").input.activate()}}};c.fn.editableContainer=function(e){var d=arguments;return this.each(function(){var h=c(this),j="editableContainer",g=h.data(j),f=typeof e==="object"&&e,i=(f.mode==="inline")?a:b;if(!g){h.data(j,(g=new i(this,f)))}if(typeof e==="string"){g[e].apply(g,Array.prototype.slice.call(d,1))}})};c.fn.editableContainer.Popup=b;c.fn.editableContainer.Inline=a;c.fn.editableContainer.defaults={value:null,placement:"top",autohide:true,onblur:"cancel",anim:false,mode:"popup"};jQuery.event.special.destroyed={remove:function(d){if(d.handler){d.handler()}}}}(window.jQuery));(function(a){a.extend(a.fn.editableContainer.Inline.prototype,a.fn.editableContainer.Popup.prototype,{containerName:"editableform",innerCss:".editable-inline",initContainer:function(){this.$tip=a("<span></span>").addClass("editable-inline");if(!this.options.anim){this.options.anim=0}},splitOptions:function(){this.containerOptions={};this.formOptions=this.options},tip:function(){return this.$tip},innerShow:function(){this.$element.hide();this.tip().insertAfter(this.$element).show()},innerHide:function(){this.$tip.hide(this.options.anim,a.proxy(function(){this.$element.show();this.innerDestroy()},this))},innerDestroy:function(){if(this.tip()){this.tip().empty().remove()}}})}(window.jQuery));(function(b){var a=function(d,c){this.$element=b(d);this.options=b.extend({},b.fn.editable.defaults,c,b.fn.editableutils.getConfigData(this.$element));if(this.options.selector){this.initLive()}else{this.init()}};a.prototype={constructor:a,init:function(){var c=false,d,e;this.options.name=this.options.name||this.$element.attr("id");this.options.scope=this.$element[0];this.input=b.fn.editableutils.createInput(this.options);if(!this.input){return}if(this.options.value===undefined||this.options.value===null){this.value=this.input.html2value(b.trim(this.$element.html()));c=true}else{this.options.value=b.fn.editableutils.tryParseJson(this.options.value,true);if(typeof this.options.value==="string"){this.value=this.input.str2value(this.options.value)}else{this.value=this.options.value}}this.$element.addClass("editable");if(this.options.toggle!=="manual"){this.$element.addClass("editable-click");this.$element.on(this.options.toggle+".editable",b.proxy(function(g){g.preventDefault();if(this.options.toggle==="mouseenter"){this.show()}else{var f=(this.options.toggle!=="click");this.toggle(f)}},this))}else{this.$element.attr("tabindex",-1)}switch(this.options.autotext){case"always":d=true;break;case"auto":d=!b.trim(this.$element.text()).length&&this.value!==null&&this.value!==undefined&&!c;break;default:d=false}b.when(d?this.render():true).then(b.proxy(function(){if(this.options.disabled){this.disable()}else{this.enable()}this.$element.triggerHandler("init",this)},this))},initLive:function(){var c=this.options.selector;this.options.selector=false;this.options.autotext="never";this.$element.on(this.options.toggle+".editable",c,b.proxy(function(f){var d=b(f.target);if(!d.data("editable")){if(d.hasClass(this.options.emptyclass)){d.empty()}d.editable(this.options).trigger(f)}},this))},render:function(c){if(this.options.display===false){return}if(this.input.value2htmlFinal){return this.input.value2html(this.value,this.$element[0],this.options.display,c)}else{if(typeof this.options.display==="function"){return this.options.display.call(this.$element[0],this.value,c)}else{return this.input.value2html(this.value,this.$element[0])}}},enable:function(){this.options.disabled=false;this.$element.removeClass("editable-disabled");this.handleEmpty(this.isEmpty);if(this.options.toggle!=="manual"){if(this.$element.attr("tabindex")==="-1"){this.$element.removeAttr("tabindex")}}},disable:function(){this.options.disabled=true;this.hide();this.$element.addClass("editable-disabled");this.handleEmpty(this.isEmpty);this.$element.attr("tabindex",-1)},toggleDisabled:function(){if(this.options.disabled){this.enable()}else{this.disable()}},option:function(c,d){if(c&&typeof c==="object"){b.each(c,b.proxy(function(f,e){this.option(b.trim(f),e)},this));return}this.options[c]=d;if(c==="disabled"){return d?this.disable():this.enable()}if(c==="value"){this.setValue(d)}if(this.container){this.container.option(c,d)}if(this.input.option){this.input.option(c,d)}},handleEmpty:function(c){if(this.options.display===false){return}this.isEmpty=c!==undefined?c:b.trim(this.$element.text())==="";if(!this.options.disabled){if(this.isEmpty){this.$element.text(this.options.emptytext);if(this.options.emptyclass){this.$element.addClass(this.options.emptyclass)}}else{if(this.options.emptyclass){this.$element.removeClass(this.options.emptyclass)}}}else{if(this.isEmpty){this.$element.empty();if(this.options.emptyclass){this.$element.removeClass(this.options.emptyclass)}}}},show:function(c){if(this.options.disabled){return}if(!this.container){var d=b.extend({},this.options,{value:this.value,input:this.input});this.$element.editableContainer(d);this.$element.on("save.internal",b.proxy(this.save,this));this.container=this.$element.data("editableContainer")}else{if(this.container.tip().is(":visible")){return}}this.container.show(c)},hide:function(){if(this.container){this.container.hide()}},toggle:function(c){if(this.container&&this.container.tip().is(":visible")){this.hide()}else{this.show(c)}},save:function(d,f){if(this.options.unsavedclass){var c=false;c=c||typeof this.options.url==="function";c=c||this.options.display===false;c=c||f.response!==undefined;c=c||(this.options.savenochange&&this.input.value2str(this.value)!==this.input.value2str(f.newValue));if(c){this.$element.removeClass(this.options.unsavedclass)}else{this.$element.addClass(this.options.unsavedclass)}}this.setValue(f.newValue,false,f.response)},validate:function(){if(typeof this.options.validate==="function"){return this.options.validate.call(this,this.value)}},setValue:function(d,e,c){if(e){this.value=this.input.str2value(d)}else{this.value=d}if(this.container){this.container.option("value",this.value)}b.when(this.render(c)).then(b.proxy(function(){this.handleEmpty()},this))},activate:function(){if(this.container){this.container.activate()}},destroy:function(){if(this.container){this.container.destroy()}if(this.options.toggle!=="manual"){this.$element.removeClass("editable-click");this.$element.off(this.options.toggle+".editable")}this.$element.off("save.internal");this.$element.removeClass("editable");this.$element.removeClass("editable-open");this.$element.removeData("editable")}};b.fn.editable=function(h){var c={},g=arguments,e="editable";switch(h){case"validate":this.each(function(){var m=b(this),l=m.data(e),k;if(l&&(k=l.validate())){c[l.options.name]=k}});return c;case"getValue":this.each(function(){var l=b(this),k=l.data(e);if(k&&k.value!==undefined&&k.value!==null){c[k.options.name]=k.input.value2submit(k.value)}});return c;case"submit":var f=arguments[1]||{},j=this,i=this.editable("validate"),d;if(b.isEmptyObject(i)){d=this.editable("getValue");if(f.data){b.extend(d,f.data)}b.ajax(b.extend({url:f.url,data:d,type:"POST"},f.ajaxOptions)).success(function(k){if(typeof f.success==="function"){f.success.call(j,k,f)}}).error(function(){if(typeof f.error==="function"){f.error.apply(j,arguments)}})}else{if(typeof f.error==="function"){f.error.call(j,i)}}return this}return this.each(function(){var m=b(this),l=m.data(e),k=typeof h==="object"&&h;if(!l){m.data(e,(l=new a(this,k)))}if(typeof h==="string"){l[h].apply(l,Array.prototype.slice.call(g,1))}})};b.fn.editable.defaults={type:"text",disabled:false,toggle:"click",emptytext:"Empty",autotext:"auto",value:null,display:null,emptyclass:"editable-empty",unsavedclass:"editable-unsaved",selector:null}}(window.jQuery));(function(b){b.fn.editabletypes={};var a=function(){};a.prototype={init:function(d,c,e){this.type=d;this.options=b.extend({},e,c)},prerender:function(){this.$tpl=b(this.options.tpl);this.$input=this.$tpl;this.$clear=null;this.error=null},render:function(){},value2html:function(d,c){b(c).text(d)},html2value:function(c){return b("<div>").html(c).text()},value2str:function(c){return c},str2value:function(c){return c},value2submit:function(c){return c},value2input:function(c){this.$input.val(c)},input2value:function(){return this.$input.val()},activate:function(){if(this.$input.is(":visible")){this.$input.focus()}},clear:function(){this.$input.val(null)},escape:function(c){return b("<div>").text(c).html()},autosubmit:function(){},setClass:function(){if(this.options.inputclass){this.$input.addClass(this.options.inputclass)}},setAttr:function(c){if(this.options[c]!==undefined&&this.options[c]!==null){this.$input.attr(c,this.options[c])}},option:function(c,d){this.options[c]=d}};a.defaults={tpl:"",inputclass:"input-medium",scope:null};b.extend(b.fn.editabletypes,{abstractinput:a})}(window.jQuery));(function(b){var a=function(c){};b.fn.editableutils.inherit(a,b.fn.editabletypes.abstractinput);b.extend(a.prototype,{render:function(){var c=b.Deferred();this.error=null;this.onSourceReady(function(){this.renderList();c.resolve()},function(){this.error=this.options.sourceError;c.resolve()});return c.promise()},html2value:function(c){return null},value2html:function(f,e,g,d){var c=b.Deferred(),h=function(){if(typeof g==="function"){g.call(e,f,this.sourceData,d)}else{this.value2htmlFinal(f,e)}c.resolve()};if(f===null){h.call(this)}else{this.onSourceReady(h,function(){c.resolve()})}return c.promise()},onSourceReady:function(i,d){if(b.isArray(this.sourceData)){i.call(this);return}try{this.options.source=b.fn.editableutils.tryParseJson(this.options.source,false)}catch(h){d.call(this);return}var f=this.options.source;if(b.isFunction(f)){f=f.call(this.options.scope)}if(typeof f==="string"){if(this.options.sourceCache){var g=f,c;if(!b(document).data(g)){b(document).data(g,{})}c=b(document).data(g);if(c.loading===false&&c.sourceData){this.sourceData=c.sourceData;this.doPrepend();i.call(this);return}else{if(c.loading===true){c.callbacks.push(b.proxy(function(){this.sourceData=c.sourceData;this.doPrepend();i.call(this)},this));c.err_callbacks.push(b.proxy(d,this));return}else{c.loading=true;c.callbacks=[];c.err_callbacks=[]}}}b.ajax({url:f,type:"get",cache:false,dataType:"json",success:b.proxy(function(e){if(c){c.loading=false}this.sourceData=this.makeArray(e);if(b.isArray(this.sourceData)){if(c){c.sourceData=this.sourceData;b.each(c.callbacks,function(){this.call()})}this.doPrepend();i.call(this)}else{d.call(this);if(c){b.each(c.err_callbacks,function(){this.call()})}}},this),error:b.proxy(function(){d.call(this);if(c){c.loading=false;b.each(c.err_callbacks,function(){this.call()})}},this)})}else{this.sourceData=this.makeArray(f);if(b.isArray(this.sourceData)){this.doPrepend();i.call(this)}else{d.call(this)}}},doPrepend:function(){if(this.options.prepend===null||this.options.prepend===undefined){return}if(!b.isArray(this.prependData)){if(b.isFunction(this.options.prepend)){this.options.prepend=this.options.prepend.call(this.options.scope)}this.options.prepend=b.fn.editableutils.tryParseJson(this.options.prepend,true);if(typeof this.options.prepend==="string"){this.options.prepend={"":this.options.prepend}}this.prependData=this.makeArray(this.options.prepend)}if(b.isArray(this.prependData)&&b.isArray(this.sourceData)){this.sourceData=this.prependData.concat(this.sourceData)}},renderList:function(){},value2htmlFinal:function(d,c){},makeArray:function(h){var g,j,c=[],f,d;if(!h||typeof h==="string"){return null}if(b.isArray(h)){d=function(l,i){j={value:l,text:i};if(g++>=2){return false}};for(var e=0;e<h.length;e++){f=h[e];if(typeof f==="object"){g=0;b.each(f,d);if(g===1){c.push(j)}else{if(g>1){if(f.children){f.children=this.makeArray(f.children)}c.push(f)}}}else{c.push({value:f,text:f})}}}else{b.each(h,function(l,i){c.push({value:l,text:i})})}return c},option:function(c,d){this.options[c]=d;if(c==="source"){this.sourceData=null}if(c==="prepend"){this.prependData=null}}});a.defaults=b.extend({},b.fn.editabletypes.abstractinput.defaults,{source:null,prepend:false,sourceError:"Error when loading list",sourceCache:true});b.fn.editabletypes.list=a}(window.jQuery));(function(b){var a=function(c){this.init("text",c,a.defaults)};b.fn.editableutils.inherit(a,b.fn.editabletypes.abstractinput);b.extend(a.prototype,{render:function(){this.renderClear();this.setClass();this.setAttr("placeholder")},activate:function(){if(this.$input.is(":visible")){this.$input.focus();b.fn.editableutils.setCursorPosition(this.$input.get(0),this.$input.val().length);if(this.toggleClear){this.toggleClear()}}},renderClear:function(){if(this.options.clear){this.$clear=b('<span class="editable-clear-x"></span>');this.$input.after(this.$clear).css("padding-right",24).keyup(b.proxy(function(d){if(~b.inArray(d.keyCode,[40,38,9,13,27])){return}clearTimeout(this.t);var c=this;this.t=setTimeout(function(){c.toggleClear(d)},100)},this)).parent().css("position","relative");this.$clear.click(b.proxy(this.clear,this))}},postrender:function(){if(this.$clear){var c=this.$input.outerHeight()||20,d=(c-this.$clear.height())/2;if(d<3){d=3}this.$clear.css({bottom:d,right:d})}},toggleClear:function(d){if(!this.$clear){return}var c=this.$input.val().length,f=this.$clear.is(":visible");if(c&&!f){this.$clear.show()}if(!c&&f){this.$clear.hide()}},clear:function(){this.$clear.hide();this.$input.val("").focus()}});a.defaults=b.extend({},b.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',placeholder:null,clear:true});b.fn.editabletypes.text=a}(window.jQuery));(function(b){var a=function(c){this.init("textarea",c,a.defaults)};b.fn.editableutils.inherit(a,b.fn.editabletypes.abstractinput);b.extend(a.prototype,{render:function(){this.setClass();this.setAttr("placeholder");this.setAttr("rows");this.$input.keydown(function(c){if(c.ctrlKey&&c.which===13){b(this).closest("form").submit()}})},value2html:function(g,f){var e="",c;if(g){c=g.split("\n");for(var d=0;d<c.length;d++){c[d]=b("<div>").text(c[d]).html()}e=c.join("<br>")}b(f).html(e)},html2value:function(e){if(!e){return""}var f=new RegExp(String.fromCharCode(10),"g");var c=e.split(/<br\s*\/?>/i);for(var d=0;d<c.length;d++){var g=b("<div>").html(c[d]).text();g=g.replace(f,"");c[d]=g}return c.join("\n")},activate:function(){b.fn.editabletypes.text.prototype.activate.call(this)}});a.defaults=b.extend({},b.fn.editabletypes.abstractinput.defaults,{tpl:"<textarea></textarea>",inputclass:"input-large",placeholder:null,rows:7});b.fn.editabletypes.textarea=a}(window.jQuery));(function(a){var b=function(c){this.init("select",c,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.list);a.extend(b.prototype,{renderList:function(){this.$input.empty();var c=function(e,f){if(a.isArray(f)){for(var d=0;d<f.length;d++){if(f[d].children){e.append(c(a("<optgroup>",{label:f[d].text}),f[d].children))}else{e.append(a("<option>",{value:f[d].value}).text(f[d].text))}}}return e};c(this.$input,this.sourceData);this.setClass();this.$input.on("keydown.editable",function(d){if(d.which===13){a(this).closest("form").submit()}})},value2htmlFinal:function(e,d){var f="",c=a.fn.editableutils.itemsByValue(e,this.sourceData);if(c.length){f=c[0].text}a(d).text(f)},autosubmit:function(){this.$input.off("keydown.editable").on("change.editable",function(){a(this).closest("form").submit()})}});b.defaults=a.extend({},a.fn.editabletypes.list.defaults,{tpl:"<select></select>"});a.fn.editabletypes.select=b}(window.jQuery));(function(b){var a=function(c){this.init("checklist",c,a.defaults)};b.fn.editableutils.inherit(a,b.fn.editabletypes.list);b.extend(a.prototype,{renderList:function(){var c,d;this.$tpl.empty();if(!b.isArray(this.sourceData)){return}for(var e=0;e<this.sourceData.length;e++){c=b("<label>").append(b("<input>",{type:"checkbox",value:this.sourceData[e].value})).append(b("<span>").text(" "+this.sourceData[e].text));b("<div>").append(c).appendTo(this.$tpl)}this.$input=this.$tpl.find('input[type="checkbox"]');this.setClass()},value2str:function(c){return b.isArray(c)?c.sort().join(b.trim(this.options.separator)):""},str2value:function(e){var c,d=null;if(typeof e==="string"&&e.length){c=new RegExp("\\s*"+b.trim(this.options.separator)+"\\s*");d=e.split(c)}else{if(b.isArray(e)){d=e}}return d},value2input:function(c){this.$input.prop("checked",false);if(b.isArray(c)&&c.length){this.$input.each(function(e,f){var d=b(f);b.each(c,function(g,h){if(d.val()==h){d.prop("checked",true)}})})}},input2value:function(){var c=[];this.$input.filter(":checked").each(function(d,e){c.push(b(e).val())});return c},value2htmlFinal:function(f,d){var c=[],e=b.fn.editableutils.itemsByValue(f,this.sourceData);if(e.length){b.each(e,function(h,g){c.push(b.fn.editableutils.escape(g.text))});b(d).html(c.join("<br>"))}else{b(d).empty()}},activate:function(){this.$input.first().focus()},autosubmit:function(){this.$input.on("keydown",function(c){if(c.which===13){b(this).closest("form").submit()}})}});a.defaults=b.extend({},b.fn.editabletypes.list.defaults,{tpl:'<div class="editable-checklist"></div>',inputclass:null,separator:","});b.fn.editabletypes.checklist=a}(window.jQuery));(function(b){var a=function(c){this.init("password",c,a.defaults)};b.fn.editableutils.inherit(a,b.fn.editabletypes.text);b.extend(a.prototype,{value2html:function(d,c){if(d){b(c).text("[hidden]")}else{b(c).empty()}},html2value:function(c){return null}});a.defaults=b.extend({},b.fn.editabletypes.text.defaults,{tpl:'<input type="password">'});b.fn.editabletypes.password=a}(window.jQuery));(function(a){var b=function(c){this.init("email",c,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text);b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="email">'});a.fn.editabletypes.email=b}(window.jQuery));(function(a){var b=function(c){this.init("url",c,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text);b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="url">'});a.fn.editabletypes.url=b}(window.jQuery));(function(a){var b=function(c){this.init("tel",c,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text);b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="tel">'});a.fn.editabletypes.tel=b}(window.jQuery));(function(a){var b=function(c){this.init("number",c,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.text);a.extend(b.prototype,{render:function(){b.superclass.render.call(this);this.setAttr("min");this.setAttr("max");this.setAttr("step")}});b.defaults=a.extend({},a.fn.editabletypes.text.defaults,{tpl:'<input type="number">',inputclass:"input-mini",min:null,max:null,step:null});a.fn.editabletypes.number=b}(window.jQuery));(function(a){var b=function(c){this.init("range",c,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.number);a.extend(b.prototype,{render:function(){this.$input=this.$tpl.filter("input");this.setClass();this.setAttr("min");this.setAttr("max");this.setAttr("step");this.$input.on("input",function(){a(this).siblings("output").text(a(this).val())})},activate:function(){this.$input.focus()}});b.defaults=a.extend({},a.fn.editabletypes.number.defaults,{tpl:'<input type="range"><output style="width: 30px; display: inline-block"></output>',inputclass:"input-medium"});a.fn.editabletypes.range=b}(window.jQuery));(function(a){var b=function(d){this.init("select2",d,b.defaults);d.select2=d.select2||{};var e=this,c={placeholder:d.placeholder};this.isMultiple=d.select2.tags||d.select2.multiple;if(!d.select2.tags){if(d.source){c.data=d.source}c.initSelection=function(f,i){var h=e.str2value(f.val()),g=a.fn.editableutils.itemsByValue(h,c.data,"id");if(a.isArray(g)&&g.length&&!e.isMultiple){g=g[0]}i(g)}}this.options.select2=a.extend({},b.defaults.select2,c,d.select2)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput);a.extend(b.prototype,{render:function(){this.setClass();this.$input.select2(this.options.select2);if("ajax" in this.options.select2){}if(this.isMultiple){this.$input.on("change",function(){a(this).closest("form").parent().triggerHandler("resize")})}},value2html:function(e,c){var f="",d;if(this.$input){d=this.$input.select2("data")}else{if(this.options.select2.tags){d=e}else{if(this.options.select2.data){d=a.fn.editableutils.itemsByValue(e,this.options.select2.data,"id")}else{}}}if(a.isArray(d)){f=[];a.each(d,function(h,g){f.push(g&&typeof g==="object"?g.text:g)})}else{if(d){f=d.text}}f=a.isArray(f)?f.join(this.options.viewseparator):f;a(c).text(f)},html2value:function(c){return this.options.select2.tags?this.str2value(c,this.options.viewseparator):null},value2input:function(c){this.$input.val(c).trigger("change",true)},input2value:function(){return this.$input.select2("val")},str2value:function(g,e){if(typeof g!=="string"||!this.isMultiple){return g}e=e||this.options.select2.separator||a.fn.select2.defaults.separator;var f,d,c;if(g===null||g.length<1){return null}f=g.split(e);for(d=0,c=f.length;d<c;d=d+1){f[d]=a.trim(f[d])}return f},autosubmit:function(){this.$input.on("change",function(d,c){if(!c){a(this).closest("form").submit()}})}});b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="hidden">',select2:null,placeholder:null,source:null,viewseparator:", "});a.fn.editabletypes.select2=b}(window.jQuery));(function(b){var a=function(d,c){this.$element=b(d);if(!this.$element.is("input")){b.error("Combodate should be applied to INPUT element");return}this.options=b.extend({},b.fn.combodate.defaults,c,this.$element.data());this.init()};a.prototype={constructor:a,init:function(){this.map={day:["D","date"],month:["M","month"],year:["Y","year"],hour:["[Hh]","hours"],minute:["m","minutes"],second:["s","seconds"],ampm:["[Aa]",""]};this.$widget=b('<span class="combodate"></span>').html(this.getTemplate());this.initCombos();this.$widget.on("change","select",b.proxy(function(){this.$element.val(this.getValue())},this));this.$widget.find("select").css("width","auto");this.$element.hide().after(this.$widget);this.setValue(this.$element.val()||this.options.value)},getTemplate:function(){var c=this.options.template;b.each(this.map,function(e,d){d=d[0];var g=new RegExp(d+"+"),f=d.length>1?d.substring(1,2):d;c=c.replace(g,"{"+f+"}")});c=c.replace(/ /g,"&nbsp;");b.each(this.map,function(e,d){d=d[0];var f=d.length>1?d.substring(1,2):d;c=c.replace("{"+f+"}",'<select class="'+e+'"></select>')});return c},initCombos:function(){var c=this;b.each(this.map,function(g,e){var h=c.$widget.find("."+g),i,d;if(h.length){c["$"+g]=h;i="fill"+g.charAt(0).toUpperCase()+g.slice(1);d=c[i]();c["$"+g].html(c.renderItems(d))}})},initItems:function(d){var c=[],e;if(this.options.firstItem==="name"){e=moment.relativeTime||moment.langData()._relativeTime;var f=typeof e[d]==="function"?e[d](1,true,d,false):e[d];f=f.split(" ").reverse()[0];c.push(["",f])}else{if(this.options.firstItem==="empty"){c.push(["",""])}}return c},renderItems:function(c){var e=[];for(var d=0;d<c.length;d++){e.push('<option value="'+c[d][0]+'">'+c[d][1]+"</option>")}return e.join("\n")},fillDay:function(){var d=this.initItems("d"),e,f,c=this.options.template.indexOf("DD")!==-1;for(f=1;f<=31;f++){e=c?this.leadZero(f):f;d.push([f,e])}return d},fillMonth:function(){var d=this.initItems("M"),e,f,h=this.options.template.indexOf("MMMM")!==-1,g=this.options.template.indexOf("MMM")!==-1,c=this.options.template.indexOf("MM")!==-1;for(f=0;f<=11;f++){if(h){e=moment().month(f).format("MMMM")}else{if(g){e=moment().month(f).format("MMM")}else{if(c){e=this.leadZero(f+1)}else{e=f+1}}}d.push([f,e])}return d},fillYear:function(){var c=this.initItems("y"),d,e,f=this.options.template.indexOf("YYYY")!==-1;for(e=this.options.maxYear;e>=this.options.minYear;e--){d=f?e:(e+"").substring(2);c.push([e,d])}return c},fillHour:function(){var e=this.initItems("h"),f,g,j=this.options.template.indexOf("h")!==-1,h=this.options.template.indexOf("H")!==-1,d=this.options.template.toLowerCase().indexOf("hh")!==-1,c=j?12:23;for(g=0;g<=c;g++){f=d?this.leadZero(g):g;e.push([g,f])}return e},fillMinute:function(){var d=this.initItems("m"),e,f,c=this.options.template.indexOf("mm")!==-1;for(f=0;f<=59;f+=this.options.minuteStep){e=c?this.leadZero(f):f;d.push([f,e])}return d},fillSecond:function(){var d=this.initItems("s"),e,f,c=this.options.template.indexOf("ss")!==-1;for(f=0;f<=59;f+=this.options.secondStep){e=c?this.leadZero(f):f;d.push([f,e])}return d},fillAmpm:function(){var d=this.options.template.indexOf("a")!==-1,e=this.options.template.indexOf("A")!==-1,c=[["am",d?"am":"AM"],["pm",d?"pm":"PM"]];return c},getValue:function(f){var e,c={},d=this,g=false;b.each(this.map,function(i,h){if(i==="ampm"){return}var j=i==="day"?1:0;c[i]=d["$"+i]?parseInt(d["$"+i].val(),10):j;if(isNaN(c[i])){g=true;return false}});if(g){return""}if(this.$ampm){c.hour=this.$ampm.val()==="am"?c.hour:c.hour+12;if(c.hour===24){c.hour=0}}e=moment([c.year,c.month,c.day,c.hour,c.minute,c.second]);this.highlight(e);f=f===undefined?this.options.format:f;if(f===null){return e.isValid()?e:null}else{return e.isValid()?e.format(f):""}},setValue:function(f){if(!f){return}var e=typeof f==="string"?moment(f,this.options.format):moment(f),d=this,c={};if(e.isValid()){b.each(this.map,function(h,g){if(h==="ampm"){return}c[h]=e[g[1]]()});if(this.$ampm){if(c.hour>12){c.hour-=12;c.ampm="pm"}else{c.ampm="am"}}b.each(c,function(h,g){if(d["$"+h]){d["$"+h].val(g)}});this.$element.val(e.format(this.options.format))}},highlight:function(c){if(!c.isValid()){if(this.options.errorClass){this.$widget.addClass(this.options.errorClass)}else{if(!this.borderColor){this.borderColor=this.$widget.find("select").css("border-color")}this.$widget.find("select").css("border-color","red")}}else{if(this.options.errorClass){this.$widget.removeClass(this.options.errorClass)}else{this.$widget.find("select").css("border-color",this.borderColor)}}},leadZero:function(c){return c<=9?"0"+c:c},destroy:function(){this.$widget.remove();this.$element.removeData("combodate").show()}};b.fn.combodate=function(e){var f,c=Array.apply(null,arguments);c.shift();if(e==="getValue"&&this.length&&(f=this.eq(0).data("combodate"))){return f.getValue.apply(f,c)}return this.each(function(){var h=b(this),g=h.data("combodate"),d=typeof e=="object"&&e;if(!g){h.data("combodate",(g=new a(this,d)))}if(typeof e=="string"&&typeof g[e]=="function"){g[e].apply(g,c)}})};b.fn.combodate.defaults={format:"DD-MM-YYYY HH:mm",template:"D / MMM / YYYY   H : mm",value:null,minYear:1970,maxYear:2015,minuteStep:5,secondStep:1,firstItem:"empty",errorClass:null}}(window.jQuery));(function(a){var b=function(c){this.init("combodate",c,b.defaults);if(!this.options.viewformat){this.options.viewformat=this.options.format}c.combodate=a.fn.editableutils.tryParseJson(c.combodate,true);this.options.combodate=a.extend({},b.defaults.combodate,c.combodate,{format:this.options.format,template:this.options.template})};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput);a.extend(b.prototype,{render:function(){this.$input.combodate(this.options.combodate)},value2html:function(d,c){var e=d?d.format(this.options.viewformat):"";a(c).text(e)},html2value:function(c){return c?moment(c,this.options.viewformat):null},value2str:function(c){return c?c.format(this.options.format):""},str2value:function(c){return c?moment(c,this.options.format):null},value2submit:function(c){return this.value2str(c)},value2input:function(c){this.$input.combodate("setValue",c)},input2value:function(){return this.$input.combodate("getValue",null)},activate:function(){this.$input.siblings(".combodate").find("select").eq(0).focus()},autosubmit:function(){}});b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<input type="text">',inputclass:null,format:"YYYY-MM-DD",viewformat:null,template:"D / MMM / YYYY",combodate:null});a.fn.editabletypes.combodate=b}(window.jQuery));(function(a){a.extend(a.fn.editableform.Constructor.prototype,{initTemplate:function(){this.$form=a(a.fn.editableform.template);this.$form.find(".editable-error-block").addClass("help-block")}});a.fn.editableform.buttons='<button type="submit" class="btn btn-primary editable-submit"><i class="icon-ok icon-white"></i></button><button type="button" class="btn editable-cancel"><i class="icon-remove"></i></button>';a.fn.editableform.errorGroupClass="error";a.fn.editableform.errorBlockClass=null}(window.jQuery));(function(a){a.extend(a.fn.editableContainer.Popup.prototype,{containerName:"popover",innerCss:a(a.fn.popover.defaults.template).find("p").length?".popover-content p":".popover-content",initContainer:function(){a.extend(this.containerOptions,{trigger:"manual",selector:false,content:" ",template:a.fn.popover.defaults.template});var b;if(this.$element.data("template")){b=this.$element.data("template");this.$element.removeData("template")}this.call(this.containerOptions);if(b){this.$element.data("template",b)}},innerShow:function(){this.call("show")},innerHide:function(){this.call("hide")},innerDestroy:function(){this.call("destroy")},setContainerOption:function(b,c){this.container().options[b]=c},setPosition:function(){(function(){var f=this.tip(),b,h,d,g,c,e;c=typeof this.options.placement==="function"?this.options.placement.call(this,f[0],this.$element[0]):this.options.placement;b=/in/.test(c);f.removeClass("top right bottom left").css({top:0,left:0,display:"block"});h=this.getPosition(b);d=f[0].offsetWidth;g=f[0].offsetHeight;switch(b?c.split(" ")[1]:c){case"bottom":e={top:h.top+h.height,left:h.left+h.width/2-d/2};break;case"top":e={top:h.top-g,left:h.left+h.width/2-d/2};break;case"left":e={top:h.top+h.height/2-g/2,left:h.left-d};break;case"right":e={top:h.top+h.height/2-g/2,left:h.left+h.width};break}f.offset(e).addClass(c).addClass("in")}).call(this.container())}})}(window.jQuery));(function(b){var a=function(c){this.init("date",c,a.defaults);this.initPicker(c,a.defaults)};b.fn.editableutils.inherit(a,b.fn.editabletypes.abstractinput);b.extend(a.prototype,{initPicker:function(c,d){if(!this.options.viewformat){this.options.viewformat=this.options.format}this.options.datepicker=b.extend({},d.datepicker,c.datepicker,{format:this.options.viewformat});this.options.datepicker.language=this.options.datepicker.language||"en";this.dpg=b.fn.datepicker.DPGlobal;this.parsedFormat=this.dpg.parseFormat(this.options.format);this.parsedViewFormat=this.dpg.parseFormat(this.options.viewformat)},render:function(){this.$input.datepicker(this.options.datepicker);if(this.options.clear){this.$clear=b('<a href="#"></a>').html(this.options.clear).click(b.proxy(function(c){c.preventDefault();c.stopPropagation();this.clear()},this));this.$tpl.parent().append(b('<div class="editable-clear">').append(this.$clear))}},value2html:function(d,c){var e=d?this.dpg.formatDate(d,this.parsedViewFormat,this.options.datepicker.language):"";a.superclass.value2html(e,c)},html2value:function(c){return c?this.dpg.parseDate(c,this.parsedViewFormat,this.options.datepicker.language):null},value2str:function(c){return c?this.dpg.formatDate(c,this.parsedFormat,this.options.datepicker.language):""},str2value:function(c){return c?this.dpg.parseDate(c,this.parsedFormat,this.options.datepicker.language):null},value2submit:function(c){return this.value2str(c)},value2input:function(c){this.$input.datepicker("update",c)},input2value:function(){return this.$input.data("datepicker").date},activate:function(){},clear:function(){this.$input.data("datepicker").date=null;this.$input.find(".active").removeClass("active")},autosubmit:function(){this.$input.on("mouseup",".day",function(d){if(b(d.currentTarget).is(".old")||b(d.currentTarget).is(".new")){return}var c=b(this).closest("form");setTimeout(function(){c.submit()},200)})}});a.defaults=b.extend({},b.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-date well"></div>',inputclass:null,format:"yyyy-mm-dd",viewformat:null,datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:false},clear:"&times; clear"});b.fn.editabletypes.date=a}(window.jQuery));(function(b){var a=function(c){this.init("datefield",c,a.defaults);this.initPicker(c,a.defaults)};b.fn.editableutils.inherit(a,b.fn.editabletypes.date);b.extend(a.prototype,{render:function(){this.$input=this.$tpl.find("input");this.setClass();this.setAttr("placeholder");this.$tpl.datepicker(this.options.datepicker);this.$input.off("focus keydown");this.$input.keyup(b.proxy(function(){this.$tpl.removeData("date");this.$tpl.datepicker("update")},this))},value2input:function(c){this.$input.val(c?this.dpg.formatDate(c,this.parsedViewFormat,this.options.datepicker.language):"");this.$tpl.datepicker("update")},input2value:function(){return this.html2value(this.$input.val())},activate:function(){b.fn.editabletypes.text.prototype.activate.call(this)},autosubmit:function(){}});a.defaults=b.extend({},b.fn.editabletypes.date.defaults,{tpl:'<div class="input-append date"><input type="text"/><span class="add-on"><i class="icon-th"></i></span></div>',inputclass:"input-small",datepicker:{weekStart:0,startView:0,minViewMode:0,autoclose:true}});b.fn.editabletypes.datefield=a}(window.jQuery));!function(d){function f(){return new Date(Date.UTC.apply(Date,arguments))}function b(){var g=new Date();return f(g.getUTCFullYear(),g.getUTCMonth(),g.getUTCDate())}var a=function(h,g){var i=this;this.element=d(h);this.language=g.language||this.element.data("date-language")||"en";this.language=this.language in e?this.language:this.language.split("-")[0];this.language=this.language in e?this.language:"en";this.isRTL=e[this.language].rtl||false;this.format=c.parseFormat(g.format||this.element.data("date-format")||e[this.language].format||"mm/dd/yyyy");this.isInline=false;this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):false;this.hasInput=this.component&&this.element.find("input").length;if(this.component&&this.component.length===0){this.component=false}this._attachEvents();this.forceParse=true;if("forceParse" in g){this.forceParse=g.forceParse}else{if("dateForceParse" in this.element.data()){this.forceParse=this.element.data("date-force-parse")}}this.picker=d(c.template).appendTo(this.isInline?this.element:"body").on({click:d.proxy(this.click,this),mousedown:d.proxy(this.mousedown,this)});if(this.isInline){this.picker.addClass("datepicker-inline")}else{this.picker.addClass("datepicker-dropdown dropdown-menu")}if(this.isRTL){this.picker.addClass("datepicker-rtl");this.picker.find(".prev i, .next i").toggleClass("icon-arrow-left icon-arrow-right")}d(document).on("mousedown",function(j){if(d(j.target).closest(".datepicker.datepicker-inline, .datepicker.datepicker-dropdown").length===0){i.hide()}});this.autoclose=false;if("autoclose" in g){this.autoclose=g.autoclose}else{if("dateAutoclose" in this.element.data()){this.autoclose=this.element.data("date-autoclose")}}this.keyboardNavigation=true;if("keyboardNavigation" in g){this.keyboardNavigation=g.keyboardNavigation}else{if("dateKeyboardNavigation" in this.element.data()){this.keyboardNavigation=this.element.data("date-keyboard-navigation")}}this.viewMode=this.startViewMode=0;switch(g.startView||this.element.data("date-start-view")){case 2:case"decade":this.viewMode=this.startViewMode=2;break;case 1:case"year":this.viewMode=this.startViewMode=1;break}this.minViewMode=g.minViewMode||this.element.data("date-min-view-mode")||0;if(typeof this.minViewMode==="string"){switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0;break}}this.viewMode=this.startViewMode=Math.max(this.startViewMode,this.minViewMode);this.todayBtn=(g.todayBtn||this.element.data("date-today-btn")||false);this.todayHighlight=(g.todayHighlight||this.element.data("date-today-highlight")||false);this.calendarWeeks=false;if("calendarWeeks" in g){this.calendarWeeks=g.calendarWeeks}else{if("dateCalendarWeeks" in this.element.data()){this.calendarWeeks=this.element.data("date-calendar-weeks")}}if(this.calendarWeeks){this.picker.find("tfoot th.today").attr("colspan",function(j,k){return parseInt(k)+1})}this.weekStart=((g.weekStart||this.element.data("date-weekstart")||e[this.language].weekStart||0)%7);this.weekEnd=((this.weekStart+6)%7);this.startDate=-Infinity;this.endDate=Infinity;this.daysOfWeekDisabled=[];this.setStartDate(g.startDate||this.element.data("date-startdate"));this.setEndDate(g.endDate||this.element.data("date-enddate"));this.setDaysOfWeekDisabled(g.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled"));this.fillDow();this.fillMonths();this.update();this.showMode();if(this.isInline){this.show()}};a.prototype={constructor:a,_events:[],_attachEvents:function(){this._detachEvents();if(this.isInput){this._events=[[this.element,{focus:d.proxy(this.show,this),keyup:d.proxy(this.update,this),keydown:d.proxy(this.keydown,this)}]]}else{if(this.component&&this.hasInput){this._events=[[this.element.find("input"),{focus:d.proxy(this.show,this),keyup:d.proxy(this.update,this),keydown:d.proxy(this.keydown,this)}],[this.component,{click:d.proxy(this.show,this)}]]}else{if(this.element.is("div")){this.isInline=true}else{this._events=[[this.element,{click:d.proxy(this.show,this)}]]}}}for(var g=0,h,j;g<this._events.length;g++){h=this._events[g][0];j=this._events[g][1];h.on(j)}},_detachEvents:function(){for(var g=0,h,j;g<this._events.length;g++){h=this._events[g][0];j=this._events[g][1];h.off(j)}this._events=[]},show:function(g){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.update();this.place();d(window).on("resize",d.proxy(this.place,this));if(g){g.stopPropagation();g.preventDefault()}this.element.trigger({type:"show",date:this.date})},hide:function(g){if(this.isInline){return}if(!this.picker.is(":visible")){return}this.picker.hide();d(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();if(!this.isInput){d(document).off("mousedown",this.hide)}if(this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())){this.setValue()}this.element.trigger({type:"hide",date:this.date})},remove:function(){this._detachEvents();this.picker.remove();delete this.element.data().datepicker},getDate:function(){var g=this.getUTCDate();return new Date(g.getTime()+(g.getTimezoneOffset()*60000))},getUTCDate:function(){return this.date},setDate:function(g){this.setUTCDate(new Date(g.getTime()-(g.getTimezoneOffset()*60000)))},setUTCDate:function(g){this.date=g;this.setValue()},setValue:function(){var g=this.getFormattedDate();if(!this.isInput){if(this.component){this.element.find("input").val(g)}this.element.data("date",g)}else{this.element.val(g)}},getFormattedDate:function(g){if(g===undefined){g=this.format}return c.formatDate(this.date,g,this.language)},setStartDate:function(g){this.startDate=g||-Infinity;if(this.startDate!==-Infinity){this.startDate=c.parseDate(this.startDate,this.format,this.language)}this.update();this.updateNavArrows()},setEndDate:function(g){this.endDate=g||Infinity;if(this.endDate!==Infinity){this.endDate=c.parseDate(this.endDate,this.format,this.language)}this.update();this.updateNavArrows()},setDaysOfWeekDisabled:function(g){this.daysOfWeekDisabled=g||[];if(!d.isArray(this.daysOfWeekDisabled)){this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)}this.daysOfWeekDisabled=d.map(this.daysOfWeekDisabled,function(h){return parseInt(h,10)});this.update();this.updateNavArrows()},place:function(){if(this.isInline){return}var i=parseInt(this.element.parents().filter(function(){return d(this).css("z-index")!="auto"}).first().css("z-index"))+10;var h=this.component?this.component.offset():this.element.offset();var g=this.component?this.component.outerHeight(true):this.element.outerHeight(true);this.picker.css({top:h.top+g,left:h.left,zIndex:i})},update:function(){var g,h=false;if(arguments&&arguments.length&&(typeof arguments[0]==="string"||arguments[0] instanceof Date)){g=arguments[0];h=true}else{g=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val()}this.date=c.parseDate(g,this.format,this.language);if(h){this.setValue()}if(this.date<this.startDate){this.viewDate=new Date(this.startDate)}else{if(this.date>this.endDate){this.viewDate=new Date(this.endDate)}else{this.viewDate=new Date(this.date)}}this.fill()},fillDow:function(){var h=this.weekStart,i="<tr>";if(this.calendarWeeks){var g='<th class="cw">&nbsp;</th>';i+=g;this.picker.find(".datepicker-days thead tr:first-child").prepend(g)}while(h<this.weekStart+7){i+='<th class="dow">'+e[this.language].daysMin[(h++)%7]+"</th>"}i+="</tr>";this.picker.find(".datepicker-days thead").append(i)},fillMonths:function(){var h="",g=0;while(g<12){h+='<span class="month">'+e[this.language].monthsShort[g++]+"</span>"}this.picker.find(".datepicker-months td").html(h)},fill:function(){var y=new Date(this.viewDate),p=y.getUTCFullYear(),z=y.getUTCMonth(),s=this.startDate!==-Infinity?this.startDate.getUTCFullYear():-Infinity,w=this.startDate!==-Infinity?this.startDate.getUTCMonth():-Infinity,m=this.endDate!==Infinity?this.endDate.getUTCFullYear():Infinity,t=this.endDate!==Infinity?this.endDate.getUTCMonth():Infinity,n=this.date&&this.date.valueOf(),x=new Date();this.picker.find(".datepicker-days thead th.switch").text(e[this.language].months[z]+" "+p);this.picker.find("tfoot th.today").text(e[this.language].today).toggle(this.todayBtn!==false);this.updateNavArrows();this.fillMonths();var B=f(p,z-1,28,0,0,0,0),v=c.getDaysInMonth(B.getUTCFullYear(),B.getUTCMonth());B.setUTCDate(v);B.setUTCDate(v-(B.getUTCDay()-this.weekStart+7)%7);var g=new Date(B);g.setUTCDate(g.getUTCDate()+42);g=g.valueOf();var o=[];var r;while(B.valueOf()<g){if(B.getUTCDay()==this.weekStart){o.push("<tr>");if(this.calendarWeeks){var h=new Date(+B+(this.weekStart-B.getUTCDay()-7)%7*86400000),k=new Date(+h+(7+4-h.getUTCDay())%7*86400000),j=new Date(+(j=f(k.getUTCFullYear(),0,1))+(7+4-j.getUTCDay())%7*86400000),q=(k-j)/86400000/7+1;o.push('<td class="cw">'+q+"</td>")}}r="";if(B.getUTCFullYear()<p||(B.getUTCFullYear()==p&&B.getUTCMonth()<z)){r+=" old"}else{if(B.getUTCFullYear()>p||(B.getUTCFullYear()==p&&B.getUTCMonth()>z)){r+=" new"}}if(this.todayHighlight&&B.getUTCFullYear()==x.getFullYear()&&B.getUTCMonth()==x.getMonth()&&B.getUTCDate()==x.getDate()){r+=" today"}if(n&&B.valueOf()==n){r+=" active"}if(B.valueOf()<this.startDate||B.valueOf()>this.endDate||d.inArray(B.getUTCDay(),this.daysOfWeekDisabled)!==-1){r+=" disabled"}o.push('<td class="day'+r+'">'+B.getUTCDate()+"</td>");if(B.getUTCDay()==this.weekEnd){o.push("</tr>")}B.setUTCDate(B.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(o.join(""));var C=this.date&&this.date.getUTCFullYear();var l=this.picker.find(".datepicker-months").find("th:eq(1)").text(p).end().find("span").removeClass("active");if(C&&C==p){l.eq(this.date.getUTCMonth()).addClass("active")}if(p<s||p>m){l.addClass("disabled")}if(p==s){l.slice(0,w).addClass("disabled")}if(p==m){l.slice(t+1).addClass("disabled")}o="";p=parseInt(p/10,10)*10;var A=this.picker.find(".datepicker-years").find("th:eq(1)").text(p+"-"+(p+9)).end().find("td");p-=1;for(var u=-1;u<11;u++){o+='<span class="year'+(u==-1||u==10?" old":"")+(C==p?" active":"")+(p<s||p>m?" disabled":"")+'">'+p+"</span>";p+=1}A.html(o)},updateNavArrows:function(){var i=new Date(this.viewDate),g=i.getUTCFullYear(),h=i.getUTCMonth();switch(this.viewMode){case 0:if(this.startDate!==-Infinity&&g<=this.startDate.getUTCFullYear()&&h<=this.startDate.getUTCMonth()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.endDate!==Infinity&&g>=this.endDate.getUTCFullYear()&&h>=this.endDate.getUTCMonth()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break;case 1:case 2:if(this.startDate!==-Infinity&&g<=this.startDate.getUTCFullYear()){this.picker.find(".prev").css({visibility:"hidden"})}else{this.picker.find(".prev").css({visibility:"visible"})}if(this.endDate!==Infinity&&g>=this.endDate.getUTCFullYear()){this.picker.find(".next").css({visibility:"hidden"})}else{this.picker.find(".next").css({visibility:"visible"})}break}},click:function(m){m.stopPropagation();m.preventDefault();var l=d(m.target).closest("span, td, th");if(l.length==1){switch(l[0].nodeName.toLowerCase()){case"th":switch(l[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var i=c.modes[this.viewMode].navStep*(l[0].className=="prev"?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,i);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,i);break}this.fill();break;case"today":var h=new Date();h=f(h.getFullYear(),h.getMonth(),h.getDate(),0,0,0);this.showMode(-2);var n=this.todayBtn=="linked"?null:"view";this._setDate(h,n);break}break;case"span":if(!l.is(".disabled")){this.viewDate.setUTCDate(1);if(l.is(".month")){var g=1;var k=l.parent().find("span").index(l);var j=this.viewDate.getUTCFullYear();this.viewDate.setUTCMonth(k);this.element.trigger({type:"changeMonth",date:this.viewDate});if(this.minViewMode==1){this._setDate(f(j,k,g,0,0,0,0))}}else{var j=parseInt(l.text(),10)||0;var g=1;var k=0;this.viewDate.setUTCFullYear(j);this.element.trigger({type:"changeYear",date:this.viewDate});if(this.minViewMode==2){this._setDate(f(j,k,g,0,0,0,0))}}this.showMode(-1);this.fill()}break;case"td":if(l.is(".day")&&!l.is(".disabled")){var g=parseInt(l.text(),10)||1;var j=this.viewDate.getUTCFullYear(),k=this.viewDate.getUTCMonth();if(l.is(".old")){if(k===0){k=11;j-=1}else{k-=1}}else{if(l.is(".new")){if(k==11){k=0;j+=1}else{k+=1}}}this._setDate(f(j,k,g,0,0,0,0))}break}}},_setDate:function(g,i){if(!i||i=="date"){this.date=g}if(!i||i=="view"){this.viewDate=g}this.fill();this.setValue();this.element.trigger({type:"changeDate",date:this.date});var h;if(this.isInput){h=this.element}else{if(this.component){h=this.element.find("input")}}if(h){h.change();if(this.autoclose&&(!i||i=="date")){this.hide()}}},moveMonth:function(g,h){if(!h){return g}var l=new Date(g.valueOf()),p=l.getUTCDate(),m=l.getUTCMonth(),k=Math.abs(h),o,n;h=h>0?1:-1;if(k==1){n=h==-1?function(){return l.getUTCMonth()==m}:function(){return l.getUTCMonth()!=o};o=m+h;l.setUTCMonth(o);if(o<0||o>11){o=(o+12)%12}}else{for(var j=0;j<k;j++){l=this.moveMonth(l,h)}o=l.getUTCMonth();l.setUTCDate(p);n=function(){return o!=l.getUTCMonth()}}while(n()){l.setUTCDate(--p);l.setUTCMonth(o)}return l},moveYear:function(h,g){return this.moveMonth(h,g*12)},dateWithinRange:function(g){return g>=this.startDate&&g<=this.endDate},keydown:function(n){if(this.picker.is(":not(:visible)")){if(n.keyCode==27){this.show()}return}var j=false,i,h,m,g,l;switch(n.keyCode){case 27:this.hide();n.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation){break}i=n.keyCode==37?-1:1;if(n.ctrlKey){g=this.moveYear(this.date,i);l=this.moveYear(this.viewDate,i)}else{if(n.shiftKey){g=this.moveMonth(this.date,i);l=this.moveMonth(this.viewDate,i)}else{g=new Date(this.date);g.setUTCDate(this.date.getUTCDate()+i);l=new Date(this.viewDate);l.setUTCDate(this.viewDate.getUTCDate()+i)}}if(this.dateWithinRange(g)){this.date=g;this.viewDate=l;this.setValue();this.update();n.preventDefault();j=true}break;case 38:case 40:if(!this.keyboardNavigation){break}i=n.keyCode==38?-1:1;if(n.ctrlKey){g=this.moveYear(this.date,i);l=this.moveYear(this.viewDate,i)}else{if(n.shiftKey){g=this.moveMonth(this.date,i);l=this.moveMonth(this.viewDate,i)}else{g=new Date(this.date);g.setUTCDate(this.date.getUTCDate()+i*7);l=new Date(this.viewDate);l.setUTCDate(this.viewDate.getUTCDate()+i*7)}}if(this.dateWithinRange(g)){this.date=g;this.viewDate=l;this.setValue();this.update();n.preventDefault();j=true}break;case 13:this.hide();n.preventDefault();break;case 9:this.hide();break}if(j){this.element.trigger({type:"changeDate",date:this.date});var k;if(this.isInput){k=this.element}else{if(this.component){k=this.element.find("input")}}if(k){k.change()}}},showMode:function(g){if(g){this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+g))}this.picker.find(">div").hide().filter(".datepicker-"+c.modes[this.viewMode].clsName).css("display","block");this.updateNavArrows()}};d.fn.datepicker=function(h){var g=Array.apply(null,arguments);g.shift();return this.each(function(){var k=d(this),j=k.data("datepicker"),i=typeof h=="object"&&h;if(!j){k.data("datepicker",(j=new a(this,d.extend({},d.fn.datepicker.defaults,i))))}if(typeof h=="string"&&typeof j[h]=="function"){j[h].apply(j,g)}})};d.fn.datepicker.defaults={};d.fn.datepicker.Constructor=a;var e=d.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today"}};var c={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(g){return(((g%4===0)&&(g%100!==0))||(g%400===0))},getDaysInMonth:function(g,h){return[31,(c.isLeapYear(g)?29:28),31,30,31,30,31,31,30,31,30,31][h]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(i){var g=i.replace(this.validParts,"\0").split("\0"),h=i.match(this.validParts);if(!g||!g.length||!h||h.length===0){throw new Error("Invalid date format.")}return{separators:g,parts:h}},parseDate:function(k,u,n){if(k instanceof Date){return k}if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(k)){var w=/([\-+]\d+)([dmwy])/,m=k.match(/([\-+]\d+)([dmwy])/g),g,l;k=new Date();for(var o=0;o<m.length;o++){g=w.exec(m[o]);l=parseInt(g[1]);switch(g[2]){case"d":k.setUTCDate(k.getUTCDate()+l);break;case"m":k=a.prototype.moveMonth.call(a.prototype,k,l);break;case"w":k.setUTCDate(k.getUTCDate()+l*7);break;case"y":k=a.prototype.moveYear.call(a.prototype,k,l);break}}return f(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate(),0,0,0)}var m=k&&k.match(this.nonpunctuation)||[],k=new Date(),r={},t=["yyyy","yy","M","MM","m","mm","d","dd"],v={yyyy:function(s,i){return s.setUTCFullYear(i)},yy:function(s,i){return s.setUTCFullYear(2000+i)},m:function(s,i){i-=1;while(i<0){i+=12}i%=12;s.setUTCMonth(i);while(s.getUTCMonth()!=i){s.setUTCDate(s.getUTCDate()-1)}return s},d:function(s,i){return s.setUTCDate(i)}},j,p,g;v.M=v.MM=v.mm=v.m;v.dd=v.d;k=f(k.getFullYear(),k.getMonth(),k.getDate(),0,0,0);var q=u.parts.slice();if(m.length!=q.length){q=d(q).filter(function(s,y){return d.inArray(y,t)!==-1}).toArray()}if(m.length==q.length){for(var o=0,h=q.length;o<h;o++){j=parseInt(m[o],10);g=q[o];if(isNaN(j)){switch(g){case"MM":p=d(e[n].months).filter(function(){var i=this.slice(0,m[o].length),s=m[o].slice(0,i.length);return i==s});j=d.inArray(p[0],e[n].months)+1;break;case"M":p=d(e[n].monthsShort).filter(function(){var i=this.slice(0,m[o].length),s=m[o].slice(0,i.length);return i==s});j=d.inArray(p[0],e[n].monthsShort)+1;break}}r[g]=j}for(var o=0,x;o<t.length;o++){x=t[o];if(x in r&&!isNaN(r[x])){v[x](k,r[x])}}}return k},formatDate:function(g,l,n){var m={d:g.getUTCDate(),D:e[n].daysShort[g.getUTCDay()],DD:e[n].days[g.getUTCDay()],m:g.getUTCMonth()+1,M:e[n].monthsShort[g.getUTCMonth()],MM:e[n].months[g.getUTCMonth()],yy:g.getUTCFullYear().toString().substring(2),yyyy:g.getUTCFullYear()};m.dd=(m.d<10?"0":"")+m.d;m.mm=(m.m<10?"0":"")+m.m;var g=[],k=d.extend([],l.separators);for(var j=0,h=l.parts.length;j<h;j++){if(k.length){g.push(k.shift())}g.push(m[l.parts[j]])}return g.join("")},headTemplate:'<thead><tr><th class="prev"><i class="icon-arrow-left"/></th><th colspan="5" class="switch"></th><th class="next"><i class="icon-arrow-right"/></th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};c.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+c.headTemplate+"<tbody></tbody>"+c.footTemplate+'</table></div><div class="datepicker-months"><table class="table-condensed">'+c.headTemplate+c.contTemplate+c.footTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+c.headTemplate+c.contTemplate+c.footTemplate+"</table></div></div>";d.fn.datepicker.DPGlobal=c}(window.jQuery);(function(a){var b=function(c){this.init("typeahead",c,b.defaults);this.options.typeahead=a.extend({},b.defaults.typeahead,{matcher:this.matcher,sorter:this.sorter,highlighter:this.highlighter,updater:this.updater},c.typeahead)};a.fn.editableutils.inherit(b,a.fn.editabletypes.list);a.extend(b.prototype,{renderList:function(){this.$input=this.$tpl.is("input")?this.$tpl:this.$tpl.find('input[type="text"]');this.options.typeahead.source=this.sourceData;this.$input.typeahead(this.options.typeahead);var c=this.$input.data("typeahead");c.render=a.proxy(this.typeaheadRender,c);c.select=a.proxy(this.typeaheadSelect,c);c.move=a.proxy(this.typeaheadMove,c);this.renderClear();this.setClass();this.setAttr("placeholder")},value2htmlFinal:function(e,d){if(this.getIsObjects()){var c=a.fn.editableutils.itemsByValue(e,this.sourceData);a(d).text(c.length?c[0].text:"")}else{a(d).text(e)}},html2value:function(c){return c?c:null},value2input:function(d){if(this.getIsObjects()){var c=a.fn.editableutils.itemsByValue(d,this.sourceData);this.$input.data("value",d).val(c.length?c[0].text:"")}else{this.$input.val(d)}},input2value:function(){if(this.getIsObjects()){var d=this.$input.data("value"),c=a.fn.editableutils.itemsByValue(d,this.sourceData);if(c.length&&c[0].text.toLowerCase()===this.$input.val().toLowerCase()){return d}else{return null}}else{return this.$input.val()}},getIsObjects:function(){if(this.isObjects===undefined){this.isObjects=false;for(var c=0;c<this.sourceData.length;c++){if(this.sourceData[c].value!==this.sourceData[c].text){this.isObjects=true;break}}}return this.isObjects},activate:a.fn.editabletypes.text.prototype.activate,renderClear:a.fn.editabletypes.text.prototype.renderClear,postrender:a.fn.editabletypes.text.prototype.postrender,toggleClear:a.fn.editabletypes.text.prototype.toggleClear,clear:function(){a.fn.editabletypes.text.prototype.clear.call(this);this.$input.data("value","")},matcher:function(c){return a.fn.typeahead.Constructor.prototype.matcher.call(this,c.text)},sorter:function(e){var f=[],d=[],c=[],g,h;while(g=e.shift()){h=g.text;if(!h.toLowerCase().indexOf(this.query.toLowerCase())){f.push(g)}else{if(~h.indexOf(this.query)){d.push(g)}else{c.push(g)}}}return f.concat(d,c)},highlighter:function(c){return a.fn.typeahead.Constructor.prototype.highlighter.call(this,c.text)},updater:function(c){this.$element.data("value",c.value);return c.text},typeaheadRender:function(c){var d=this;c=a(c).map(function(e,f){e=a(d.options.item).data("item",f);e.find("a").html(d.highlighter(f));return e[0]});if(this.options.autoSelect){c.first().addClass("active")}this.$menu.html(c);return this},typeaheadSelect:function(){var c=this.$menu.find(".active").data("item");if(this.options.autoSelect||c){this.$element.val(this.updater(c)).change()}return this.hide()},typeaheadMove:function(c){if(!this.shown){return}switch(c.keyCode){case 9:case 13:case 27:if(!this.$menu.find(".active").length){return}c.preventDefault();break;case 38:c.preventDefault();this.prev();break;case 40:c.preventDefault();this.next();break}c.stopPropagation()}});b.defaults=a.extend({},a.fn.editabletypes.list.defaults,{tpl:'<input type="text">',typeahead:null,clear:true});a.fn.editabletypes.typeahead=b}(window.jQuery));(function(a){var b=function(c){this.init("address",c,b.defaults)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput);a.extend(b.prototype,{render:function(){this.$input=this.$tpl.find("input")},value2html:function(e,d){if(!e){a(d).empty();return}var c=a("<div>").text(e.city).html()+", "+a("<div>").text(e.street).html()+" st., bld. "+a("<div>").text(e.building).html();a(d).html(c)},html2value:function(c){return null},value2str:function(d){var e="";if(d){for(var c in d){e=e+c+":"+d[c]+";"}}return e},str2value:function(c){return c},value2input:function(c){if(!c){return}this.$input.filter('[name="city"]').val(c.city);this.$input.filter('[name="street"]').val(c.street);this.$input.filter('[name="building"]').val(c.building)},input2value:function(){return{city:this.$input.filter('[name="city"]').val(),street:this.$input.filter('[name="street"]').val(),building:this.$input.filter('[name="building"]').val()}},activate:function(){this.$input.filter('[name="city"]').focus()},autosubmit:function(){this.$input.keydown(function(c){if(c.which===13){a(this).closest("form").submit()}})}});b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:'<div class="editable-address"><label><span>City: </span><input type="text" name="city" class="input-small"></label></div><div class="editable-address"><label><span>Street: </span><input type="text" name="street" class="input-small"></label></div><div class="editable-address"><label><span>Building: </span><input type="text" name="building" class="input-mini"></label></div>',inputclass:""});a.fn.editabletypes.address=b}(window.jQuery));var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"\ufeff",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};window.rangy=function(){function S(e,d){var f=typeof e[d];return f==J||!!(f==M&&e[d])||"unknown"==f}function R(d,c){return !!(typeof d[c]==M&&d[c])}function T(d,c){return typeof d[c]!=K}function Q(b){return function(a,f){for(var e=f.length;e--;){if(!b(a,f[e])){return !1}}return !0}}function P(b){return b&&I(b,C)&&u(b,D)}function O(b){window.alert("Rangy not supported in your browser. Reason: "+b);G.initialized=!0;G.supported=!1}function N(){if(!G.initialized){var b,f=!1,e=!1;S(document,"createRange")&&(b=document.createRange(),I(b,F)&&u(b,H)&&(f=!0),b.detach());if((b=R(document,"body")?document.body:document.getElementsByTagName("body")[0])&&S(b,"createTextRange")){b=b.createTextRange(),P(b)&&(e=!0)}!f&&!e&&O("Neither Range nor TextRange are implemented");G.initialized=!0;G.features={implementsDomRange:f,implementsTextRange:e};f=v.concat(l);e=0;for(b=f.length;e<b;++e){try{f[e](G)}catch(c){R(window,"console")&&S(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",c)}}}}function L(b){this.name=b;this.supported=this.initialized=!1}var M="object",J="function",K="undefined",H="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer START_TO_START START_TO_END END_TO_START END_TO_END".split(" "),F="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),D="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),C="collapse compareEndPoints duplicate getBookmark moveToBookmark moveToElementText parentElement pasteHTML select setEndPoint getBoundingClientRect".split(" "),I=Q(S),B=Q(R),u=Q(T),G={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:S,isHostObject:R,isHostProperty:T,areHostMethods:I,areHostObjects:B,areHostProperties:u,isTextRange:P},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};G.fail=O;G.warn=function(b){b="Rangy warning: "+b;G.config.alertOnWarn?window.alert(b):typeof window.console!=K&&typeof window.console.log!=K&&window.console.log(b)};({}).hasOwnProperty?G.util.extend=function(e,d){for(var f in d){d.hasOwnProperty(f)&&(e[f]=d[f])}}:O("hasOwnProperty not supported");var l=[],v=[];G.init=N;G.addInitListener=function(b){G.initialized?b(G):l.push(b)};var t=[];G.addCreateMissingNativeApiListener=function(b){t.push(b)};G.createMissingNativeApi=function(e){e=e||window;N();for(var d=0,f=t.length;d<f;++d){t[d](e)}};L.prototype.fail=function(b){this.initialized=!0;this.supported=!1;throw Error("Module '"+this.name+"' failed to load: "+b)};L.prototype.warn=function(b){G.warn("Module "+this.name+": "+b)};L.prototype.createError=function(b){return Error("Error in Rangy "+this.name+" module: "+b)};G.createModule=function(e,d){var f=new L(e);G.modules[e]=f;v.push(function(b){d(b,f);f.initialized=!0;f.supported=!0})};G.requireModules=function(f){for(var e=0,j=f.length,i,g;e<j;++e){g=f[e];i=G.modules[g];if(!i||!(i instanceof L)){throw Error("Module '"+g+"' not found")}if(!i.supported){throw Error("Module '"+g+"' not supported")}}};var E=!1,B=function(){E||(E=!0,G.initialized||N())};if(typeof window==K){O("No window found")}else{if(typeof document==K){O("No document found")}else{return S(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",B,!1),S(window,"addEventListener")?window.addEventListener("load",B,!1):S(window,"attachEvent")?window.attachEvent("onload",B):O("Window does not have required addEventListener or attachEvent method"),G}}}();rangy.createModule("DomUtil",function(E,D){function F(d){for(var c=0;d=d.previousSibling;){c++}return c}function C(f,e){var h=[],g;for(g=f;g;g=g.parentNode){h.push(g)}for(g=e;g;g=g.parentNode){if(u(h,g)){return g}}return null}function B(e,d,f){for(f=f?e:e.parentNode;f;){e=f.parentNode;if(e===d){return f}f=e}return null}function A(b){b=b.nodeType;return 3==b||4==b||8==b}function z(f,e){var h=e.nextSibling,g=e.parentNode;h?g.insertBefore(f,h):g.appendChild(f);return f}function x(b){if(9==b.nodeType){return b}if(typeof b.ownerDocument!=s){return b.ownerDocument}if(typeof b.document!=s){return b.document}if(b.parentNode){return x(b.parentNode)}throw Error("getDocument: no document found for node")}function y(b){return !b?"[No node]":A(b)?'"'+b.data+'"':1==b.nodeType?"<"+b.nodeName+(b.id?' id="'+b.id+'"':"")+">["+b.childNodes.length+"]":b.nodeName}function v(b){this._next=this.root=b}function w(d,c){this.node=d;this.offset=c}function t(b){this.code=this[b];this.codeName=b;this.message="DOMException: "+this.codeName}var s="undefined",o=E.util;o.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||D.fail("document missing a Node creation method");o.isHostMethod(document,"getElementsByTagName")||D.fail("document missing getElementsByTagName method");var l=document.createElement("div");o.areHostMethods(l,["insertBefore","appendChild","cloneNode"])||D.fail("Incomplete Element implementation");o.isHostProperty(l,"innerHTML")||D.fail("Element is missing innerHTML property");l=document.createTextNode("test");o.areHostMethods(l,["splitText","deleteData","insertData","appendData","cloneNode"])||D.fail("Incomplete Text Node implementation");var u=function(e,d){for(var f=e.length;f--;){if(e[f]===d){return !0}}return !1};v.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var d=this._current=this._next,c;if(this._current){c=d.firstChild;if(!c){for(c=null;d!==this.root&&!(c=d.nextSibling);){d=d.parentNode}}this._next=c}return this._current},detach:function(){this._current=this._next=this.root=null}};w.prototype={equals:function(b){return this.node===b.node&this.offset==b.offset},inspect:function(){return"[DomPosition("+y(this.node)+":"+this.offset+")]"}};t.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};t.prototype.toString=function(){return this.message};E.dom={arrayContains:u,isHtmlNamespace:function(d){var c;return typeof d.namespaceURI==s||null===(c=d.namespaceURI)||"http://www.w3.org/1999/xhtml"==c},parentElement:function(b){b=b.parentNode;return 1==b.nodeType?b:null},getNodeIndex:F,getNodeLength:function(d){var c;return A(d)?d.length:(c=d.childNodes)?c.length:0},getCommonAncestor:C,isAncestorOf:function(e,d,f){for(d=f?d:d.parentNode;d;){if(d===e){return !0}d=d.parentNode}return !1},getClosestAncestorIn:B,isCharacterDataNode:A,insertAfter:z,splitDataNode:function(e,d){var f=e.cloneNode(!1);f.deleteData(0,d);e.deleteData(d,e.length-d);z(f,e);return f},getDocument:x,getWindow:function(b){b=x(b);if(typeof b.defaultView!=s){return b.defaultView}if(typeof b.parentWindow!=s){return b.parentWindow}throw Error("Cannot get a window object for node")},getIframeWindow:function(b){if(typeof b.contentWindow!=s){return b.contentWindow}if(typeof b.contentDocument!=s){return b.contentDocument.defaultView}throw Error("getIframeWindow: No Window object found for iframe element")},getIframeDocument:function(b){if(typeof b.contentDocument!=s){return b.contentDocument}if(typeof b.contentWindow!=s){return b.contentWindow.document}throw Error("getIframeWindow: No Document object found for iframe element")},getBody:function(b){return o.isHostObject(b,"body")?b.body:b.getElementsByTagName("body")[0]},getRootContainer:function(d){for(var c;c=d.parentNode;){d=c}return d},comparePoints:function(a,g,f,e){var d;if(a==f){return g===e?0:g<e?-1:1}if(d=B(f,a,!0)){return g<=F(d)?-1:1}if(d=B(a,f,!0)){return F(d)<e?-1:1}g=C(a,f);a=a===g?g:B(a,g,!0);f=f===g?g:B(f,g,!0);if(a===f){throw Error("comparePoints got to case 4 and childA and childB are the same!")}for(g=g.firstChild;g;){if(g===a){return -1}if(g===f){return 1}g=g.nextSibling}throw Error("Should not be here!")},inspectNode:y,fragmentFromNodeChildren:function(e){for(var d=x(e).createDocumentFragment(),f;f=e.firstChild;){d.appendChild(f)}return d},createIterator:function(b){return new v(b)},DomPosition:w};E.DOMException=t});rangy.createModule("DomRange",function(a3){function a2(d,c){return 3!=d.nodeType&&(aT.isAncestorOf(d,c.startContainer,!0)||aT.isAncestorOf(d,c.endContainer,!0))}function a4(b){return aT.getDocument(b.startContainer)}function a1(f,e,j){if(e=f._listeners[e]){for(var i=0,g=e.length;i<g;++i){e[i].call(f,{target:f,args:j})}}}function a0(b){return new aK(b.parentNode,aT.getNodeIndex(b))}function aZ(b){return new aK(b.parentNode,aT.getNodeIndex(b)+1)}function aY(f,e,h){var g=11==f.nodeType?f.firstChild:f;aT.isCharacterDataNode(e)?h==e.length?aT.insertAfter(f,e):e.parentNode.insertBefore(f,0==h?e:aT.splitDataNode(e,h)):h>=e.childNodes.length?e.appendChild(f):e.insertBefore(f,e.childNodes[h]);return g}function aW(a){for(var g,f,e=a4(a.range).createDocumentFragment();f=a.next();){g=a.isPartiallySelectedSubtree();f=f.cloneNode(!g);g&&(g=a.getSubtreeIterator(),f.appendChild(aW(g)),g.detach(!0));if(10==f.nodeType){throw new aA("HIERARCHY_REQUEST_ERR")}e.appendChild(f)}return e}function aX(g,f,j){for(var i,h,j=j||{stop:!1};i=g.next();){if(g.isPartiallySelectedSubtree()){if(!1===f(i)){j.stop=!0;break}else{if(i=g.getSubtreeIterator(),aX(i,f,j),i.detach(!0),j.stop){break}}}else{for(i=aT.createIterator(i);h=i.next();){if(!1===f(h)){j.stop=!0;return}}}}}function aU(d){for(var c;d.next();){d.isPartiallySelectedSubtree()?(c=d.getSubtreeIterator(),aU(c),c.detach(!0)):d.remove()}}function aV(a){for(var g,f=a4(a.range).createDocumentFragment(),e;g=a.next();){a.isPartiallySelectedSubtree()?(g=g.cloneNode(!1),e=a.getSubtreeIterator(),g.appendChild(aV(e)),e.detach(!0)):a.remove();if(10==g.nodeType){throw new aA("HIERARCHY_REQUEST_ERR")}f.appendChild(g)}return f}function aR(g,f,n){var m=!(!f||!f.length),l,i=!!n;m&&(l=RegExp("^("+f.join("|")+")$"));var h=[];aX(new aO(g,!1),function(b){(!m||l.test(b.nodeType))&&(!i||n(b))&&h.push(b)});return h}function aP(b){return"["+("undefined"==typeof b.getName?"Range":b.getName())+"("+aT.inspectNode(b.startContainer)+":"+b.startOffset+", "+aT.inspectNode(b.endContainer)+":"+b.endOffset+")]"}function aO(e,d){this.range=e;this.clonePartiallySelectedTextNodes=d;if(!e.collapsed){this.sc=e.startContainer;this.so=e.startOffset;this.ec=e.endContainer;this.eo=e.endOffset;var f=e.commonAncestorContainer;this.sc===this.ec&&aT.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc===f&&!aT.isCharacterDataNode(this.sc)?this.sc.childNodes[this.so]:aT.getClosestAncestorIn(this.sc,f,!0),this._last=this.ec===f&&!aT.isCharacterDataNode(this.ec)?this.ec.childNodes[this.eo-1]:aT.getClosestAncestorIn(this.ec,f,!0))}}function aN(b){this.code=this[b];this.codeName=b;this.message="RangeException: "+this.codeName}function aS(e,d,f){this.nodes=aR(e,d,f);this._next=this.nodes[0];this._position=0}function aM(b){return function(a,g){for(var f,e=g?a:a.parentNode;e;){f=e.nodeType;if(aT.arrayContains(b,f)){return e}e=e.parentNode}return null}}function aH(d,c){if(aD(d,c)){throw new aN("INVALID_NODE_TYPE_ERR")}}function aQ(b){if(!b.startContainer){throw new aA("INVALID_STATE_ERR")}}function aF(d,c){if(!aT.arrayContains(c,d.nodeType)){throw new aN("INVALID_NODE_TYPE_ERR")}}function aI(d,c){if(0>c||c>(aT.isCharacterDataNode(d)?d.length:d.childNodes.length)){throw new aA("INDEX_SIZE_ERR")}}function aG(d,c){if(am(d,!0)!==am(c,!0)){throw new aA("WRONG_DOCUMENT_ERR")}}function aB(b){if(aC(b,!0)){throw new aA("NO_MODIFICATION_ALLOWED_ERR")}}function aL(d,c){if(!d){throw new aA(c)}}function aJ(b){aQ(b);if(!aT.arrayContains(av,b.startContainer.nodeType)&&!am(b.startContainer,!0)||!aT.arrayContains(av,b.endContainer.nodeType)&&!am(b.endContainer,!0)||!(b.startOffset<=(aT.isCharacterDataNode(b.startContainer)?b.startContainer.length:b.startContainer.childNodes.length))||!(b.endOffset<=(aT.isCharacterDataNode(b.endContainer)?b.endContainer.length:b.endContainer.childNodes.length))){throw Error("Range error: Range is no longer valid after DOM mutation ("+b.inspect()+")")}}function ay(){}function aq(b){b.START_TO_START=ak;b.START_TO_END=ag;b.END_TO_END=a5;b.END_TO_START=af;b.NODE_BEFORE=ae;b.NODE_AFTER=ad;b.NODE_BEFORE_AND_AFTER=ac;b.NODE_INSIDE=aj}function aw(b){aq(b);aq(b.prototype)}function ax(d,c){return function(){aJ(this);var g=this.startContainer,f=this.startOffset,b=this.commonAncestorContainer,a=new aO(this,!0);g!==b&&(g=aT.getClosestAncestorIn(g,b,!0),f=aZ(g),g=f.node,f=f.offset);aX(a,aB);a.reset();b=d(a);a.detach();c(this,g,f,g,f);return b}}function at(b,j,e){function f(g,d){return function(a){aQ(this);aF(a,ap);aF(ao(a),av);a=(g?a0:aZ)(a);(d?c:k)(this,a.node,a.offset)}}function c(g,d,m){var i=g.endContainer,l=g.endOffset;if(d!==g.startContainer||m!==g.startOffset){if(ao(d)!=ao(i)||1==aT.comparePoints(d,m,i,l)){i=d,l=m}j(g,d,m,i,l)}}function k(g,d,m){var i=g.startContainer,l=g.startOffset;if(d!==g.endContainer||m!==g.endOffset){if(ao(d)!=ao(i)||-1==aT.comparePoints(d,m,i,l)){i=d,l=m}j(g,i,l,d,m)}}b.prototype=new ay;a3.util.extend(b.prototype,{setStart:function(g,d){aQ(this);aH(g,!0);aI(g,d);c(this,g,d)},setEnd:function(g,d){aQ(this);aH(g,!0);aI(g,d);k(this,g,d)},setStartBefore:f(!0,!0),setStartAfter:f(!1,!0),setEndBefore:f(!0,!1),setEndAfter:f(!1,!1),collapse:function(d){aJ(this);d?j(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):j(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(d){aQ(this);aH(d,!0);j(this,d,0,d,aT.getNodeLength(d))},selectNode:function(g){aQ(this);aH(g,!1);aF(g,ap);var d=a0(g),g=aZ(g);j(this,d.node,d.offset,g.node,g.offset)},extractContents:ax(aV,j),deleteContents:ax(aU,j),canSurroundContents:function(){aJ(this);aB(this.startContainer);aB(this.endContainer);var g=new aO(this,!0),d=g._first&&a2(g._first,this)||g._last&&a2(g._last,this);g.detach();return !d},detach:function(){e(this)},splitBoundaries:function(){aJ(this);var g=this.startContainer,d=this.startOffset,m=this.endContainer,i=this.endOffset,l=g===m;aT.isCharacterDataNode(m)&&(0<i&&i<m.length)&&aT.splitDataNode(m,i);aT.isCharacterDataNode(g)&&(0<d&&d<g.length)&&(g=aT.splitDataNode(g,d),l?(i-=d,m=g):m==g.parentNode&&i>=aT.getNodeIndex(g)&&i++,d=0);j(this,g,d,m,i)},normalizeBoundaries:function(){aJ(this);var g=this.startContainer,d=this.startOffset,o=this.endContainer,m=this.endOffset,n=function(p){var h=p.nextSibling;h&&h.nodeType==p.nodeType&&(o=p,m=p.length,p.appendData(h.data),h.parentNode.removeChild(h))},l=function(p){var h=p.previousSibling;if(h&&h.nodeType==p.nodeType){g=p;var a=p.length;d=h.length;p.insertData(0,h.data);h.parentNode.removeChild(h);g==o?(m+=d,o=g):o==p.parentNode&&(h=aT.getNodeIndex(p),m==h?(o=p,m=a):m>h&&m--)}},i=!0;aT.isCharacterDataNode(o)?o.length==m&&n(o):(0<m&&(i=o.childNodes[m-1])&&aT.isCharacterDataNode(i)&&n(i),i=!this.collapsed);i?aT.isCharacterDataNode(g)?0==d&&l(g):d<g.childNodes.length&&(n=g.childNodes[d])&&aT.isCharacterDataNode(n)&&l(n):(g=o,d=m);j(this,g,d,o,m)},collapseToPoint:function(g,d){aQ(this);aH(g,!0);aI(g,d);(g!==this.startContainer||d!==this.startOffset||g!==this.endContainer||d!==this.endOffset)&&j(this,g,d,g,d)}});aw(b)}function an(b){b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset;b.commonAncestorContainer=b.collapsed?b.startContainer:aT.getCommonAncestor(b.startContainer,b.endContainer)}function ar(f,d,n,l,m){var i=f.startContainer!==d||f.startOffset!==n,g=f.endContainer!==l||f.endOffset!==m;f.startContainer=d;f.startOffset=n;f.endContainer=l;f.endOffset=m;an(f);a1(f,"boundarychange",{startMoved:i,endMoved:g})}function az(b){this.startContainer=b;this.startOffset=0;this.endContainer=b;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};an(this)}a3.requireModules(["DomUtil"]);var aT=a3.dom,aK=aT.DomPosition,aA=a3.DOMException;aO.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var b=this._current=this._next;b&&(this._next=b!==this._last?b.nextSibling:null,aT.isCharacterDataNode(b)&&this.clonePartiallySelectedTextNodes&&(b===this.ec&&(b=b.cloneNode(!0)).deleteData(this.eo,b.length-this.eo),this._current===this.sc&&(b=b.cloneNode(!0)).deleteData(0,this.so)));return b},remove:function(){var e=this._current,d,f;aT.isCharacterDataNode(e)&&(e===this.sc||e===this.ec)?(d=e===this.sc?this.so:0,f=e===this.ec?this.eo:e.length,d!=f&&e.deleteData(d,f-d)):e.parentNode&&e.parentNode.removeChild(e)},isPartiallySelectedSubtree:function(){return a2(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode){a=this.range.cloneRange(),a.collapse()}else{a=new az(a4(this.range));var l=this._current,k=l,g=0,i=l,f=aT.getNodeLength(l);aT.isAncestorOf(l,this.sc,!0)&&(k=this.sc,g=this.so);aT.isAncestorOf(l,this.ec,!0)&&(i=this.ec,f=this.eo);ar(a,k,g,i,f)}return new aO(a,this.clonePartiallySelectedTextNodes)},detach:function(b){b&&this.range.detach();this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};aN.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};aN.prototype.toString=function(){return this.message};aS.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var ap=[1,3,4,5,7,8,10],av=[2,9,11],al=[1,3,4,5,7,8,10,11],au=[1,3,4,5,7,8],ao=aT.getRootContainer,am=aM([9,11]),aC=aM([5,6,10,12]),aD=aM([6,10,12]),ab=document.createElement("style"),ai=!1;try{ab.innerHTML="<b>x</b>",ai=3==ab.firstChild.nodeType}catch(aE){}a3.features.htmlParsingConforms=ai;var ah="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),ak=0,ag=1,a5=2,af=3,ae=0,ad=1,ac=2,aj=3;ay.prototype={attachListener:function(d,c){this._listeners[d].push(c)},compareBoundaryPoints:function(f,e){aJ(this);aG(this.startContainer,e.startContainer);var h=f==af||f==ak?"start":"end",g=f==ag||f==ak?"start":"end";return aT.comparePoints(this[h+"Container"],this[h+"Offset"],e[g+"Container"],e[g+"Offset"])},insertNode:function(b){aJ(this);aF(b,al);aB(this.startContainer);if(aT.isAncestorOf(b,this.startContainer,!0)){throw new aA("HIERARCHY_REQUEST_ERR")}this.setStartBefore(aY(b,this.startContainer,this.startOffset))},cloneContents:function(){aJ(this);var a,d;if(this.collapsed){return a4(this).createDocumentFragment()}if(this.startContainer===this.endContainer&&aT.isCharacterDataNode(this.startContainer)){return a=this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),d=a4(this).createDocumentFragment(),d.appendChild(a),d}d=new aO(this,!0);a=aW(d);d.detach();return a},canSurroundContents:function(){aJ(this);aB(this.startContainer);aB(this.endContainer);var d=new aO(this,!0),c=d._first&&a2(d._first,this)||d._last&&a2(d._last,this);d.detach();return !c},surroundContents:function(d){aF(d,au);if(!this.canSurroundContents()){throw new aN("BAD_BOUNDARYPOINTS_ERR")}var c=this.extractContents();if(d.hasChildNodes()){for(;d.lastChild;){d.removeChild(d.lastChild)}}aY(d,this.startContainer,this.startOffset);d.appendChild(c);this.selectNode(d)},cloneRange:function(){aJ(this);for(var a=new az(a4(this)),f=ah.length,e;f--;){e=ah[f],a[e]=this[e]}return a},toString:function(){aJ(this);var d=this.startContainer;if(d===this.endContainer&&aT.isCharacterDataNode(d)){return 3==d.nodeType||4==d.nodeType?d.data.slice(this.startOffset,this.endOffset):""}var c=[],d=new aO(this,!0);aX(d,function(b){(3==b.nodeType||4==b.nodeType)&&c.push(b.data)});d.detach();return c.join("")},compareNode:function(e){aJ(this);var d=e.parentNode,f=aT.getNodeIndex(e);if(!d){throw new aA("NOT_FOUND_ERR")}e=this.comparePoint(d,f);d=this.comparePoint(d,f+1);return 0>e?0<d?ac:ae:0<d?ad:aj},comparePoint:function(d,c){aJ(this);aL(d,"HIERARCHY_REQUEST_ERR");aG(d,this.startContainer);return 0>aT.comparePoints(d,c,this.startContainer,this.startOffset)?-1:0<aT.comparePoints(d,c,this.endContainer,this.endOffset)?1:0},createContextualFragment:ai?function(f){var e=this.startContainer,h=aT.getDocument(e);if(!e){throw new aA("INVALID_STATE_ERR")}var g=null;1==e.nodeType?g=e:aT.isCharacterDataNode(e)&&(g=aT.parentElement(e));g=null===g||"HTML"==g.nodeName&&aT.isHtmlNamespace(aT.getDocument(g).documentElement)&&aT.isHtmlNamespace(g)?h.createElement("body"):g.cloneNode(!1);g.innerHTML=f;return aT.fragmentFromNodeChildren(g)}:function(a){aQ(this);var d=a4(this).createElement("body");d.innerHTML=a;return aT.fragmentFromNodeChildren(d)},toHtml:function(){aJ(this);var a=a4(this).createElement("div");a.appendChild(this.cloneContents());return a.innerHTML},intersectsNode:function(a,j){aJ(this);aL(a,"NOT_FOUND_ERR");if(aT.getDocument(a)!==a4(this)){return !1}var i=a.parentNode,f=aT.getNodeIndex(a);aL(i,"NOT_FOUND_ERR");var g=aT.comparePoints(i,f,this.endContainer,this.endOffset),i=aT.comparePoints(i,f+1,this.startContainer,this.startOffset);return j?0>=g&&0<=i:0>g&&0<i},isPointInRange:function(d,c){aJ(this);aL(d,"HIERARCHY_REQUEST_ERR");aG(d,this.startContainer);return 0<=aT.comparePoints(d,c,this.startContainer,this.startOffset)&&0>=aT.comparePoints(d,c,this.endContainer,this.endOffset)},intersectsRange:function(a,g){aJ(this);if(a4(a)!=a4(this)){throw new aA("WRONG_DOCUMENT_ERR")}var f=aT.comparePoints(this.startContainer,this.startOffset,a.endContainer,a.endOffset),e=aT.comparePoints(this.endContainer,this.endOffset,a.startContainer,a.startOffset);return g?0>=f&&0<=e:0>f&&0<e},intersection:function(f){if(this.intersectsRange(f)){var e=aT.comparePoints(this.startContainer,this.startOffset,f.startContainer,f.startOffset),h=aT.comparePoints(this.endContainer,this.endOffset,f.endContainer,f.endOffset),g=this.cloneRange();-1==e&&g.setStart(f.startContainer,f.startOffset);1==h&&g.setEnd(f.endContainer,f.endOffset);return g}return null},union:function(d){if(this.intersectsRange(d,!0)){var c=this.cloneRange();-1==aT.comparePoints(d.startContainer,d.startOffset,this.startContainer,this.startOffset)&&c.setStart(d.startContainer,d.startOffset);1==aT.comparePoints(d.endContainer,d.endOffset,this.endContainer,this.endOffset)&&c.setEnd(d.endContainer,d.endOffset);return c}throw new aN("Ranges do not intersect")},containsNode:function(d,c){return c?this.intersectsNode(d,!1):this.compareNode(d)==aj},containsNodeContents:function(b){return 0<=this.comparePoint(b,0)&&0>=this.comparePoint(b,aT.getNodeLength(b))},containsRange:function(b){return this.intersection(b).equals(b)},containsNodeText:function(e){var d=this.cloneRange();d.selectNode(e);var f=d.getNodes([3]);return 0<f.length?(d.setStart(f[0],0),e=f.pop(),d.setEnd(e,e.length),e=this.containsRange(d),d.detach(),e):this.containsNodeContents(e)},createNodeIterator:function(d,c){aJ(this);return new aS(this,d,c)},getNodes:function(d,c){aJ(this);return aR(this,d,c)},getDocument:function(){return a4(this)},collapseBefore:function(b){aQ(this);this.setEndBefore(b);this.collapse(!1)},collapseAfter:function(b){aQ(this);this.setStartAfter(b);this.collapse(!0)},getName:function(){return"DomRange"},equals:function(b){return az.rangesEqual(this,b)},inspect:function(){return aP(this)}};at(az,ar,function(b){aQ(b);b.startContainer=b.startOffset=b.endContainer=b.endOffset=null;b.collapsed=b.commonAncestorContainer=null;a1(b,"detach",null);b._listeners=null});a3.rangePrototype=ay.prototype;az.rangeProperties=ah;az.RangeIterator=aO;az.copyComparisonConstants=aw;az.createPrototypeRange=at;az.inspect=aP;az.getRangeDocument=a4;az.rangesEqual=function(d,c){return d.startContainer===c.startContainer&&d.startOffset===c.startOffset&&d.endContainer===c.endContainer&&d.endOffset===c.endOffset};a3.DomRange=az;a3.RangeException=aN});rangy.createModule("WrappedRange",function(h){function p(q,f,w,v){var u=q.duplicate();u.collapse(w);var s=u.parentElement();n.isAncestorOf(f,s,!0)||(s=f);if(!s.canHaveHTML){return new m(s.parentNode,n.getNodeIndex(s))}var f=n.getDocument(s).createElement("span"),t,e=w?"StartToStart":"StartToEnd";do{s.insertBefore(f,f.previousSibling),u.moveToElementText(f)}while(0<(t=u.compareEndPoints(e,q))&&f.previousSibling);e=f.nextSibling;if(-1==t&&e&&n.isCharacterDataNode(e)){u.setEndPoint(w?"EndToStart":"EndToEnd",q);if(/[\r\n]/.test(e.data)){s=u.duplicate();w=s.text.replace(/\r\n/g,"\r").length;for(w=s.moveStart("character",w);-1==s.compareEndPoints("StartToEnd",s);){w++,s.moveStart("character",1)}}else{w=u.text.length}s=new m(e,w)}else{e=(v||!w)&&f.previousSibling,s=(w=(v||w)&&f.nextSibling)&&n.isCharacterDataNode(w)?new m(w,0):e&&n.isCharacterDataNode(e)?new m(e,e.length):new m(s,n.getNodeIndex(f))}f.parentNode.removeChild(f);return s}function j(r,q){var w,v,u=r.offset,t=n.getDocument(r.node),s=t.body.createTextRange(),e=n.isCharacterDataNode(r.node);e?(w=r.node,v=w.parentNode):(w=r.node.childNodes,w=u<w.length?w[u]:null,v=r.node);t=t.createElement("span");t.innerHTML="&#feff;";w?v.insertBefore(t,w):v.appendChild(t);s.moveToElementText(t);s.collapse(!q);v.removeChild(t);if(e){s[q?"moveStart":"moveEnd"]("character",u)}return s}h.requireModules(["DomUtil","DomRange"]);var o,n=h.dom,m=n.DomPosition,l=h.DomRange;if(h.features.implementsDomRange&&(!h.features.implementsTextRange||!h.config.preferTextRange)){(function(){function b(a){for(var i=d.length,f;i--;){f=d[i],a[f]=a.nativeRange[f]}}var u,d=l.rangeProperties,t;o=function(a){if(!a){throw Error("Range must be specified")}this.nativeRange=a;b(this)};l.createPrototypeRange(o,function(i,f,w,v,q){var r=i.endContainer!==v||i.endOffset!=q;if(i.startContainer!==f||i.startOffset!=w||r){i.setEnd(v,q),i.setStart(f,w)}},function(i){i.nativeRange.detach();i.detached=!0;for(var f=d.length,q;f--;){q=d[f],i[q]=null}});u=o.prototype;u.selectNode=function(a){this.nativeRange.selectNode(a);b(this)};u.deleteContents=function(){this.nativeRange.deleteContents();b(this)};u.extractContents=function(){var a=this.nativeRange.extractContents();b(this);return a};u.cloneContents=function(){return this.nativeRange.cloneContents()};u.surroundContents=function(a){this.nativeRange.surroundContents(a);b(this)};u.collapse=function(a){this.nativeRange.collapse(a);b(this)};u.cloneRange=function(){return new o(this.nativeRange.cloneRange())};u.refresh=function(){b(this)};u.toString=function(){return this.nativeRange.toString()};var e=document.createTextNode("test");n.getBody(document).appendChild(e);var s=document.createRange();s.setStart(e,0);s.setEnd(e,0);try{s.setStart(e,1),u.setStart=function(a,f){this.nativeRange.setStart(a,f);b(this)},u.setEnd=function(a,f){this.nativeRange.setEnd(a,f);b(this)},t=function(a){return function(f){this.nativeRange[a](f);b(this)}}}catch(g){u.setStart=function(a,i){try{this.nativeRange.setStart(a,i)}catch(f){this.nativeRange.setEnd(a,i),this.nativeRange.setStart(a,i)}b(this)},u.setEnd=function(a,i){try{this.nativeRange.setEnd(a,i)}catch(f){this.nativeRange.setStart(a,i),this.nativeRange.setEnd(a,i)}b(this)},t=function(a,f){return function(i){try{this.nativeRange[a](i)}catch(c){this.nativeRange[f](i),this.nativeRange[a](i)}b(this)}}}u.setStartBefore=t("setStartBefore","setEndBefore");u.setStartAfter=t("setStartAfter","setEndAfter");u.setEndBefore=t("setEndBefore","setStartBefore");u.setEndAfter=t("setEndAfter","setStartAfter");s.selectNodeContents(e);u.selectNodeContents=s.startContainer==e&&s.endContainer==e&&0==s.startOffset&&s.endOffset==e.length?function(a){this.nativeRange.selectNodeContents(a);b(this)}:function(c){this.setStart(c,0);this.setEnd(c,l.getEndOffset(c))};s.selectNodeContents(e);s.setEnd(e,3);t=document.createRange();t.selectNodeContents(e);t.setEnd(e,4);t.setStart(e,2);u.compareBoundaryPoints=-1==s.compareBoundaryPoints(s.START_TO_END,t)&1==s.compareBoundaryPoints(s.END_TO_START,t)?function(f,c){c=c.nativeRange||c;f==c.START_TO_END?f=c.END_TO_START:f==c.END_TO_START&&(f=c.START_TO_END);return this.nativeRange.compareBoundaryPoints(f,c)}:function(f,c){return this.nativeRange.compareBoundaryPoints(f,c.nativeRange||c)};h.util.isHostMethod(s,"createContextualFragment")&&(u.createContextualFragment=function(c){return this.nativeRange.createContextualFragment(c)});n.getBody(document).removeChild(e);s.detach();t.detach()})(),h.createNativeRange=function(b){b=b||document;return b.createRange()}}else{if(h.features.implementsTextRange){o=function(b){this.textRange=b;this.refresh()};o.prototype=new l(document);o.prototype.refresh=function(){var e,c,i=this.textRange;e=i.parentElement();var g=i.duplicate();g.collapse(!0);c=g.parentElement();g=i.duplicate();g.collapse(!1);i=g.parentElement();c=c==i?c:n.getCommonAncestor(c,i);c=c==e?c:n.getCommonAncestor(e,c);0==this.textRange.compareEndPoints("StartToEnd",this.textRange)?c=e=p(this.textRange,c,!0,!0):(e=p(this.textRange,c,!0,!1),c=p(this.textRange,c,!1,!1));this.setStart(e.node,e.offset);this.setEnd(c.node,c.offset)};l.copyComparisonConstants(o);var k=function(){return this}();"undefined"==typeof k.Range&&(k.Range=o);h.createNativeRange=function(b){b=b||document;return b.body.createTextRange()}}}h.features.implementsTextRange&&(o.rangeToTextRange=function(a){if(a.collapsed){return j(new m(a.startContainer,a.startOffset),!0)}var f=j(new m(a.startContainer,a.startOffset),!0),e=j(new m(a.endContainer,a.endOffset),!1),a=n.getDocument(a.startContainer).body.createTextRange();a.setEndPoint("StartToStart",f);a.setEndPoint("EndToEnd",e);return a});o.prototype.getName=function(){return"WrappedRange"};h.WrappedRange=o;h.createRange=function(b){b=b||document;return new o(h.createNativeRange(b))};h.createRangyRange=function(b){b=b||document;return new l(b)};h.createIframeRange=function(b){return h.createRange(n.getIframeDocument(b))};h.createIframeRangyRange=function(b){return h.createRangyRange(n.getIframeDocument(b))};h.addCreateMissingNativeApiListener(function(b){b=b.document;if(typeof b.createRange=="undefined"){b.createRange=function(){return h.createRange(this)}}b=b=null})});rangy.createModule("WrappedSelection",function(aB,aA){function aC(b){return(b||window).getSelection()}function az(b){return(b||window).document.selection}function ay(f,e,h){var g=h?"end":"start",h=h?"start":"end";f.anchorNode=e[g+"Container"];f.anchorOffset=e[g+"Offset"];f.focusNode=e[h+"Container"];f.focusOffset=e[h+"Offset"]}function ax(b){b.anchorNode=b.focusNode=null;b.anchorOffset=b.focusOffset=0;b.rangeCount=0;b.isCollapsed=!0;b._ranges.length=0}function aw(b){var d;b instanceof ae?(d=b._selectionNativeRange,d||(d=aB.createNativeRange(ap.getDocument(b.startContainer)),d.setEnd(b.endContainer,b.endOffset),d.setStart(b.startContainer,b.startOffset),b._selectionNativeRange=d,b.attachListener("detach",function(){this._selectionNativeRange=null}))):b instanceof an?d=b.nativeRange:aB.features.implementsDomRange&&b instanceof ap.getWindow(b.startContainer).Range&&(d=b);return d}function au(f){var e=f.getNodes(),h;f:if(!e.length||1!=e[0].nodeType){h=!1}else{h=1;for(var g=e.length;h<g;++h){if(!ap.isAncestorOf(e[0],e[h])){h=!1;break f}}h=!0}if(!h){throw Error("getSingleElementFromRange: range "+f.inspect()+" did not consist of a single element")}return e[0]}function av(e,d){var f=new an(d);e._ranges=[f];ay(e,f,!1);e.rangeCount=1;e.isCollapsed=f.collapsed}function ar(b){b._ranges.length=0;if("None"==b.docSelection.type){ax(b)}else{var h=b.docSelection.createRange();if(h&&"undefined"!=typeof h.text){av(b,h)}else{b.rangeCount=h.length;for(var g,f=ap.getDocument(h.item(0)),e=0;e<b.rangeCount;++e){g=aB.createRange(f),g.selectNode(h.item(e)),b._ranges.push(g)}b.isCollapsed=1==b.rangeCount&&b._ranges[0].collapsed;ay(b,b._ranges[b.rangeCount-1],!1)}}}function at(i,g){for(var p=i.docSelection.createRange(),o=au(g),n=ap.getDocument(p.item(0)),n=ap.getBody(n).createControlRange(),l=0,k=p.length;l<k;++l){n.add(p.item(l))}try{n.add(o)}catch(m){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}n.select();ar(i)}function ao(e,d,f){this.nativeSelection=e;this.docSelection=d;this._ranges=[];this.win=f;this.refresh()}function am(g,f){for(var l=ap.getDocument(f[0].startContainer),l=ap.getBody(l).createControlRange(),k=0,j;k<rangeCount;++k){j=au(f[k]);try{l.add(j)}catch(i){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}l.select();ar(g)}function al(d,c){if(d.anchorNode&&ap.getDocument(d.anchorNode)!==ap.getDocument(c)){throw new ac("WRONG_DOCUMENT_ERR")}}function ak(g){var f=[],n=new af(g.anchorNode,g.anchorOffset),m=new af(g.focusNode,g.focusOffset),l="function"==typeof g.getName?g.getName():"Selection";if("undefined"!=typeof g.rangeCount){for(var k=0,i=g.rangeCount;k<i;++k){f[k]=ae.inspect(g.getRangeAt(k))}}return"["+l+"(Ranges: "+f.join(", ")+")(anchor: "+n.inspect()+", focus: "+m.inspect()+"]"}aB.requireModules(["DomUtil","DomRange","WrappedRange"]);aB.config.checkSelectionRanges=!0;var ap=aB.dom,aj=aB.util,ae=aB.DomRange,an=aB.WrappedRange,ac=aB.DOMException,af=ap.DomPosition,ad,ab,ai=aB.util.isHostMethod(window,"getSelection"),ag=aB.util.isHostObject(document,"selection"),Y=ag&&(!ai||aB.config.preferTextRange);Y?(ad=az,aB.isSelectionValid=function(d){var d=(d||window).document,c=d.selection;return"None"!=c.type||ap.getDocument(c.createRange().parentElement())==d}):ai?(ad=aC,aB.isSelectionValid=function(){return !0}):aA.fail("Neither document.selection or window.getSelection() detected.");aB.getNativeSelection=ad;var ai=ad(),R=aB.createNativeRange(document),W=ap.getBody(document),X=aj.areHostObjects(ai,aj.areHostProperties(ai,["anchorOffset","focusOffset"]));aB.features.selectionHasAnchorAndFocus=X;var T=aj.isHostMethod(ai,"extend");aB.features.selectionHasExtend=T;var O="number"==typeof ai.rangeCount;aB.features.selectionHasRangeCount=O;var S=!1,Z=!0;aj.areHostMethods(ai,["addRange","getRangeAt","removeAllRanges"])&&("number"==typeof ai.rangeCount&&aB.features.implementsDomRange)&&function(){var g=document.createElement("iframe");W.appendChild(g);var f=ap.getIframeDocument(g);f.open();f.write("<html><head></head><body>12</body></html>");f.close();var j=ap.getIframeWindow(g).getSelection(),i=f.documentElement.lastChild.firstChild,f=f.createRange();f.setStart(i,1);f.collapse(true);j.addRange(f);Z=j.rangeCount==1;j.removeAllRanges();var h=f.cloneRange();f.setStart(i,0);h.setEnd(i,2);j.addRange(f);j.addRange(h);S=j.rangeCount==2;f.detach();h.detach();W.removeChild(g)}();aB.features.selectionSupportsMultipleRanges=S;aB.features.collapsedNonEditableSelectionsSupported=Z;var aq=!1,ah;W&&aj.isHostMethod(W,"createControlRange")&&(ah=W.createControlRange(),aj.areHostProperties(ah,["item","add"])&&(aq=!0));aB.features.implementsControlRange=aq;ab=X?function(b){return b.anchorNode===b.focusNode&&b.anchorOffset===b.focusOffset}:function(b){return b.rangeCount?b.getRangeAt(b.rangeCount-1).collapsed:false};var aa;aj.isHostMethod(ai,"getRangeAt")?aa=function(e,d){try{return e.getRangeAt(d)}catch(f){return null}}:X&&(aa=function(b){var d=ap.getDocument(b.anchorNode),d=aB.createRange(d);d.setStart(b.anchorNode,b.anchorOffset);d.setEnd(b.focusNode,b.focusOffset);if(d.collapsed!==this.isCollapsed){d.setStart(b.focusNode,b.focusOffset);d.setEnd(b.anchorNode,b.anchorOffset)}return d});aB.getSelection=function(f){var f=f||window,d=f._rangySelection,h=ad(f),g=ag?az(f):null;if(d){d.nativeSelection=h;d.docSelection=g;d.refresh(f)}else{d=new ao(h,g,f);f._rangySelection=d}return d};aB.getIframeSelection=function(b){return aB.getSelection(ap.getIframeWindow(b))};ah=ao.prototype;if(!Y&&X&&aj.areHostMethods(ai,["removeAllRanges","addRange"])){ah.removeAllRanges=function(){this.nativeSelection.removeAllRanges();ax(this)};var Q=function(b,f){var e=ae.getRangeDocument(f),e=aB.createRange(e);e.collapseToPoint(f.endContainer,f.endOffset);b.nativeSelection.addRange(aw(e));b.nativeSelection.extend(f.startContainer,f.startOffset);b.refresh()};ah.addRange=O?function(b,f){if(aq&&ag&&this.docSelection.type=="Control"){at(this,b)}else{if(f&&T){Q(this,b)}else{var e;if(S){e=this.rangeCount}else{this.removeAllRanges();e=0}this.nativeSelection.addRange(aw(b));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==e+1){if(aB.config.checkSelectionRanges){(e=aa(this.nativeSelection,this.rangeCount-1))&&!ae.rangesEqual(e,b)&&(b=new an(e))}this._ranges[this.rangeCount-1]=b;ay(this,b,U(this.nativeSelection));this.isCollapsed=ab(this)}else{this.refresh()}}}}:function(d,c){if(c&&T){Q(this,d)}else{this.nativeSelection.addRange(aw(d));this.refresh()}};ah.setRanges=function(e){if(aq&&e.length>1){am(this,e)}else{this.removeAllRanges();for(var d=0,f=e.length;d<f;++d){this.addRange(e[d])}}}}else{if(aj.isHostMethod(ai,"empty")&&aj.isHostMethod(R,"select")&&aq&&Y){ah.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var e;if(this.anchorNode){e=ap.getDocument(this.anchorNode)}else{if(this.docSelection.type=="Control"){var d=this.docSelection.createRange();d.length&&(e=ap.getDocument(d.item(0)).body.createTextRange())}}if(e){e.body.createTextRange().select();this.docSelection.empty()}}}catch(f){}ax(this)},ah.addRange=function(b){if(this.docSelection.type=="Control"){at(this,b)}else{an.rangeToTextRange(b).select();this._ranges[0]=b;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;ay(this,b,false)}},ah.setRanges=function(d){this.removeAllRanges();var c=d.length;c>1?am(this,d):c&&this.addRange(d[0])}}else{return aA.fail("No means of selecting a Range or TextRange was found"),!1}}ah.getRangeAt=function(b){if(b<0||b>=this.rangeCount){throw new ac("INDEX_SIZE_ERR")}return this._ranges[b]};var V;if(Y){V=function(b){var d;if(aB.isSelectionValid(b.win)){d=b.docSelection.createRange()}else{d=ap.getBody(b.win.document).createTextRange();d.collapse(true)}b.docSelection.type=="Control"?ar(b):d&&typeof d.text!="undefined"?av(b,d):ax(b)}}else{if(aj.isHostMethod(ai,"getRangeAt")&&"number"==typeof ai.rangeCount){V=function(b){if(aq&&ag&&b.docSelection.type=="Control"){ar(b)}else{b._ranges.length=b.rangeCount=b.nativeSelection.rangeCount;if(b.rangeCount){for(var f=0,e=b.rangeCount;f<e;++f){b._ranges[f]=new aB.WrappedRange(b.nativeSelection.getRangeAt(f))}ay(b,b._ranges[b.rangeCount-1],U(b.nativeSelection));b.isCollapsed=ab(b)}else{ax(b)}}}}else{if(X&&"boolean"==typeof ai.isCollapsed&&"boolean"==typeof R.collapsed&&aB.features.implementsDomRange){V=function(d){var c;c=d.nativeSelection;if(c.anchorNode){c=aa(c,0);d._ranges=[c];d.rangeCount=1;c=d.nativeSelection;d.anchorNode=c.anchorNode;d.anchorOffset=c.anchorOffset;d.focusNode=c.focusNode;d.focusOffset=c.focusOffset;d.isCollapsed=ab(d)}else{ax(d)}}}else{return aA.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1}}}ah.refresh=function(d){var c=d?this._ranges.slice(0):null;V(this);if(d){d=c.length;if(d!=this._ranges.length){return false}for(;d--;){if(!ae.rangesEqual(c[d],this._ranges[d])){return false}}return true}};var M=function(g,f){var l=g.getAllRanges(),k=false;g.removeAllRanges();for(var j=0,i=l.length;j<i;++j){k||f!==l[j]?g.addRange(l[j]):k=true}g.rangeCount||ax(g)};ah.removeRange=aq?function(g){if(this.docSelection.type=="Control"){for(var f=this.docSelection.createRange(),g=au(g),n=ap.getDocument(f.item(0)),n=ap.getBody(n).createControlRange(),m,l=false,k=0,i=f.length;k<i;++k){m=f.item(k);m!==g||l?n.add(f.item(k)):l=true}n.select();ar(this)}else{M(this,g)}}:function(b){M(this,b)};var U;!Y&&X&&aB.features.implementsDomRange?(U=function(d){var c=false;d.anchorNode&&(c=ap.comparePoints(d.anchorNode,d.anchorOffset,d.focusNode,d.focusOffset)==1);return c},ah.isBackwards=function(){return U(this)}):U=ah.isBackwards=function(){return false};ah.toString=function(){for(var e=[],d=0,f=this.rangeCount;d<f;++d){e[d]=""+this._ranges[d]}return e.join("")};ah.collapse=function(b,f){al(this,b);var e=aB.createRange(ap.getDocument(b));e.collapseToPoint(b,f);this.removeAllRanges();this.addRange(e);this.isCollapsed=true};ah.collapseToStart=function(){if(this.rangeCount){var b=this._ranges[0];this.collapse(b.startContainer,b.startOffset)}else{throw new ac("INVALID_STATE_ERR")}};ah.collapseToEnd=function(){if(this.rangeCount){var b=this._ranges[this.rangeCount-1];this.collapse(b.endContainer,b.endOffset)}else{throw new ac("INVALID_STATE_ERR")}};ah.selectAllChildren=function(b){al(this,b);var d=aB.createRange(ap.getDocument(b));d.selectNodeContents(b);this.removeAllRanges();this.addRange(d)};ah.deleteFromDocument=function(){if(aq&&ag&&this.docSelection.type=="Control"){for(var e=this.docSelection.createRange(),d;e.length;){d=e.item(0);e.remove(d);d.parentNode.removeChild(d)}this.refresh()}else{if(this.rangeCount){e=this.getAllRanges();this.removeAllRanges();d=0;for(var f=e.length;d<f;++d){e[d].deleteContents()}this.addRange(e[f-1])}}};ah.getAllRanges=function(){return this._ranges.slice(0)};ah.setSingleRange=function(b){this.setRanges([b])};ah.containsNode=function(f,e){for(var h=0,g=this._ranges.length;h<g;++h){if(this._ranges[h].containsNode(f,e)){return true}}return false};ah.toHtml=function(){var e="";if(this.rangeCount){for(var e=ae.getRangeDocument(this._ranges[0]).createElement("div"),d=0,f=this._ranges.length;d<f;++d){e.appendChild(this._ranges[d].cloneContents())}e=e.innerHTML}return e};ah.getName=function(){return"WrappedSelection"};ah.inspect=function(){return ak(this)};ah.detach=function(){this.win=this.anchorNode=this.focusNode=this.win._rangySelection=null};ao.inspect=ak;aB.Selection=ao;aB.selectionPrototype=ah;aB.addCreateMissingNativeApiListener(function(b){if(typeof b.getSelection=="undefined"){b.getSelection=function(){return aB.getSelection(this)}}b=null})});var Base=function(){};Base.extend=function(g,l){var h=Base.prototype.extend;Base._prototyping=!0;var k=new this;h.call(k,g);k.base=function(){};delete Base._prototyping;var j=k.constructor,i=k.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==i){this._constructing=!0,j.apply(this,arguments),delete this._constructing}else{if(null!=arguments[0]){return(arguments[0].extend||h).call(arguments[0],k)}}}};i.ancestor=this;i.extend=this.extend;i.forEach=this.forEach;i.implement=this.implement;i.prototype=k;i.toString=this.toString;i.valueOf=function(b){return"object"==b?i:j.valueOf()};h.call(i,l);"function"==typeof i.init&&i.init();return i};Base.prototype={extend:function(q,p){if(1<arguments.length){var r=this[q];if(r&&"function"==typeof p&&(!r.valueOf||r.valueOf()!=p.valueOf())&&/\bbase\b/.test(p)){var o=p.valueOf(),p=function(){var a=this.base||Base.prototype.base;this.base=r;var d=o.apply(this,arguments);this.base=a;return d};p.valueOf=function(b){return"object"==b?p:o};p.toString=Base.toString}this[q]=p}else{if(q){var n=Base.prototype.extend;!Base._prototyping&&"function"!=typeof this&&(n=this.extend||n);for(var m={toSource:null},l=["constructor","toString","valueOf"],j=Base._prototyping?0:1;k=l[j++];){q[k]!=m[k]&&n.call(this,k,q[k])}for(var k in q){m[k]||n.call(this,k,q[k])}}}return this}};Base=Base.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(e,h,f){for(var g in e){void 0===this.prototype[g]&&h.call(f,e[g],g,e)}},implement:function(){for(var a=0;a<arguments.length;a++){if("function"==typeof arguments[a]){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return""+this.valueOf()}});wysihtml5.browser=function(){var h=navigator.userAgent,n=document.createElement("div"),i=-1!==h.indexOf("MSIE")&&-1===h.indexOf("Opera"),m=-1!==h.indexOf("Gecko")&&-1===h.indexOf("KHTML"),l=-1!==h.indexOf("AppleWebKit/"),k=-1!==h.indexOf("Chrome/"),j=-1!==h.indexOf("Opera/");return{USER_AGENT:h,supported:function(){var f=this.USER_AGENT.toLowerCase(),c="contentEditable" in n,o=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,g=document.querySelector&&document.querySelectorAll,f=this.isIos()&&5>(/ipad|iphone|ipod/.test(f)&&f.match(/ os (\d+).+? like mac os x/)||[,0])[1]||-1!==f.indexOf("opera mobi")||-1!==f.indexOf("hpwos/");return c&&o&&g&&!f},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var b=this.USER_AGENT.toLowerCase();return -1!==b.indexOf("webkit")&&-1!==b.indexOf("mobile")},supportsSandboxedIframes:function(){return i},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return !("querySelector" in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return !m},hasCurrentStyleProperty:function(){return"currentStyle" in n},insertsLineBreaksOnReturn:function(){return m},supportsPlaceholderAttributeOn:function(b){return"placeholder" in b},supportsEvent:function(d){var c;if(!(c="on"+d in n)){n.setAttribute("on"+d,"return;"),c="function"===typeof n["on"+d]}return c},supportsEventsInIframeCorrectly:function(){return !j},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return l||m},supportsDataTransfer:function(){try{return l&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(b){return !1}},supportsHTML5Tags:function(b){b=b.createElement("div");b.innerHTML="<article>foo</article>";return"<article>foo</article>"===b.innerHTML.toLowerCase()},supportsCommand:function(){var a={formatBlock:i,insertUnorderedList:i||j||l,insertOrderedList:i||j||l},d={insertHTML:m};return function(b,o){if(!a[o]){try{return b.queryCommandSupported(o)}catch(g){}try{return b.queryCommandEnabled(o)}catch(c){return !!d[o]}}return !1}}(),doesAutoLinkingInContentEditable:function(){return i},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return m||j||l},supportsGetAttributeCorrectly:function(){return"1"!=document.createElement("td").getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return m||i||j},clearsListsInContentEditableCorrectly:function(){return m||i||l},autoScrollsToCaret:function(){return !l},autoClosesUnclosedTags:function(){var d=n.cloneNode(!1),c;d.innerHTML="<p><div></div>";d=d.innerHTML.toLowerCase();c="<p></p><div></div>"===d||"<p><div></div></p>"===d;this.autoClosesUnclosedTags=function(){return c};return c},supportsNativeGetElementsByClassName:function(){return -1!==(""+document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection" in window&&"modify" in window.getSelection()},supportsClassList:function(){return"classList" in n},needsSpaceAfterLineBreak:function(){return j},supportsSpeechApiOn:function(b){return 11<=(h.match(/Chrome\/(\d+)/)||[,0])[1]&&("onwebkitspeechchange" in b||"speech" in b)},crashesWhenDefineProperty:function(a){return i&&("XMLHttpRequest"===a||"XDomainRequest"===a)},doesAsyncFocus:function(){return i},hasProblemsSettingCaretAfterImg:function(){return i},hasUndoInContextMenu:function(){return m||k||j}}}();wysihtml5.lang.array=function(a){return{contains:function(f){if(a.indexOf){return -1!==a.indexOf(f)}for(var b=0,e=a.length;b<e;b++){if(a[b]===f){return !0}}return !1},without:function(h){for(var h=wysihtml5.lang.array(h),b=[],g=0,f=a.length;g<f;g++){h.contains(a[g])||b.push(a[g])}return b},get:function(){for(var f=0,b=a.length,e=[];f<b;f++){e.push(a[f])}return e}}};wysihtml5.lang.Dispatcher=Base.extend({observe:function(a,d){this.events=this.events||{};this.events[a]=this.events[a]||[];this.events[a].push(d);return this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(e,h){this.events=this.events||{};for(var f=this.events[e]||[],g=0;g<f.length;g++){f[g].call(this,h)}return this},stopObserving:function(f,j){this.events=this.events||{};var g=0,i,h;if(f){i=this.events[f]||[];for(h=[];g<i.length;g++){i[g]!==j&&j&&h.push(i[g])}this.events[f]=h}else{this.events={}}return this}});wysihtml5.lang.object=function(a){return{merge:function(d){for(var b in d){a[b]=d[b]}return this},get:function(){return a},clone:function(){var d={},b;for(b in a){d[b]=a[b]}return d},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)}}};(function(){var a=/^\s+/,d=/\s+$/;wysihtml5.lang.string=function(b){b=""+b;return{trim:function(){return b.replace(a,"").replace(d,"")},interpolate:function(e){for(var f in e){b=this.replace("#{"+f+"}").by(e[f])}return b},replace:function(c){return{by:function(e){return b.split(c).join(e)}}}}}})();(function(h){function p(b){return b.replace(n,function(g,f){var r=(f.match(m)||[])[1]||"",q=k[r],f=f.replace(m,"");f.split(q).length>f.split(r).length&&(f+=r,r="");var i=q=f;f.length>l&&(i=i.substr(0,l)+"...");"www."===q.substr(0,4)&&(q="http://"+q);return'<a href="'+q+'">'+i+"</a>"+r})}function j(b){if(!o.contains(b.nodeName)){if(b.nodeType===h.TEXT_NODE&&b.data.match(n)){var d=b.parentNode,a;a=d.ownerDocument;var c=a._wysihtml5_tempElement;c||(c=a._wysihtml5_tempElement=a.createElement("div"));a=c;a.innerHTML="<span></span>"+p(b.data);for(a.removeChild(a.firstChild);a.firstChild;){d.insertBefore(a.firstChild,b)}d.removeChild(b)}else{d=h.lang.array(b.childNodes).get();a=d.length;for(c=0;c<a;c++){j(d[c])}return b}}}var o=h.lang.array("CODE PRE A SCRIPT HEAD TITLE STYLE".split(" ")),n=/((https?:\/\/|www\.)[^\s<]{3,})/gi,m=/([^\w\/\-](,?))$/i,l=100,k={")":"(","]":"[","}":"{"};h.dom.autoLink=function(a){var f;j:{f=a;for(var d;f.parentNode;){f=f.parentNode;d=f.nodeName;if(o.contains(d)){f=!0;break j}if("body"===d){break}}f=!1}if(f){return a}a===a.ownerDocument.documentElement&&(a=a.ownerDocument.body);return j(a)};h.dom.autoLink.URL_REG_EXP=n})(wysihtml5);(function(d){var f=d.browser.supportsClassList(),e=d.dom;e.addClass=function(a,c){if(f){return a.classList.add(c)}e.hasClass(a,c)||(a.className+=" "+c)};e.removeClass=function(g,c){if(f){return g.classList.remove(c)}g.className=g.className.replace(RegExp("(^|\\s+)"+c+"(\\s+|$)")," ")};e.hasClass=function(g,c){if(f){return g.classList.contains(c)}var h=g.className;return 0<h.length&&(h==c||RegExp("(^|\\s)"+c+"(\\s|$)").test(h))}})(wysihtml5);wysihtml5.dom.contains=function(){var a=document.documentElement;if(a.contains){return function(c,d){d.nodeType!==wysihtml5.ELEMENT_NODE&&(d=d.parentNode);return c!==d&&c.contains(d)}}if(a.compareDocumentPosition){return function(c,d){return !!(c.compareDocumentPosition(d)&16)}}}();wysihtml5.dom.convertToList=function(){function a(c,e){var f=c.createElement("li");e.appendChild(f);return f}return function(u,v){if("UL"===u.nodeName||"OL"===u.nodeName||"MENU"===u.nodeName){return u}var t=u.ownerDocument,s=t.createElement(v),r=u.querySelectorAll("br"),q=r.length,o,p,l,m,b;for(b=0;b<q;b++){for(o=r[b];(p=o.parentNode)&&p!==u&&p.lastChild===o;){if("block"===wysihtml5.dom.getStyle("display").from(p)){p.removeChild(o);break}wysihtml5.dom.insert(o).after(o.parentNode)}}r=wysihtml5.lang.array(u.childNodes).get();q=r.length;for(b=0;b<q;b++){m=m||a(t,s),o=r[b],p="block"===wysihtml5.dom.getStyle("display").from(o),l="BR"===o.nodeName,p?(m=m.firstChild?a(t,s):m,m.appendChild(o),m=null):l?m=m.firstChild?null:m:m.appendChild(o)}u.parentNode.replaceChild(s,u);return s}}();wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(c){for(var i,h=0,g=a.length;h<g;h++){i=a[h],"undefined"!==typeof b[i]&&""!==b[i]&&(c[i]=b[i])}return{andTo:arguments.callee}}}}}};(function(d){var f=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],e=function(b){var i;b:for(var h=0,c=f.length;h<c;h++){if("border-box"===d.getStyle(f[h]).from(b)){i=f[h];break b}}return i?parseInt(d.getStyle("width").from(b),10)<b.offsetWidth:!1};d.copyStyles=function(a){return{from:function(l){e(l)&&(a=wysihtml5.lang.array(a).without(f));for(var k="",j=a.length,b=0,c;b<j;b++){c=a[b],k+=c+":"+d.getStyle(c).from(l)+";"}return{to:function(g){d.setStyles(k).on(g);return{andTo:arguments.callee}}}}}}})(wysihtml5.dom);(function(a){a.dom.delegate=function(h,b,g,f){return a.dom.observe(h,g,function(j){for(var e=j.target,c=a.lang.array(h.querySelectorAll(b));e&&e!==h;){if(c.contains(e)){f.call(e,j);break}e=e.parentNode}})}})(wysihtml5);wysihtml5.dom.getAsDom=function(){var a="abbr article aside audio bdi canvas command datalist details figcaption figure footer header hgroup keygen mark meter nav output progress rp rt ruby svg section source summary time track video wbr".split(" ");return function(l,b){var b=b||document,k;if("object"===typeof l&&l.nodeType){k=b.createElement("div"),k.appendChild(l)}else{if(wysihtml5.browser.supportsHTML5Tags(b)){k=b.createElement("div"),k.innerHTML=l}else{k=b;if(!k._wysihtml5_supportsHTML5Tags){for(var j=0,i=a.length;j<i;j++){k.createElement(a[j])}k._wysihtml5_supportsHTML5Tags=!0}k=b;j=k.createElement("div");j.style.display="none";k.body.appendChild(j);try{j.innerHTML=l}catch(h){}k.body.removeChild(j);k=j}}return k}}();wysihtml5.dom.getParentElement=function(){function a(c,d){return !d||!d.length?!0:"string"===typeof d?c===d:wysihtml5.lang.array(d).contains(c)}return function(n,b,m){m=m||50;if(b.className||b.classRegExp){b:{for(var l=b.nodeName,k=b.className,b=b.classRegExp;m--&&n&&"BODY"!==n.nodeName;){var j;if(j=n.nodeType===wysihtml5.ELEMENT_NODE){if(j=a(n.nodeName,l)){j=k;var h=(n.className||"").match(b)||[];j=!j?!!h.length:h[h.length-1]===j}}if(j){break b}n=n.parentNode}n=null}return n}b:{l=b.nodeName;for(k=m;k--&&n&&"BODY"!==n.nodeName;){if(a(n.nodeName,l)){break b}n=n.parentNode}n=null}return n}}();wysihtml5.dom.getStyle=function(){function d(a){return a.replace(e,function(b){return b.charAt(1).toUpperCase()})}var f={"float":"styleFloat" in document.createElement("div").style?"styleFloat":"cssFloat"},e=/\-[a-z]/g;return function(b){return{from:function(q){if(q.nodeType===wysihtml5.ELEMENT_NODE){var p=q.ownerDocument,o=f[b]||d(b),l=q.style,m=q.currentStyle,a=l[o];if(a){return a}if(m){try{return m[o]}catch(c){}}var o=p.defaultView||p.parentWindow,p=("height"===b||"width"===b)&&"TEXTAREA"===q.nodeName,r;if(o.getComputedStyle){return p&&(r=l.overflow,l.overflow="hidden"),q=o.getComputedStyle(q,null).getPropertyValue(b),p&&(l.overflow=r||""),q}}}}}}();wysihtml5.dom.hasElementWithTagName=function(){var a={},d=1;return function(b,h){var g=(b._wysihtml5_identifier||(b._wysihtml5_identifier=d++))+":"+h,c=a[g];c||(c=a[g]=b.getElementsByTagName(h));return 0<c.length}}();(function(d){var f={},e=1;d.dom.hasElementWithClassName=function(h,c){if(!d.browser.supportsNativeGetElementsByClassName()){return !!h.querySelector("."+c)}var b=(h._wysihtml5_identifier||(h._wysihtml5_identifier=e++))+":"+c,a=f[b];a||(a=f[b]=h.getElementsByClassName(c));return 0<a.length}})(wysihtml5);wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}};wysihtml5.dom.insertCSS=function(a){a=a.join("\n");return{into:function(f){var b=f.head||f.getElementsByTagName("head")[0],e=f.createElement("style");e.type="text/css";e.styleSheet?e.styleSheet.cssText=a:e.appendChild(f.createTextNode(a));b&&b.appendChild(e)}}};wysihtml5.dom.observe=function(h,n,i){for(var n="string"===typeof n?[n]:n,m,l,k=0,j=n.length;k<j;k++){l=n[k],h.addEventListener?h.addEventListener(l,i,!1):(m=function(a){"target" in a||(a.target=a.srcElement);a.preventDefault=a.preventDefault||function(){this.returnValue=false};a.stopPropagation=a.stopPropagation||function(){this.cancelBubble=true};i.call(h,a)},h.attachEvent("on"+l,m))}return{stop:function(){for(var c,a=0,b=n.length;a<b;a++){c=n[a],h.removeEventListener?h.removeEventListener(c,i,!1):h.detachEvent("on"+c,m)}}}};wysihtml5.dom.parse=function(){function s(v,u){var b=v.childNodes,i=b.length,d;d=t[v.nodeType];var a=0;d=d&&d(v);if(!d){return null}for(a=0;a<i;a++){(newChild=s(b[a],u))&&d.appendChild(newChild)}return u&&1>=d.childNodes.length&&d.nodeName.toLowerCase()===q&&!d.attributes.length?d.firstChild:d}function r(g,f){var f=f.toLowerCase(),k;if(k="IMG"==g.nodeName){if(k="src"==f){var i;try{i=g.complete&&!g.mozMatchesSelector(":-moz-broken")}catch(h){g.complete&&"complete"===g.readyState&&(i=!0)}k=!0===i}}return k?g.src:l&&"outerHTML" in g?-1!=g.outerHTML.toLowerCase().indexOf(" "+f+"=")?g.getAttribute(f):null:g.getAttribute(f)}var t={1:function(D){var C,k,h=n.tags;k=D.nodeName.toLowerCase();C=D.scopeName;if(D._wysihtml5){return null}D._wysihtml5=1;if("wysihtml5-temp"===D.className){return null}C&&"HTML"!=C&&(k=C+":"+k);"outerHTML" in D&&!wysihtml5.browser.autoClosesUnclosedTags()&&("P"===D.nodeName&&"</p>"!==D.outerHTML.slice(-4).toLowerCase())&&(k="div");if(k in h){C=h[k];if(!C||C.remove){return null}C="string"===typeof C?{rename_tag:C}:C}else{if(D.firstChild){C={rename_tag:q}}else{return null}}k=D.ownerDocument.createElement(C.rename_tag||k);var h={},c=C.set_class,g=C.add_class,I=C.set_attributes,E=C.check_attributes,e=n.classes,u=0,F=[];C=[];var B=[],d=[],H;I&&(h=wysihtml5.lang.object(I).clone());if(E){for(H in E){if(I=m[E[H]]){I=I(r(D,H)),"string"===typeof I&&(h[H]=I)}}}c&&F.push(c);if(g){for(H in g){if(I=j[g[H]]){c=I(r(D,H)),"string"===typeof c&&F.push(c)}}}e["_wysihtml5-temp-placeholder"]=1;(d=D.getAttribute("class"))&&(F=F.concat(d.split(p)));for(g=F.length;u<g;u++){D=F[u],e[D]&&C.push(D)}for(e=C.length;e--;){D=C[e],wysihtml5.lang.array(B).contains(D)||B.unshift(D)}B.length&&(h["class"]=B.join(" "));for(H in h){try{k.setAttribute(H,h[H])}catch(G){}}h.src&&("undefined"!==typeof h.width&&k.setAttribute("width",h.width),"undefined"!==typeof h.height&&k.setAttribute("height",h.height));return k},3:function(b){return b.ownerDocument.createTextNode(b.data)}},q="span",p=/\s+/,o={tags:{},classes:{}},n={},l=!wysihtml5.browser.supportsGetAttributeCorrectly(),m={url:function(){var b=/^https?:\/\//i;return function(a){return !a||!a.match(b)?null:a.replace(b,function(c){return c.toLowerCase()})}}(),alt:function(){var b=/[^ a-z0-9_\-]/gi;return function(a){return !a?"":a.replace(b,"")}}(),numbers:function(){var b=/\D/g;return function(a){return(a=(a||"").replace(b,""))||null}}()},j={align_img:function(){var b={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(a){return b[(""+a).toLowerCase()]}}(),align_text:function(){var b={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(a){return b[(""+a).toLowerCase()]}}(),clear_br:function(){var b={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(a){return b[(""+a).toLowerCase()]}}(),size_font:function(){var b={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(a){return b[(""+a).charAt(0)]}}()};return function(b,k,i,g){wysihtml5.lang.object(n).merge(o).merge(k).get();for(var i=i||b.ownerDocument||document,k=i.createDocumentFragment(),f="string"===typeof b,b=f?wysihtml5.dom.getAsDom(b,i):b;b.firstChild;){i=b.firstChild,b.removeChild(i),(i=s(i,g))&&k.appendChild(i)}b.innerHTML="";b.appendChild(k);return f?wysihtml5.quirks.getCorrectInnerHTML(b):b}}();wysihtml5.dom.removeEmptyTextNodes=function(e){for(var h=wysihtml5.lang.array(e.childNodes).get(),f=h.length,g=0;g<f;g++){e=h[g],e.nodeType===wysihtml5.TEXT_NODE&&""===e.data&&e.parentNode.removeChild(e)}};wysihtml5.dom.renameElement=function(e,h){for(var f=e.ownerDocument.createElement(h),g;g=e.firstChild;){f.appendChild(g)}wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(f);e.parentNode.replaceChild(f,e);return f};wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode){if(a.firstChild){for(var d=a.ownerDocument.createDocumentFragment();a.firstChild;){d.appendChild(a.firstChild)}a.parentNode.replaceChild(d,a)}else{a.parentNode.removeChild(a)}}};(function(a){function d(e){var c=e.ownerDocument.createElement("br");e.appendChild(c)}a.resolveList=function(b){if(!("MENU"!==b.nodeName&&"UL"!==b.nodeName&&"OL"!==b.nodeName)){var l=b.ownerDocument.createDocumentFragment(),k=b.previousElementSibling||b.previousSibling,j,h,c;for(k&&"block"!==a.getStyle("display").from(k)&&d(l);c=b.firstChild;){for(j=c.lastChild;k=c.firstChild;){h=(h=k===j)&&"block"!==a.getStyle("display").from(k)&&"BR"!==k.nodeName,l.appendChild(k),h&&d(l)}c.parentNode.removeChild(c)}b.parentNode.replaceChild(l,b)}}})(wysihtml5.dom);(function(f){var j=document,g="parent top opener frameElement frames localStorage globalStorage sessionStorage indexedDB".split(" "),i="open close openDialog showModalDialog alert confirm prompt openDatabase postMessage XMLHttpRequest XDomainRequest".split(" "),h=["referrer","write","open","close"];f.dom.Sandbox=Base.extend({constructor:function(b,d){this.callback=b||f.EMPTY_FUNCTION;this.config=f.lang.object({}).merge(d).get();this.iframe=this._createIframe()},insertInto:function(b){"string"===typeof b&&(b=j.getElementById(b));b.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var b=this.getIframe();b.parentNode.removeChild(b)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var b=this,c=j.createElement("iframe");c.className="wysihtml5-sandbox";f.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(c);f.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(c.src="javascript:'<html></html>'");c.onload=function(){c.onreadystatechange=c.onload=null;b._onLoadIframe(c)};c.onreadystatechange=function(){if(/loaded|complete/.test(c.readyState)){c.onreadystatechange=c.onload=null;b._onLoadIframe(c)}};return c},_onLoadIframe:function(l){if(f.dom.contains(j.documentElement,l)){var e=this,c=l.contentWindow,d=l.contentWindow.document,a=this._getHtml({charset:j.characterSet||j.charset||"utf-8",stylesheets:this.config.stylesheets});d.open("text/html","replace");d.write(a);d.close();this.getWindow=function(){return l.contentWindow};this.getDocument=function(){return l.contentWindow.document};c.onerror=function(m,k,n){throw Error("wysihtml5.Sandbox: "+m,k,n)};if(!f.browser.supportsSandboxedIframes()){var b,a=0;for(b=g.length;a<b;a++){this._unset(c,g[a])}a=0;for(b=i.length;a<b;a++){this._unset(c,i[a],f.EMPTY_FUNCTION)}a=0;for(b=h.length;a<b;a++){this._unset(d,h[a])}this._unset(d,"cookie","",!0)}this.loaded=!0;setTimeout(function(){e.callback(e)},0)}},_getHtml:function(b){var o=b.stylesheets,n="",m=0,l;if(o="string"===typeof o?[o]:o){for(l=o.length;m<l;m++){n+='<link rel="stylesheet" href="'+o[m]+'">'}}b.stylesheets=n;return f.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(b)},_unset:function(v,u,t,s){try{v[u]=t}catch(o){}try{v.__defineGetter__(u,function(){return t})}catch(r){}if(s){try{v.__defineSetter__(u,function(){})}catch(m){}}if(!f.browser.crashesWhenDefineProperty(u)){try{var l={get:function(){return t}};s&&(l.set=function(){});Object.defineProperty(v,u,l)}catch(b){}}}})})(wysihtml5);(function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(c){for(var e in b){c.setAttribute(a[e]||e,b[e])}}}}})();wysihtml5.dom.setStyles=function(a){return{on:function(d){d=d.style;if("string"===typeof a){d.cssText+=";"+a}else{for(var b in a){"float"===b?(d.cssFloat=a[b],d.styleFloat=a[b]):d[b]=a[b]}}}}};(function(a){a.simulatePlaceholder=function(j,b,i){var h=function(){b.hasPlaceholderSet()&&b.clear();a.removeClass(b.element,"placeholder")},g=function(){b.isEmpty()&&(b.setValue(i),a.addClass(b.element,"placeholder"))};j.observe("set_placeholder",g).observe("unset_placeholder",h).observe("focus:composer",h).observe("paste:composer",h).observe("blur:composer",g);g()}})(wysihtml5.dom);(function(a){var d=document.documentElement;"textContent" in d?(a.setTextContent=function(e,c){e.textContent=c},a.getTextContent=function(b){return b.textContent}):"innerText" in d?(a.setTextContent=function(e,c){e.innerText=c},a.getTextContent=function(b){return b.innerText}):(a.setTextContent=function(e,c){e.nodeValue=c},a.getTextContent=function(b){return b.nodeValue})})(wysihtml5.dom);wysihtml5.quirks.cleanPastedHTML=function(){var a={"a u":wysihtml5.dom.replaceWithChildNodes};return function(p,b,o){var b=b||a,o=o||p.ownerDocument||document,n="string"===typeof p,m,l,j,k=0,p=n?wysihtml5.dom.getAsDom(p,o):p;for(j in b){m=p.querySelectorAll(j);o=b[j];for(l=m.length;k<l;k++){o(m[k])}}return n?p.innerHTML:p}}();(function(a){var d=a.dom;a.quirks.ensureProperClearing=function(){var b=function(){var c=this;setTimeout(function(){var e=c.innerHTML.toLowerCase();if("<p>&nbsp;</p>"==e||"<p>&nbsp;</p><p>&nbsp;</p>"==e){c.innerHTML=""}},0)};return function(c){d.observe(c.element,["cut","keydown"],b)}}();a.quirks.ensureProperClearingOfLists=function(){var b=["OL","UL","MENU"];return function(c){d.observe(c.element,"keydown",function(h){if(h.keyCode===a.BACKSPACE_KEY){var g=c.selection.getSelectedNode(),h=c.element;h.firstChild&&a.lang.array(b).contains(h.firstChild.nodeName)&&(g=d.getParentElement(g,{nodeName:b}))&&g==h.firstChild&&1>=g.childNodes.length&&(g.firstChild?""===g.firstChild.innerHTML:1)&&g.parentNode.removeChild(g)}})}}()})(wysihtml5);(function(a){a.quirks.getCorrectInnerHTML=function(l){var b=l.innerHTML;if(-1===b.indexOf("%7E")){return b}var l=l.querySelectorAll("[href*='~'], [src*='~']"),k,j,i,h;h=0;for(i=l.length;h<i;h++){k=l[h].href||l[h].src,j=a.lang.string(k).replace("~").by("%7E"),b=a.lang.string(b).replace(j).by(k)}return b}})(wysihtml5);(function(e){var h=e.dom,f="LI P H1 H2 H3 H4 H5 H6".split(" "),g=["UL","OL","MENU"];e.quirks.insertLineBreakOnReturn=function(b){function a(c){if(c=h.getParentElement(c,{nodeName:["P","DIV"]},2)){var i=document.createTextNode(e.INVISIBLE_SPACE);h.insert(i).before(c);h.replaceWithChildNodes(c);b.selection.selectNode(i)}}h.observe(b.element.ownerDocument,"keydown",function(j){var c=j.keyCode;if(!(j.shiftKey||c!==e.ENTER_KEY&&c!==e.BACKSPACE_KEY)){var d=b.selection.getSelectedNode();(d=h.getParentElement(d,{nodeName:f},4))?"LI"===d.nodeName&&(c===e.ENTER_KEY||c===e.BACKSPACE_KEY)?setTimeout(function(){var k=b.selection.getSelectedNode(),i;k&&((i=h.getParentElement(k,{nodeName:g},2))||a(k))},0):d.nodeName.match(/H[1-6]/)&&c===e.ENTER_KEY&&setTimeout(function(){a(b.selection.getSelectedNode())},0):c===e.ENTER_KEY&&!e.browser.insertsLineBreaksOnReturn()&&(b.commands.exec("insertLineBreak"),j.preventDefault())}})}})(wysihtml5);(function(a){a.quirks.redraw=function(f){a.dom.addClass(f,"wysihtml5-quirks-redraw");a.dom.removeClass(f,"wysihtml5-quirks-redraw");try{var b=f.ownerDocument;b.execCommand("italic",!1,null);b.execCommand("italic",!1,null)}catch(e){}}})(wysihtml5);(function(a){var d=a.dom;a.Selection=Base.extend({constructor:function(b){window.rangy.init();this.editor=b;this.composer=b.composer;this.doc=this.composer.doc},getBookmark:function(){var b=this.getRange();return b&&b.cloneRange()},setBookmark:function(b){b&&this.setSelection(b)},setBefore:function(e){var c=rangy.createRange(this.doc);c.setStartBefore(e);c.setEndBefore(e);return this.setSelection(c)},setAfter:function(e){var c=rangy.createRange(this.doc);c.setStartAfter(e);c.setEndAfter(e);return this.setSelection(c)},selectNode:function(b){var n=rangy.createRange(this.doc),m=b.nodeType===a.ELEMENT_NODE,l="canHaveHTML" in b?b.canHaveHTML:"IMG"!==b.nodeName,k=m?b.innerHTML:b.data,k=""===k||k===a.INVISIBLE_SPACE,c=d.getStyle("display").from(b),c="block"===c||"list-item"===c;if(k&&m&&l){try{b.innerHTML=a.INVISIBLE_SPACE}catch(j){}}l?n.selectNodeContents(b):n.selectNode(b);l&&k&&m?n.collapse(c):l&&k&&(n.setStartAfter(b),n.setEndAfter(b));this.setSelection(n)},getSelectedNode:function(b){if(b&&this.doc.selection&&"Control"===this.doc.selection.type&&(b=this.doc.selection.createRange())&&b.length){return b.item(0)}b=this.getSelection(this.doc);return b.focusNode===b.anchorNode?b.focusNode:(b=this.getRange(this.doc))?b.commonAncestorContainer:this.doc.body},executeAndRestore:function(s,r){var q=this.doc.body,p=r&&q.scrollTop,o=r&&q.scrollLeft,m='<span class="_wysihtml5-temp-placeholder">'+a.INVISIBLE_SPACE+"</span>",n=this.getRange(this.doc);if(n){m=n.createContextualFragment(m);n.insertNode(m);try{s(n.startContainer,n.endContainer)}catch(b){setTimeout(function(){throw b},0)}(caretPlaceholder=this.doc.querySelector("._wysihtml5-temp-placeholder"))?(n=rangy.createRange(this.doc),n.selectNode(caretPlaceholder),n.deleteContents(),this.setSelection(n)):q.focus();r&&(q.scrollTop=p,q.scrollLeft=o);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(l){}}else{s(q,q)}},executeAndRestoreSimple:function(u){var t,s,r=this.getRange(),q=this.doc.body,o;if(r){t=r.getNodes([3]);q=t[0]||r.startContainer;o=t[t.length-1]||r.endContainer;t=q===r.startContainer?r.startOffset:0;s=o===r.endContainer?r.endOffset:o.length;try{u(r.startContainer,r.endContainer)}catch(p){setTimeout(function(){throw p},0)}u=rangy.createRange(this.doc);try{u.setStart(q,t)}catch(l){}try{u.setEnd(o,s)}catch(m){}try{this.setSelection(u)}catch(e){}}else{u(q,q)}},insertHTML:function(e){var e=rangy.createRange(this.doc).createContextualFragment(e),c=e.lastChild;this.insertNode(e);c&&this.setAfter(c)},insertNode:function(e){var c=this.getRange();c&&c.insertNode(e)},surround:function(f){var e=this.getRange();if(e){try{e.surroundContents(f),this.selectNode(f)}catch(g){f.appendChild(e.extractContents()),e.insertNode(f)}}},scrollIntoView:function(){var b=this.doc,i=b.documentElement.scrollHeight>b.documentElement.offsetHeight,h;if(!(h=b._wysihtml5ScrollIntoViewElement)){h=b.createElement("span"),h.innerHTML=a.INVISIBLE_SPACE}h=b._wysihtml5ScrollIntoViewElement=h;if(i){this.insertNode(h);var i=h,g=0;if(i.parentNode){do{g+=i.offsetTop||0,i=i.offsetParent}while(i)}i=g;h.parentNode.removeChild(h);i>b.body.scrollTop&&(b.body.scrollTop=i)}},selectLine:function(){a.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var b=this.doc.defaultView.getSelection();b.modify("extend","left","lineboundary");b.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var h=this.doc.selection.createRange(),e=h.boundingTop,m=this.doc.body.scrollWidth,l;if(h.moveToPoint){0===e&&(l=this.doc.createElement("span"),this.insertNode(l),e=l.offsetTop,l.parentNode.removeChild(l));e+=1;for(l=-10;l<m;l+=2){try{h.moveToPoint(l,e);break}catch(k){}}for(l=this.doc.selection.createRange();0<=m;m--){try{l.moveToPoint(m,e);break}catch(j){}}h.setEndPoint("EndToEnd",l);h.select()}},getText:function(){var b=this.getSelection();return b?b.toString():""},getNodes:function(f,e){var g=this.getRange();return g?g.getNodes([f],e):[]},getRange:function(){var b=this.getSelection();return b&&b.rangeCount&&b.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(b){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow).setSingleRange(b)}})})(wysihtml5);(function(h,p){function j(d,c){return p.dom.isCharacterDataNode(d)?0==c?!!d.previousSibling:c==d.length?!!d.nextSibling:!0:0<c&&c<d.childNodes.length}function o(d,c,r){var q;p.dom.isCharacterDataNode(c)&&(0==r?(r=p.dom.getNodeIndex(c),c=c.parentNode):r==c.length?(r=p.dom.getNodeIndex(c)+1,c=c.parentNode):q=p.dom.splitDataNode(c,r));if(!q){q=c.cloneNode(!1);q.id&&q.removeAttribute("id");for(var i;i=c.childNodes[r];){q.appendChild(i)}p.dom.insertAfter(q,c)}return c==d?q:o(d,q.parentNode,p.dom.getNodeIndex(q))}function n(b){this.firstTextNode=(this.isElementMerge=b.nodeType==h.ELEMENT_NODE)?b.lastChild:b;this.textNodes=[this.firstTextNode]}function m(f,e,i,g){this.tagNames=f||[l];this.cssClass=e||"";this.similarClassRegExp=i;this.normalize=g;this.applyToAnyTagName=!1}var l="span",k=/\s+/g;n.prototype={doMerge:function(){for(var g=[],f,r,q=0,i=this.textNodes.length;q<i;++q){f=this.textNodes[q],r=f.parentNode,g[q]=f.data,q&&(r.removeChild(f),r.hasChildNodes()||r.parentNode.removeChild(r))}return this.firstTextNode.data=g=g.join("")},getLength:function(){for(var d=this.textNodes.length,c=0;d--;){c+=this.textNodes[d].length}return c},toString:function(){for(var e=[],d=0,f=this.textNodes.length;d<f;++d){e[d]="'"+this.textNodes[d].data+"'"}return"[Merge("+e.join(",")+")]"}};m.prototype={getAncestorWithClass:function(b){for(var f;b;){if(this.cssClass){if(f=this.cssClass,b.className){var c=b.className.match(this.similarClassRegExp)||[];f=c[c.length-1]===f}else{f=!1}}else{f=!0}if(b.nodeType==h.ELEMENT_NODE&&p.dom.arrayContains(this.tagNames,b.tagName.toLowerCase())&&f){return b}b=b.parentNode}return !1},postApply:function(F,D){for(var B=F[0],v=F[F.length-1],u=[],t,r=B,q=v,H=0,E=v.length,e,A,G=0,C=F.length;G<C;++G){if(e=F[G],A=this.getAdjacentMergeableTextNode(e.parentNode,!1)){if(t||(t=new n(A),u.push(t)),t.textNodes.push(e),e===B&&(r=t.firstTextNode,H=r.length),e===v){q=t.firstTextNode,E=t.getLength()}}else{t=null}}if(B=this.getAdjacentMergeableTextNode(v.parentNode,!0)){t||(t=new n(v),u.push(t)),t.textNodes.push(B)}if(u.length){G=0;for(C=u.length;G<C;++G){u[G].doMerge()}D.setStart(r,H);D.setEnd(q,E)}},getAdjacentMergeableTextNode:function(b,r){var q=b.nodeType==h.TEXT_NODE,i=q?b.parentNode:b,g=r?"nextSibling":"previousSibling";if(q){if((q=b[g])&&q.nodeType==h.TEXT_NODE){return q}}else{if((q=i[g])&&this.areElementsMergeable(b,q)){return q[r?"firstChild":"lastChild"]}}return null},areElementsMergeable:function(i,c){var t;if(t=p.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())){if(t=p.dom.arrayContains(this.tagNames,(c.tagName||"").toLowerCase())){if(t=i.className.replace(k," ")==c.className.replace(k," ")){i:if(i.attributes.length!=c.attributes.length){t=!1}else{t=0;for(var s=i.attributes.length,r,q;t<s;++t){if(r=i.attributes[t],q=r.name,"class"!=q&&(q=c.attributes.getNamedItem(q),r.specified!=q.specified||r.specified&&r.nodeValue!==q.nodeValue)){t=!1;break i}}t=!0}}}}return t},createContainer:function(b){b=b.createElement(this.tagNames[0]);this.cssClass&&(b.className=this.cssClass);return b},applyToTextNode:function(d){var c=d.parentNode;1==c.childNodes.length&&p.dom.arrayContains(this.tagNames,c.tagName.toLowerCase())?this.cssClass&&(d=this.cssClass,c.className?(c.className&&(c.className=c.className.replace(this.similarClassRegExp,"")),c.className+=" "+d):c.className=d):(c=this.createContainer(p.dom.getDocument(d)),d.parentNode.insertBefore(c,d),c.appendChild(d))},isRemovable:function(b){return p.dom.arrayContains(this.tagNames,b.tagName.toLowerCase())&&h.lang.string(b.className).trim()==this.cssClass},undoToTextNode:function(a,f,d){f.containsNode(d)||(a=f.cloneRange(),a.selectNode(d),a.isPointInRange(f.endContainer,f.endOffset)&&j(f.endContainer,f.endOffset)&&(o(d,f.endContainer,f.endOffset),f.setEndAfter(d)),a.isPointInRange(f.startContainer,f.startOffset)&&j(f.startContainer,f.startOffset)&&(d=o(d,f.startContainer,f.startOffset)));this.similarClassRegExp&&d.className&&(d.className=d.className.replace(this.similarClassRegExp,""));if(this.isRemovable(d)){f=d;for(d=f.parentNode;f.firstChild;){d.insertBefore(f.firstChild,f)}d.removeChild(f)}},applyToRange:function(b){var t=b.getNodes([h.TEXT_NODE]);if(!t.length){try{var s=this.createContainer(b.endContainer.ownerDocument);b.surroundContents(s);this.selectNode(b,s);return}catch(r){}}b.splitBoundaries();t=b.getNodes([h.TEXT_NODE]);if(t.length){for(var q=0,i=t.length;q<i;++q){s=t[q],this.getAncestorWithClass(s)||this.applyToTextNode(s)}b.setStart(t[0],0);s=t[t.length-1];b.setEnd(s,s.length);this.normalize&&this.postApply(t,b)}},undoToRange:function(b){var t=b.getNodes([h.TEXT_NODE]),s,r;t.length?(b.splitBoundaries(),t=b.getNodes([h.TEXT_NODE])):(t=b.endContainer.ownerDocument.createTextNode(h.INVISIBLE_SPACE),b.insertNode(t),b.selectNode(t),t=[t]);for(var q=0,i=t.length;q<i;++q){s=t[q],(r=this.getAncestorWithClass(s))&&this.undoToTextNode(s,b,r)}1==i?this.selectNode(b,t[0]):(b.setStart(t[0],0),s=t[t.length-1],b.setEnd(s,s.length),this.normalize&&this.postApply(t,b))},selectNode:function(b,t){var s=t.nodeType===h.ELEMENT_NODE,r="canHaveHTML" in t?t.canHaveHTML:!0,q=s?t.innerHTML:t.data;if((q=""===q||q===h.INVISIBLE_SPACE)&&s&&r){try{t.innerHTML=h.INVISIBLE_SPACE}catch(i){}}b.selectNodeContents(t);q&&s?b.collapse(!1):q&&(b.setStartAfter(t),b.setEndAfter(t))},getTextSelectedByRange:function(f,e){var i=e.cloneRange();i.selectNodeContents(f);var g=i.intersection(e),g=g?g.toString():"";i.detach();return g},isAppliedToRange:function(b){var v=[],u,t=b.getNodes([h.TEXT_NODE]);if(!t.length){return(u=this.getAncestorWithClass(b.startContainer))?[u]:!1}for(var s=0,r=t.length,q;s<r;++s){q=this.getTextSelectedByRange(t[s],b);u=this.getAncestorWithClass(t[s]);if(""!=q&&!u){return !1}v.push(u)}return v},toggleRange:function(b){this.isAppliedToRange(b)?this.undoToRange(b):this.applyToRange(b)}};h.selection.HTMLApplier=m})(wysihtml5,rangy);wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a;this.composer=a.composer;this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(h,n){var i=wysihtml5.commands[h],m=wysihtml5.lang.array(arguments).get(),l=i&&i.exec,k=null;this.editor.fire("beforecommand:composer");if(l){m.unshift(this.composer),k=l.apply(i,m)}else{try{k=this.doc.execCommand(h,!1,n)}catch(j){}}this.editor.fire("aftercommand:composer");return k},state:function(g,l){var h=wysihtml5.commands[g],k=wysihtml5.lang.array(arguments).get(),j=h&&h.state;if(j){return k.unshift(this.composer),j.apply(h,k)}try{return this.doc.queryCommandState(g)}catch(i){return !1}},value:function(e){var h=wysihtml5.commands[e],f=h&&h.value;if(f){return f.call(h,this.composer,e)}try{return this.doc.queryCommandValue(e)}catch(g){return null}}});(function(a){a.commands.bold={exec:function(d,b){return a.commands.formatInline.exec(d,b,"b")},state:function(d,b){return a.commands.formatInline.state(d,b,"b")},value:function(){}}})(wysihtml5);(function(f){function j(q,l){var d=q.doc,e="_wysihtml5-temp-"+ +new Date,a=0,b,o,m;f.commands.formatInline.exec(q,g,i,e,/non-matching-class/g);b=d.querySelectorAll(i+"."+e);for(e=b.length;a<e;a++){for(m in o=b[a],o.removeAttribute("class"),l){o.setAttribute(m,l[m])}}a=o;1===e&&(m=h.getTextContent(o),e=!!o.querySelector("*"),m=""===m||m===f.INVISIBLE_SPACE,!e&&m&&(h.setTextContent(o,l.text||o.href),d=d.createTextNode(" "),q.selection.setAfter(o),q.selection.insertNode(d),a=d));q.selection.setAfter(a)}var g,i="A",h=f.dom;f.commands.createLink={exec:function(e,c,l){var k=this.state(e,c);k?e.selection.executeAndRestore(function(){for(var n=k.length,m=0,q,p,o;m<n;m++){q=k[m],p=h.getParentElement(q,{nodeName:"code"}),o=h.getTextContent(q),o.match(h.autoLink.URL_REG_EXP)&&!p?h.renameElement(q,"code"):h.replaceWithChildNodes(q)}}):(l="object"===typeof l?l:{href:l},j(e,l))},state:function(b,d){return f.commands.formatInline.state(b,d,"A")},value:function(){return g}}})(wysihtml5);(function(a){var d=/wysiwyg-font-size-[a-z\-]+/g;a.commands.fontSize={exec:function(b,f,c){return a.commands.formatInline.exec(b,f,"span","wysiwyg-font-size-"+c,d)},state:function(b,f,c){return a.commands.formatInline.state(b,f,"span","wysiwyg-font-size-"+c,d)},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-color-[a-z]+/g;a.commands.foreColor={exec:function(b,f,c){return a.commands.formatInline.exec(b,f,"span","wysiwyg-color-"+c,d)},state:function(b,f,c){return a.commands.formatInline.state(b,f,"span","wysiwyg-color-"+c,d)},value:function(){}}})(wysihtml5);(function(h){function p(b){for(b=b.previousSibling;b&&b.nodeType===h.TEXT_NODE&&!h.lang.string(b.data).trim();){b=b.previousSibling}return b}function j(b){for(b=b.nextSibling;b&&b.nodeType===h.TEXT_NODE&&!h.lang.string(b.data).trim();){b=b.nextSibling}return b}function o(b){return"BR"===b.nodeName||"block"===l.getStyle("display").from(b)?!0:!1}function n(b,r,q,i){if(i){var g=l.observe(b,"DOMNodeInserted",function(d){var d=d.target,e;d.nodeType===h.ELEMENT_NODE&&(e=l.getStyle("display").from(d),"inline"!==e.substr(0,6)&&(d.className+=" "+i))})}b.execCommand(r,!1,q);g&&g.stop()}function m(a,i){a.selection.selectLine();a.selection.surround(i);var g=j(i),c=p(i);g&&"BR"===g.nodeName&&g.parentNode.removeChild(g);c&&"BR"===c.nodeName&&c.parentNode.removeChild(c);(g=i.lastChild)&&"BR"===g.nodeName&&g.parentNode.removeChild(g);a.selection.selectNode(i)}var l=h.dom,k="H1 H2 H3 H4 H5 H6 P BLOCKQUOTE DIV".split(" ");h.commands.formatBlock={exec:function(d,b,c,i,g){var f=d.doc,e=this.state(d,b,c,i,g),a,c="string"===typeof c?c.toUpperCase():c;if(e){d.selection.executeAndRestoreSimple(function(){g&&(e.className=e.className.replace(g,""));var t=!!h.lang.string(e.className).trim();if(!t&&e.nodeName===(c||"DIV")){var t=e,s=t.ownerDocument,r=j(t),q=p(t);r&&!o(r)&&t.parentNode.insertBefore(s.createElement("br"),r);q&&!o(q)&&t.parentNode.insertBefore(s.createElement("br"),t);l.replaceWithChildNodes(e)}else{t&&l.renameElement(e,"DIV")}})}else{if(null===c||h.lang.array(k).contains(c)){if(a=d.selection.getSelectedNode(),e=l.getParentElement(a,{nodeName:k})){d.selection.executeAndRestoreSimple(function(){c&&(e=l.renameElement(e,c));if(i){var q=e;q.className?(q.className=q.className.replace(g,""),q.className+=" "+i):q.className=i}});return}}d.commands.support(b)?n(f,b,c||"DIV",i):(e=f.createElement(c||"DIV"),i&&(e.className=i),m(d,e))}},state:function(g,f,r,q,i){r="string"===typeof r?r.toUpperCase():r;g=g.selection.getSelectedNode();return l.getParentElement(g,{nodeName:r,className:q,classRegExp:i})},value:function(){}}})(wysihtml5);(function(e){function h(o,n,m){var d=o+":"+n;if(!g[d]){var l=g,a=e.selection.HTMLApplier,b=f[o],o=b?[o.toLowerCase(),b.toLowerCase()]:[o.toLowerCase()];l[d]=new a(o,n,m,!0)}return g[d]}var f={strong:"b",em:"i",b:"strong",i:"em"},g={};e.commands.formatInline={exec:function(j,c,m,k,l){c=j.selection.getRange();if(!c){return !1}h(m,k,l).toggleRange(c);j.selection.setSelection(c)},state:function(m,l,j,b,c){var l=m.doc,a=f[j]||j;if(!e.dom.hasElementWithTagName(l,j)&&!e.dom.hasElementWithTagName(l,a)||b&&!e.dom.hasElementWithClassName(l,b)){return !1}m=m.selection.getRange();return !m?!1:h(j,b,c).isAppliedToRange(m)},value:function(){}}})(wysihtml5);(function(a){a.commands.insertHTML={exec:function(c,e,f){c.commands.support(e)?c.doc.execCommand(e,!1,f):c.selection.insertHTML(f)},state:function(){return !1},value:function(){}}})(wysihtml5);(function(a){a.commands.insertImage={exec:function(j,b,i){var i="object"===typeof i?i:{src:i},h=j.doc,b=this.state(j),g;if(b){j.selection.setBefore(b),i=b.parentNode,i.removeChild(b),a.dom.removeEmptyTextNodes(i),"A"===i.nodeName&&!i.firstChild&&(j.selection.setAfter(i),i.parentNode.removeChild(i)),a.quirks.redraw(j.element)}else{b=h.createElement("IMG");for(g in i){b[g]=i[g]}j.selection.insertNode(b);a.browser.hasProblemsSettingCaretAfterImg()?(i=h.createTextNode(a.INVISIBLE_SPACE),j.selection.insertNode(i),j.selection.setAfter(i)):j.selection.setAfter(b)}},state:function(d){var b;if(!a.dom.hasElementWithTagName(d.doc,"IMG")){return !1}b=d.selection.getSelectedNode();if(!b){return !1}if("IMG"===b.nodeName){return b}if(b.nodeType!==a.ELEMENT_NODE){return !1}b=d.selection.getText();if(b=a.lang.string(b).trim()){return !1}d=d.selection.getNodes(a.ELEMENT_NODE,function(c){return"IMG"===c.nodeName});return 1!==d.length?!1:d[0]},value:function(c){return(c=this.state(c))&&c.src}}})(wysihtml5);(function(a){var d="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(b,c){b.commands.support(c)?(b.doc.execCommand(c,!1,null),a.browser.autoScrollsToCaret()||b.selection.scrollIntoView()):b.commands.exec("insertHTML",d)},state:function(){return !1},value:function(){}}})(wysihtml5);(function(a){a.commands.insertOrderedList={exec:function(n,b){var m=n.doc,l=n.selection.getSelectedNode(),k=a.dom.getParentElement(l,{nodeName:"OL"}),j=a.dom.getParentElement(l,{nodeName:"UL"}),l="_wysihtml5-temp-"+(new Date).getTime(),h;n.commands.support(b)?m.execCommand(b,!1,null):k?n.selection.executeAndRestoreSimple(function(){a.dom.resolveList(k)}):j?n.selection.executeAndRestoreSimple(function(){a.dom.renameElement(j,"ol")}):(n.commands.exec("formatBlock","div",l),h=m.querySelector("."+l),m=""===h.innerHTML||h.innerHTML===a.INVISIBLE_SPACE,n.selection.executeAndRestoreSimple(function(){k=a.dom.convertToList(h,"ol")}),m&&n.selection.selectNode(k.querySelector("li")))},state:function(b){b=b.selection.getSelectedNode();return a.dom.getParentElement(b,{nodeName:"OL"})},value:function(){}}})(wysihtml5);(function(a){a.commands.insertUnorderedList={exec:function(n,b){var m=n.doc,l=n.selection.getSelectedNode(),k=a.dom.getParentElement(l,{nodeName:"UL"}),j=a.dom.getParentElement(l,{nodeName:"OL"}),l="_wysihtml5-temp-"+(new Date).getTime(),h;n.commands.support(b)?m.execCommand(b,!1,null):k?n.selection.executeAndRestoreSimple(function(){a.dom.resolveList(k)}):j?n.selection.executeAndRestoreSimple(function(){a.dom.renameElement(j,"ul")}):(n.commands.exec("formatBlock","div",l),h=m.querySelector("."+l),m=""===h.innerHTML||h.innerHTML===a.INVISIBLE_SPACE,n.selection.executeAndRestoreSimple(function(){k=a.dom.convertToList(h,"ul")}),m&&n.selection.selectNode(k.querySelector("li")))},state:function(b){b=b.selection.getSelectedNode();return a.dom.getParentElement(b,{nodeName:"UL"})},value:function(){}}})(wysihtml5);(function(a){a.commands.italic={exec:function(d,b){return a.commands.formatInline.exec(d,b,"i")},state:function(d,b){return a.commands.formatInline.state(d,b,"i")},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-text-align-[a-z]+/g;a.commands.justifyCenter={exec:function(b){return a.commands.formatBlock.exec(b,"formatBlock",null,"wysiwyg-text-align-center",d)},state:function(b){return a.commands.formatBlock.state(b,"formatBlock",null,"wysiwyg-text-align-center",d)},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-text-align-[a-z]+/g;a.commands.justifyLeft={exec:function(b){return a.commands.formatBlock.exec(b,"formatBlock",null,"wysiwyg-text-align-left",d)},state:function(b){return a.commands.formatBlock.state(b,"formatBlock",null,"wysiwyg-text-align-left",d)},value:function(){}}})(wysihtml5);(function(a){var d=/wysiwyg-text-align-[a-z]+/g;a.commands.justifyRight={exec:function(b){return a.commands.formatBlock.exec(b,"formatBlock",null,"wysiwyg-text-align-right",d)},state:function(b){return a.commands.formatBlock.state(b,"formatBlock",null,"wysiwyg-text-align-right",d)},value:function(){}}})(wysihtml5);(function(a){a.commands.underline={exec:function(d,b){return a.commands.formatInline.exec(d,b,"u")},state:function(d,b){return a.commands.formatInline.state(d,b,"u")},value:function(){}}})(wysihtml5);(function(e){var h='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",f='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",g=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(b){this.editor=b;this.composer=b.composer;this.element=this.composer.element;this.history=[this.composer.getValue()];this.position=1;this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var l=this,j=this.composer.sandbox.getDocument(),d;g.observe(this.element,"keydown",function(k){if(!(k.altKey||!k.ctrlKey&&!k.metaKey)){var i=k.keyCode,m=90===i&&k.shiftKey||89===i;90===i&&!k.shiftKey?(l.undo(),k.preventDefault()):m&&(l.redo(),k.preventDefault())}});g.observe(this.element,"keydown",function(i){i=i.keyCode;i!==d&&(d=i,(8===i||46===i)&&l.transact())});if(e.browser.hasUndoInContextMenu()){var b,c,a=function(){for(var i;i=j.querySelector("._wysihtml5-temp");){i.parentNode.removeChild(i)}clearInterval(b)};g.observe(this.element,"contextmenu",function(){a();l.composer.selection.executeAndRestoreSimple(function(){l.element.lastChild&&l.composer.selection.setAfter(l.element.lastChild);j.execCommand("insertHTML",!1,h);j.execCommand("insertHTML",!1,f);j.execCommand("undo",!1,null)});b=setInterval(function(){j.getElementById("_wysihtml5-redo")?(a(),l.redo()):j.getElementById("_wysihtml5-undo")||(a(),l.undo())},400);c||(c=!0,g.observe(document,"mousedown",a),g.observe(j,["mousedown","paste","cut","copy"],a))})}this.editor.observe("newword:composer",function(){l.transact()}).observe("beforecommand:composer",function(){l.transact()})},transact:function(){var d=this.history[this.position-1],c=this.composer.getValue();if(c!=d){if(40<(this.history.length=this.position)){this.history.shift(),this.position--}this.position++;this.history.push(c)}},undo:function(){this.transact();1>=this.position||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(b){this.composer.setValue(b);this.editor.focus(!0)}})})(wysihtml5);wysihtml5.views.View=Base.extend({constructor:function(d,f,e){this.parent=d;this.element=f;this.config=e;this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.observe("beforeload",function(){a.parent.observe("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element){try{this.element.focus()}catch(a){}}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}});(function(d){var f=d.dom,e=d.browser;d.views.Composer=d.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(h,g,i){this.base(h,g,i);this.textarea=this.parent.textarea;this._initSandbox()},clear:function(){this.element.innerHTML=e.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(b){var g=this.isEmpty()?"":d.quirks.getCorrectInnerHTML(this.element);b&&(g=this.parent.parse(g));return g=d.lang.string(g).replace(d.INVISIBLE_SPACE).by("")},setValue:function(g,c){c&&(g=this.parent.parse(g));this.element.innerHTML=g},show:function(){this.iframe.style.display=this._displayStyle||"";this.disable();this.enable()},hide:function(){this._displayStyle=f.getStyle("display").from(this.iframe);"none"===this._displayStyle&&(this._displayStyle=null);this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable");this.base()},enable:function(){this.element.setAttribute("contentEditable","true");this.base()},focus:function(b){d.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear();this.base();var g=this.element.lastChild;b&&g&&("BR"===g.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return f.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var b=this.element.innerHTML;return""===b||b===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector("blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea")},_initSandbox:function(){var g=this;this.sandbox=new f.Sandbox(function(){g._create()},{stylesheets:this.config.stylesheets});this.iframe=this.sandbox.getIframe();var c=document.createElement("input");c.type="hidden";c.name="_wysihtml5_mode";c.value=1;var h=this.textarea.element;f.insert(this.iframe).after(h);f.insert(c).after(h)},_create:function(){var b=this;this.doc=this.sandbox.getDocument();this.element=this.doc.body;this.textarea=this.parent.textarea;this.element.innerHTML=this.textarea.getValue(!0);this.enable();this.selection=new d.Selection(this.parent);this.commands=new d.Commands(this.parent);f.copyAttributes("className spellcheck title lang dir accessKey".split(" ")).from(this.textarea.element).to(this.element);f.addClass(this.element,this.config.composerClassName);this.config.style&&this.style();this.observe();var a=this.config.name;a&&(f.addClass(this.element,a),f.addClass(this.iframe,a));(a="string"===typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder"))&&f.simulatePlaceholder(this.parent,this,a);this.commands.exec("styleWithCSS",!1);this._initAutoLinking();this._initObjectResizing();this._initUndoManager();(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){b.focus()},100);d.quirks.insertLineBreakOnReturn(this);e.clearsContentEditableCorrectly()||d.quirks.ensureProperClearing(this);e.clearsListsInContentEditableCorrectly()||d.quirks.ensureProperClearingOfLists(this);this.initSync&&this.config.sync&&this.initSync();this.textarea.hide();this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var l=this,k=e.canDisableAutoLinking(),j=e.doesAutoLinkingInContentEditable();k&&this.commands.exec("autoUrlDetect",!1);if(this.config.autoLink){(!j||j&&k)&&this.parent.observe("newword:composer",function(){l.selection.executeAndRestore(function(h,g){f.autoLink(g.parentNode)})});var c=this.sandbox.getDocument().getElementsByTagName("a"),a=f.autoLink.URL_REG_EXP,b=function(g){g=d.lang.string(f.getTextContent(g)).trim();"www."===g.substr(0,4)&&(g="http://"+g);return g};f.observe(this.element,"keydown",function(h){if(c.length){var h=l.selection.getSelectedNode(h.target.ownerDocument),g=f.getParentElement(h,{nodeName:"A"},4),i;g&&(i=b(g),setTimeout(function(){var m=b(g);m!==i&&m.match(a)&&g.setAttribute("href",m)},0))}})}},_initObjectResizing:function(){var c=["width","height"],b=c.length,a=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing);this.config.allowObjectResizing?e.supportsEvent("resizeend")&&f.observe(a,"resizeend",function(g){for(var g=g.target||g.srcElement,l=g.style,j=0,i;j<b;j++){i=c[j],l[i]&&(g.setAttribute(i,parseInt(l[i],10)),l[i]="")}d.quirks.redraw(a)}):e.supportsEvent("resizestart")&&f.observe(a,"resizestart",function(g){g.preventDefault()})},_initUndoManager:function(){new d.UndoManager(this.parent)}})})(wysihtml5);(function(s){var r=s.dom,t=document,q=window,p=t.createElement("div"),o="background-color color cursor font-family font-size font-style font-variant font-weight line-height letter-spacing text-align text-decoration text-indent text-rendering word-break word-wrap word-spacing".split(" "),n="background-color border-collapse border-bottom-color border-bottom-style border-bottom-width border-left-color border-left-style border-left-width border-right-color border-right-style border-right-width border-top-color border-top-style border-top-width clear display float margin-bottom margin-left margin-right margin-top outline-color outline-offset outline-width outline-style padding-left padding-right padding-top padding-bottom position top left right bottom z-index vertical-align text-align -webkit-box-sizing -moz-box-sizing -ms-box-sizing box-sizing -webkit-box-shadow -moz-box-shadow -ms-box-shadow box-shadow -webkit-border-top-right-radius -moz-border-radius-topright border-top-right-radius -webkit-border-bottom-right-radius -moz-border-radius-bottomright border-bottom-right-radius -webkit-border-bottom-left-radius -moz-border-radius-bottomleft border-bottom-left-radius -webkit-border-top-left-radius -moz-border-radius-topleft border-top-left-radius width height".split(" "),l="width height top left right bottom".split(" "),m=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",s.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],j=function(a){if(a.setActive){try{a.setActive()}catch(k){}}else{var i=a.style,c=t.documentElement.scrollTop||t.body.scrollTop,d=t.documentElement.scrollLeft||t.body.scrollLeft,i={position:i.position,top:i.top,left:i.left,WebkitUserSelect:i.WebkitUserSelect};r.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(a);a.focus();r.setStyles(i).on(a);q.scrollTo&&q.scrollTo(d,c)}};s.views.Composer.prototype.style=function(){var b=this,g=t.querySelector(":focus"),f=this.textarea.element,e=f.hasAttribute("placeholder"),d=e&&f.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||p.cloneNode(!1);this.blurStylesHost=this.blurStylesHost||p.cloneNode(!1);e&&f.removeAttribute("placeholder");f===g&&f.blur();r.copyStyles(n).from(f).to(this.iframe).andTo(this.blurStylesHost);r.copyStyles(o).from(f).to(this.element).andTo(this.blurStylesHost);r.insertCSS(m).into(this.element.ownerDocument);j(f);r.copyStyles(n).from(f).to(this.focusStylesHost);r.copyStyles(o).from(f).to(this.focusStylesHost);var a=s.lang.array(n).without(["display"]);g?g.focus():f.blur();e&&f.setAttribute("placeholder",d);if(!s.browser.hasCurrentStyleProperty()){var c=r.observe(q,"resize",function(){if(r.contains(document.documentElement,b.iframe)){var i=r.getStyle("display").from(f),h=r.getStyle("display").from(b.iframe);f.style.display="";b.iframe.style.display="none";r.copyStyles(l).from(f).to(b.iframe).andTo(b.focusStylesHost).andTo(b.blurStylesHost);b.iframe.style.display=h;f.style.display=i}else{c.stop()}})}this.parent.observe("focus:composer",function(){r.copyStyles(a).from(b.focusStylesHost).to(b.iframe);r.copyStyles(o).from(b.focusStylesHost).to(b.element)});this.parent.observe("blur:composer",function(){r.copyStyles(a).from(b.blurStylesHost).to(b.iframe);r.copyStyles(o).from(b.blurStylesHost).to(b.element)});return this}})(wysihtml5);(function(e){var h=e.dom,f=e.browser,g={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var o=this,m=this.getValue(),l=this.sandbox.getIframe(),c=this.element,d=f.supportsEventsInIframeCorrectly()?c:this.sandbox.getWindow(),a=f.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];h.observe(l,"DOMNodeRemoved",function(){clearInterval(b);o.parent.fire("destroy:composer")});var b=setInterval(function(){h.contains(document.documentElement,l)||(clearInterval(b),o.parent.fire("destroy:composer"))},250);h.observe(d,"focus",function(){o.parent.fire("focus").fire("focus:composer");setTimeout(function(){m=o.getValue()},0)});h.observe(d,"blur",function(){m!==o.getValue()&&o.parent.fire("change").fire("change:composer");o.parent.fire("blur").fire("blur:composer")});e.browser.isIos()&&h.observe(c,"blur",function(){var j=c.ownerDocument.createElement("input"),i=document.documentElement.scrollTop||document.body.scrollTop,n=document.documentElement.scrollLeft||document.body.scrollLeft;try{o.selection.insertNode(j)}catch(k){c.appendChild(j)}j.focus();j.parentNode.removeChild(j);window.scrollTo(n,i)});h.observe(c,"dragenter",function(){o.parent.fire("unset_placeholder")});f.firesOnDropOnlyWhenOnDragOverIsCancelled()&&h.observe(c,["dragover","dragenter"],function(i){i.preventDefault()});h.observe(c,a,function(i){var k=i.dataTransfer,j;k&&f.supportsDataTransfer()&&(j=k.getData("text/html")||k.getData("text/plain"));j?(c.focus(),o.commands.exec("insertHTML",j),o.parent.fire("paste").fire("paste:composer"),i.stopPropagation(),i.preventDefault()):setTimeout(function(){o.parent.fire("paste").fire("paste:composer")},0)});h.observe(c,"keyup",function(i){i=i.keyCode;(i===e.SPACE_KEY||i===e.ENTER_KEY)&&o.parent.fire("newword:composer")});this.parent.observe("paste:composer",function(){setTimeout(function(){o.parent.fire("newword:composer")},0)});f.canSelectImagesInContentEditable()||h.observe(c,"mousedown",function(j){var i=j.target;"IMG"===i.nodeName&&(o.selection.selectNode(i),j.preventDefault())});h.observe(c,"keydown",function(j){var i=g[j.keyCode];if((j.ctrlKey||j.metaKey)&&!j.altKey&&i){o.commands.exec(i),j.preventDefault()}});h.observe(c,"keydown",function(i){var k=o.selection.getSelectedNode(!0),j=i.keyCode;if(k&&"IMG"===k.nodeName&&(j===e.BACKSPACE_KEY||j===e.DELETE_KEY)){j=k.parentNode,j.removeChild(k),"A"===j.nodeName&&!j.firstChild&&j.parentNode.removeChild(j),setTimeout(function(){e.quirks.redraw(c)},0),i.preventDefault()}});var p={IMG:"Image: ",A:"Link: "};h.observe(c,"mouseover",function(j){var j=j.target,i=j.nodeName;!("A"!==i&&"IMG"!==i)&&!j.hasAttribute("title")&&(i=p[i]+(j.getAttribute("href")||j.getAttribute("src")),j.setAttribute("title",i))})}})(wysihtml5);(function(a){a.views.Synchronizer=Base.extend({constructor:function(c,e,f){this.editor=c;this.textarea=e;this.composer=f;this._observe()},fromComposerToTextarea:function(b){this.textarea.setValue(a.lang.string(this.composer.getValue()).trim(),b)},fromTextareaToComposer:function(c){var d=this.textarea.getValue();d?this.composer.setValue(d,c):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(c){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(c):this.fromComposerToTextarea(c)},_observe:function(){var j,b=this,i=this.textarea.element.form,h=function(){j=setInterval(function(){b.fromComposerToTextarea()},400)},g=function(){clearInterval(j);j=null};h();i&&(a.dom.observe(i,"submit",function(){b.sync(!0)}),a.dom.observe(i,"reset",function(){setTimeout(function(){b.fromTextareaToComposer()},0)}));this.editor.observe("change_view",function(c){if(c==="composer"&&!j){b.fromTextareaToComposer(true);h()}else{if(c==="textarea"){b.fromComposerToTextarea(true);g()}}});this.editor.observe("destroy:composer",g)}})})(wysihtml5);wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(d,f,e){this.base(d,f,e);this._observe()},clear:function(){this.element.value=""},getValue:function(a){var d=this.isEmpty()?"":this.element.value;a&&(d=this.parent.parse(d));return d},setValue:function(a,d){d&&(a=this.parent.parse(a));this.element.value=a},hasPlaceholderSet:function(){var d=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),f=this.element.getAttribute("placeholder")||null,e=this.element.value;return d&&!e||e===f},isEmpty:function(){return !wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,h=this.parent,f={focusin:"focus",focusout:"blur"},g=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];h.observe("beforeload",function(){wysihtml5.dom.observe(e,g,function(a){a=f[a.type]||a.type;h.fire(a).fire(a+":textarea")});wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){h.fire("paste").fire("paste:textarea")},0)})})}});(function(a){var d=a.dom;a.toolbar.Dialog=a.lang.Dispatcher.extend({constructor:function(e,c){this.link=e;this.container=c},_observe:function(){if(!this._observed){var b=this,l=function(e){var f=b._serialize();f==b.elementToChange?b.fire("edit",f):b.fire("save",f);b.hide();e.preventDefault();e.stopPropagation()};d.observe(b.link,"click",function(){d.hasClass(b.link,"wysihtml5-command-dialog-opened")&&setTimeout(function(){b.hide()},0)});d.observe(this.container,"keydown",function(g){var f=g.keyCode;f===a.ENTER_KEY&&l(g);f===a.ESCAPE_KEY&&b.hide()});d.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",l);d.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){b.fire("cancel");b.hide();e.preventDefault();e.stopPropagation()});for(var k=this.container.querySelectorAll("input, select, textarea"),j=0,h=k.length,c=function(){clearInterval(b.interval)};j<h;j++){d.observe(k[j],"change",c)}this._observed=!0}},_serialize:function(){for(var g=this.elementToChange||{},e=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),i=e.length,h=0;h<i;h++){g[e[h].getAttribute("data-wysihtml5-dialog-field")]=e[h].value}return g},_interpolate:function(j){for(var e,o,n=document.querySelector(":focus"),m=this.container.querySelectorAll("[data-wysihtml5-dialog-field]"),k=m.length,l=0;l<k;l++){e=m[l],e!==n&&!(j&&"hidden"===e.type)&&(o=e.getAttribute("data-wysihtml5-dialog-field"),o=this.elementToChange?this.elementToChange[o]||"":e.defaultValue,e.value=o)}},show:function(g){var c=this,i=this.container.querySelector("input, select, textarea");this.elementToChange=g;this._observe();this._interpolate();g&&(this.interval=setInterval(function(){c._interpolate(!0)},500));d.addClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="";this.fire("show");if(i&&!g){try{i.focus()}catch(h){}}},hide:function(){clearInterval(this.interval);this.elementToChange=null;d.removeClass(this.link,"wysihtml5-command-dialog-opened");this.container.style.display="none";this.fire("hide")}})})(wysihtml5);(function(g){var l=g.dom,h={position:"relative"},k={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},j={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},i={"x-webkit-speech":"",speech:""};g.toolbar.Speech=function(d,b){var c=document.createElement("input");if(g.browser.supportsSpeechApiOn(c)){var a=document.createElement("div");g.lang.object(k).merge({width:b.offsetWidth+"px",height:b.offsetHeight+"px"});l.insert(c).into(a);l.insert(a).into(b);l.setStyles(j).on(c);l.setAttributes(i).on(c);l.setStyles(k).on(a);l.setStyles(h).on(b);l.observe(c,"onwebkitspeechchange" in c?"webkitspeechchange":"speechchange",function(){d.execCommand("insertText",c.value);c.value=""});l.observe(c,"click",function(e){l.hasClass(b,"wysihtml5-command-disabled")&&e.preventDefault();e.stopPropagation()})}else{b.style.display="none"}}})(wysihtml5);(function(a){var d=a.dom;a.toolbar.Toolbar=Base.extend({constructor:function(b,k){this.editor=b;this.container="string"===typeof k?document.getElementById(k):k;this.composer=b.composer;this._getLinks("command");this._getLinks("action");this._observe();this.show();for(var j=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),i=j.length,h=0;h<i;h++){new a.toolbar.Speech(this,j[h])}},_getLinks:function(u){for(var t=this[u+"Links"]=a.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+u+"]")).get(),s=t.length,r=0,q=this[u+"Mapping"]={},o,p,l,m,b;r<s;r++){o=t[r],l=o.getAttribute("data-wysihtml5-"+u),m=o.getAttribute("data-wysihtml5-"+u+"-value"),p=this.container.querySelector("[data-wysihtml5-"+u+"-group='"+l+"']"),b=this._getDialog(o,l),q[l+":"+m]={link:o,group:p,name:l,value:m,dialog:b,state:!1}}},_getDialog:function(b,m){var l=this,k=this.container.querySelector("[data-wysihtml5-dialog='"+m+"']"),j,h;k&&(j=new a.toolbar.Dialog(b,k),j.observe("show",function(){h=l.composer.selection.getBookmark();l.editor.fire("show:dialog",{command:m,dialogContainer:k,commandLink:b})}),j.observe("save",function(c){h&&l.composer.selection.setBookmark(h);l._execCommand(m,c);l.editor.fire("save:dialog",{command:m,dialogContainer:k,commandLink:b})}),j.observe("cancel",function(){l.editor.focus(!1);l.editor.fire("cancel:dialog",{command:m,dialogContainer:k,commandLink:b})}));return j},execCommand:function(f,e){if(!this.commandsDisabled){var g=this.commandMapping[f+":"+e];g&&g.dialog&&!g.state?g.dialog.show():this._execCommand(f,e)}},_execCommand:function(e,c){this.editor.focus(!1);this.composer.commands.exec(e,c);this._updateLinkStates()},execAction:function(e){var c=this.editor;switch(e){case"change_view":c.currentView===c.textarea?c.fire("change_view","composer"):c.fire("change_view","textarea")}},_observe:function(){for(var h=this,c=this.editor,m=this.container,l=this.commandLinks.concat(this.actionLinks),k=l.length,j=0;j<k;j++){d.setAttributes({href:"javascript:;",unselectable:"on"}).on(l[j])}d.delegate(m,"[data-wysihtml5-command]","mousedown",function(b){b.preventDefault()});d.delegate(m,"[data-wysihtml5-command]","click",function(e){var g=this.getAttribute("data-wysihtml5-command"),f=this.getAttribute("data-wysihtml5-command-value");h.execCommand(g,f);e.preventDefault()});d.delegate(m,"[data-wysihtml5-action]","click",function(e){var f=this.getAttribute("data-wysihtml5-action");h.execAction(f);e.preventDefault()});c.observe("focus:composer",function(){h.bookmark=null;clearInterval(h.interval);h.interval=setInterval(function(){h._updateLinkStates()},500)});c.observe("blur:composer",function(){clearInterval(h.interval)});c.observe("destroy:composer",function(){clearInterval(h.interval)});c.observe("change_view",function(e){setTimeout(function(){h.commandsDisabled="composer"!==e;h._updateLinkStates();h.commandsDisabled?d.addClass(m,"wysihtml5-commands-disabled"):d.removeClass(m,"wysihtml5-commands-disabled")},0)})},_updateLinkStates:function(){var b=this.commandMapping,j=this.actionMapping,i,h,c;for(i in b){if(c=b[i],this.commandsDisabled?(h=!1,d.removeClass(c.link,"wysihtml5-command-active"),c.group&&d.removeClass(c.group,"wysihtml5-command-active"),c.dialog&&c.dialog.hide()):(h=this.composer.commands.state(c.name,c.value),a.lang.object(h).isArray()&&(h=1===h.length?h[0]:!0),d.removeClass(c.link,"wysihtml5-command-disabled"),c.group&&d.removeClass(c.group,"wysihtml5-command-disabled")),c.state!==h){(c.state=h)?(d.addClass(c.link,"wysihtml5-command-active"),c.group&&d.addClass(c.group,"wysihtml5-command-active"),c.dialog&&("object"===typeof h?c.dialog.show(h):c.dialog.hide())):(d.removeClass(c.link,"wysihtml5-command-active"),c.group&&d.removeClass(c.group,"wysihtml5-command-active"),c.dialog&&c.dialog.hide())}}for(i in j){b=j[i],"change_view"===b.name&&(b.state=this.editor.currentView===this.editor.textarea,b.state?d.addClass(b.link,"wysihtml5-action-active"):d.removeClass(b.link,"wysihtml5-action-active"))}},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})})(wysihtml5);(function(a){var d={name:void 0,style:!0,toolbar:void 0,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:a.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:void 0,allowObjectResizing:!0,supportTouchDevices:!0};a.Editor=a.lang.Dispatcher.extend({constructor:function(b,h){this.textareaElement="string"===typeof b?document.getElementById(b):b;this.config=a.lang.object({}).merge(d).merge(h).get();this.currentView=this.textarea=new a.views.Textarea(this,this.textareaElement,this.config);this._isCompatible=a.browser.supported();if(!this._isCompatible||!this.config.supportTouchDevices&&a.browser.isTouchDevice()){var g=this;setTimeout(function(){g.fire("beforeload").fire("load")},0)}else{a.dom.addClass(document.body,this.config.bodyClassName);this.currentView=this.composer=new a.views.Composer(this,this.textareaElement,this.config);"function"===typeof this.config.parser&&this._initParser();this.observe("beforeload",function(){this.synchronizer=new a.views.Synchronizer(this,this.textarea,this.composer);this.config.toolbar&&(this.toolbar=new a.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(c){}}},isCompatible:function(){return this._isCompatible},clear:function(){this.currentView.clear();return this},getValue:function(b){return this.currentView.getValue(b)},setValue:function(e,c){if(!e){return this.clear()}this.currentView.setValue(e,c);return this},focus:function(b){this.currentView.focus(b);return this},disable:function(){this.currentView.disable();return this},enable:function(){this.currentView.enable();return this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(b){var e=this.config.parser(b,this.config.parserRules,this.composer.sandbox.getDocument(),!0);"object"===typeof b&&a.quirks.redraw(b);return e},_initParser:function(){this.observe("paste:composer",function(){var b=this;b.composer.selection.executeAndRestore(function(){a.quirks.cleanPastedHTML(b.composer.element);b.parse(b.composer.element)},!0)});this.observe("paste:textarea",function(){this.textarea.setValue(this.parse(this.textarea.getValue()))})}})})(wysihtml5);!function(f,h){var d={"font-styles":function(i,j){var k=j&&j.size?" btn-"+j.size:"";return"<li class='dropdown'><a class='btn dropdown-toggle"+k+"' data-toggle='dropdown' href='#'><i class='icon-font'></i>&nbsp;<span class='current-font'>"+i.font_styles.normal+"</span>&nbsp;<b class='caret'></b></a><ul class='dropdown-menu'><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div' tabindex='-1'>"+i.font_styles.normal+"</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1' tabindex='-1'>"+i.font_styles.h1+"</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2' tabindex='-1'>"+i.font_styles.h2+"</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h3' tabindex='-1'>"+i.font_styles.h3+"</a></li></ul></li>"},emphasis:function(i,j){var k=j&&j.size?" btn-"+j.size:"";return"<li><div class='btn-group'><a class='btn"+k+"' data-wysihtml5-command='bold' title='CTRL+B' tabindex='-1'>"+i.emphasis.bold+"</a><a class='btn"+k+"' data-wysihtml5-command='italic' title='CTRL+I' tabindex='-1'>"+i.emphasis.italic+"</a><a class='btn"+k+"' data-wysihtml5-command='underline' title='CTRL+U' tabindex='-1'>"+i.emphasis.underline+"</a></div></li>"},lists:function(i,j){var k=j&&j.size?" btn-"+j.size:"";return"<li><div class='btn-group'><a class='btn"+k+"' data-wysihtml5-command='insertUnorderedList' title='"+i.lists.unordered+"' tabindex='-1'><i class='icon-list'></i></a><a class='btn"+k+"' data-wysihtml5-command='insertOrderedList' title='"+i.lists.ordered+"' tabindex='-1'><i class='icon-th-list'></i></a><a class='btn"+k+"' data-wysihtml5-command='Outdent' title='"+i.lists.outdent+"' tabindex='-1'><i class='icon-indent-right'></i></a><a class='btn"+k+"' data-wysihtml5-command='Indent' title='"+i.lists.indent+"' tabindex='-1'><i class='icon-indent-left'></i></a></div></li>"},link:function(i,j){var k=j&&j.size?" btn-"+j.size:"";return"<li><div class='bootstrap-wysihtml5-insert-link-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>"+i.link.insert+"</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-link-url input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>"+i.link.cancel+"</a><a href='#' class='btn btn-primary' data-dismiss='modal'>"+i.link.insert+"</a></div></div><a class='btn"+k+"' data-wysihtml5-command='createLink' title='"+i.link.insert+"' tabindex='-1'><i class='icon-share'></i></a></li>"},image:function(i,j){var k=j&&j.size?" btn-"+j.size:"";return"<li><div class='bootstrap-wysihtml5-insert-image-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>"+i.image.insert+"</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-image-url input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>"+i.image.cancel+"</a><a href='#' class='btn btn-primary' data-dismiss='modal'>"+i.image.insert+"</a></div></div><a class='btn"+k+"' data-wysihtml5-command='insertImage' title='"+i.image.insert+"' tabindex='-1'><i class='icon-picture'></i></a></li>"},html:function(i,j){var k=j&&j.size?" btn-"+j.size:"";return"<li><div class='btn-group'><a class='btn"+k+"' data-wysihtml5-action='change_view' title='"+i.html.edit+"' tabindex='-1'><i class='icon-pencil'></i></a></div></li>"},color:function(i,j){var k=j&&j.size?" btn-"+j.size:"";return"<li class='dropdown'><a class='btn dropdown-toggle"+k+"' data-toggle='dropdown' href='#' tabindex='-1'><span class='current-color'>"+i.colours.black+"</span>&nbsp;<b class='caret'></b></a><ul class='dropdown-menu'><li><div class='wysihtml5-colors' data-wysihtml5-command-value='black'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='black'>"+i.colours.black+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='silver'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='silver'>"+i.colours.silver+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='gray'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='gray'>"+i.colours.gray+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='maroon'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='maroon'>"+i.colours.maroon+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='red'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='red'>"+i.colours.red+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='purple'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='purple'>"+i.colours.purple+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='green'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='green'>"+i.colours.green+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='olive'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='olive'>"+i.colours.olive+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='navy'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='navy'>"+i.colours.navy+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='blue'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='blue'>"+i.colours.blue+"</a></li><li><div class='wysihtml5-colors' data-wysihtml5-command-value='orange'></div><a class='wysihtml5-colors-title' data-wysihtml5-command='foreColor' data-wysihtml5-command-value='orange'>"+i.colours.orange+"</a></li></ul></li>"}};var e=function(k,i,j){return d[k](i,j)};var g=function(k,i){this.el=k;var l=i||b;for(var j in l.customTemplates){d[j]=l.customTemplates[j]}this.toolbar=this.createToolbar(k,l);this.editor=this.createEditor(i);window.editor=this.editor;f("iframe.wysihtml5-sandbox").each(function(m,n){f(n.contentWindow).off("focus.wysihtml5").on({"focus.wysihtml5":function(){f("li.dropdown").removeClass("open")}})})};g.prototype={constructor:g,createEditor:function(j){j=j||{};j=f.extend(true,{},j);j.toolbar=this.toolbar[0];var k=new h.Editor(this.el[0],j);if(j&&j.events){for(var i in j.events){k.on(i,j.events[i])}}return k},createToolbar:function(m,k){var j=this;var n=f("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"});var i=k.locale||b.locale||"en";for(var l in b){var o=false;if(k[l]!==undefined){if(k[l]===true){o=true}}else{o=b[l]}if(o===true){n.append(e(l,a[i],k));if(l==="html"){this.initHtml(n)}if(l==="link"){this.initInsertLink(n)}if(l==="image"){this.initInsertImage(n)}}}if(k.toolbar){for(l in k.toolbar){n.append(k.toolbar[l])}}n.find("a[data-wysihtml5-command='formatBlock']").click(function(r){var q=r.target||r.srcElement;var p=f(q);j.toolbar.find(".current-font").text(p.html())});n.find("a[data-wysihtml5-command='foreColor']").click(function(r){var q=r.target||r.srcElement;var p=f(q);j.toolbar.find(".current-color").text(p.html())});this.el.before(n);return n},initHtml:function(i){var j="a[data-wysihtml5-action='change_view']";i.find(j).click(function(k){i.find("a.btn").not(j).toggleClass("disabled")})},initInsertImage:function(p){var k=this;var o=p.find(".bootstrap-wysihtml5-insert-image-modal");var m=o.find(".bootstrap-wysihtml5-insert-image-url");var j=o.find("a.btn-primary");var i=m.val();var l;var n=function(){var q=m.val();m.val(i);k.editor.currentView.element.focus();if(l){k.editor.composer.selection.setBookmark(l);l=null}k.editor.composer.commands.exec("insertImage",q)};m.keypress(function(q){if(q.which==13){n();o.modal("hide")}});j.click(n);o.on("shown",function(){m.focus()});o.on("hide",function(){k.editor.currentView.element.focus()});p.find("a[data-wysihtml5-command=insertImage]").click(function(){var q=f(this).hasClass("wysihtml5-command-active");if(!q){k.editor.currentView.element.focus(false);l=k.editor.composer.selection.getBookmark();o.appendTo("body").modal("show");o.on("click.dismiss.modal",'[data-dismiss="modal"]',function(r){r.stopPropagation()});return false}else{return true}})},initInsertLink:function(n){var q=this;var j=n.find(".bootstrap-wysihtml5-insert-link-modal");var l=j.find(".bootstrap-wysihtml5-insert-link-url");var k=j.find("a.btn-primary");var p=l.val();var i;var o=function(){var r=l.val();l.val(p);q.editor.currentView.element.focus();if(i){q.editor.composer.selection.setBookmark(i);i=null}q.editor.composer.commands.exec("createLink",{href:r,target:"_blank",rel:"nofollow"})};var m=false;l.keypress(function(r){if(r.which==13){o();j.modal("hide")}});k.click(o);j.on("shown",function(){l.focus()});j.on("hide",function(){q.editor.currentView.element.focus()});n.find("a[data-wysihtml5-command=createLink]").click(function(){var r=f(this).hasClass("wysihtml5-command-active");if(!r){q.editor.currentView.element.focus(false);i=q.editor.composer.selection.getBookmark();j.appendTo("body").modal("show");j.on("click.dismiss.modal",'[data-dismiss="modal"]',function(s){s.stopPropagation()});return false}else{return true}})}};var c={resetDefaults:function(){f.fn.wysihtml5.defaultOptions=f.extend(true,{},f.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(i){return this.each(function(){var j=f(this);j.data("wysihtml5",new g(j,i))})},shallowExtend:function(i){var j=f.extend({},f.fn.wysihtml5.defaultOptions,i||{});var k=this;return c.bypassDefaults.apply(k,[j])},deepExtend:function(i){var j=f.extend(true,{},f.fn.wysihtml5.defaultOptions,i||{});var k=this;return c.bypassDefaults.apply(k,[j])},init:function(i){var j=this;return c.shallowExtend.apply(j,[i])}};f.fn.wysihtml5=function(i){if(c[i]){return c[i].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof i==="object"||!i){return c.init.apply(this,arguments)}else{f.error("Method "+i+" does not exist on jQuery.wysihtml5")}}};f.fn.wysihtml5.Constructor=g;var b=f.fn.wysihtml5.defaultOptions={"font-styles":true,color:false,emphasis:true,lists:true,html:false,link:true,image:true,events:{},parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{set_attributes:{target:"_blank",rel:"nofollow"},check_attributes:{href:"url"}},span:1,div:1,code:1,pre:1}},stylesheets:["./lib/css/wysiwyg-color.css"],locale:"en"};if(typeof f.fn.wysihtml5.defaultOptionsCache==="undefined"){f.fn.wysihtml5.defaultOptionsCache=f.extend(true,{},f.fn.wysihtml5.defaultOptions)}var a=f.fn.wysihtml5.locale={en:{font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}}}(window.jQuery,window.wysihtml5);(function(a){var b=function(c){this.init("wysihtml5",c,b.defaults);this.options.wysihtml5=a.extend({},b.defaults.wysihtml5,c.wysihtml5)};a.fn.editableutils.inherit(b,a.fn.editabletypes.abstractinput);a.extend(b.prototype,{render:function(){var d=a.Deferred(),c;this.$input.attr("id","textarea_"+(new Date()).getTime());this.setClass();this.setAttr("placeholder");a.extend(this.options.wysihtml5,{events:{load:function(){d.resolve()}}});this.$input.wysihtml5(this.options.wysihtml5);c=/msie\s*(8|7|6)/.test(navigator.userAgent.toLowerCase());if(c){this.$input.before("<br><br>")}return d.promise()},value2html:function(d,c){a(c).html(d)},html2value:function(c){return c},value2input:function(c){this.$input.data("wysihtml5").editor.setValue(c,true)},activate:function(){this.$input.data("wysihtml5").editor.focus()}});b.defaults=a.extend({},a.fn.editabletypes.abstractinput.defaults,{tpl:"<textarea></textarea>",inputclass:"editable-wysihtml5",placeholder:null,wysihtml5:{stylesheets:false}});a.fn.editabletypes.wysihtml5=b}(window.jQuery));(function(a){if(typeof a.fn.each2=="undefined"){a.fn.extend({each2:function(f){var d=a([0]),e=-1,b=this.length;while(++e<b&&(d.context=d[0]=this[e])&&f.call(d[0],e,d)!==false){}return this}})}})(jQuery);(function(j,l){if(window.Select2!==l){return}var c,e,w,G,u,a,C,D;c={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(H){H=H.which?H.which:H;switch(H){case c.LEFT:case c.RIGHT:case c.UP:case c.DOWN:return true}return false},isControl:function(I){var H=I.which;switch(H){case c.SHIFT:case c.CTRL:case c.ALT:return true}if(I.metaKey){return true}return false},isFunctionKey:function(H){H=H.which?H.which:H;return H>=112&&H<=123}};D=j(document);u=(function(){var H=1;return function(){return H++}}());function b(J,K){var I=0,H=K.length;for(;I<H;I=I+1){if(q(J,K[I])){return I}}return -1}function q(I,H){if(I===H){return true}if(I===l||H===l){return false}if(I===null||H===null){return false}if(I.constructor===String){return I+""===H+""}if(H.constructor===String){return H+""===I+""}return false}function m(I,K){var L,J,H;if(I===null||I.length<1){return[]}L=I.split(K);for(J=0,H=L.length;J<H;J=J+1){L[J]=j.trim(L[J])}return L}function n(H){return H.outerWidth(false)-H.width()}function B(I){var H="keyup-change-value";I.bind("keydown",function(){if(j.data(I,H)===l){j.data(I,H,I.val())}});I.bind("keyup",function(){var J=j.data(I,H);if(J!==l&&I.val()!==J){j.removeData(I,H);I.trigger("keyup-change")}})}D.bind("mousemove",function(H){C={x:H.pageX,y:H.pageY}});function v(H){H.bind("mousemove",function(J){var I=C;if(I===l||I.x!==J.pageX||I.y!==J.pageY){j(J.target).trigger("mousemove-filtered",J)}})}function g(K,I,H){H=H||l;var J;return function(){var L=arguments;window.clearTimeout(J);J=window.setTimeout(function(){I.apply(H,L)},K)}}function E(J){var H=false,I;return function(){if(H===false){I=J();H=true}return I}}function f(H,J){var I=g(H,function(K){J.trigger("scroll-debounced",K)});J.bind("scroll",function(K){if(b(K.target,J.get())>=0){I(K)}})}function r(H){if(H[0]===document.activeElement){return}window.setTimeout(function(){var J=H[0],K=H.val().length,I;H.focus();if(H.is(":visible")&&J===document.activeElement){if(J.setSelectionRange){J.setSelectionRange(K,K)}else{if(J.createTextRange){I=J.createTextRange();I.collapse(false);I.select()}}}},0)}function d(H){H.preventDefault();H.stopPropagation()}function F(H){H.preventDefault();H.stopImmediatePropagation()}function z(I){if(!a){var H=I[0].currentStyle||window.getComputedStyle(I[0],null);a=j(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:H.fontSize,fontFamily:H.fontFamily,fontStyle:H.fontStyle,fontWeight:H.fontWeight,letterSpacing:H.letterSpacing,textTransform:H.textTransform,whiteSpace:"nowrap"});a.attr("class","select2-sizer");j("body").append(a)}a.text(I.val());return a.width()}function y(I,M,H){var K,L=[],J;K=I.attr("class");if(K){K=""+K;j(K.split(" ")).each2(function(){if(this.indexOf("select2-")===0){L.push(this)}})}K=M.attr("class");if(K){K=""+K;j(K.split(" ")).each2(function(){if(this.indexOf("select2-")!==0){J=H(this);if(J){L.push(this)}}})}I.attr("class",L.join(" "))}function i(M,L,J,H){var K=M.toUpperCase().indexOf(L.toUpperCase()),I=L.length;if(K<0){J.push(H(M));return}J.push(H(M.substring(0,K)));J.push("<span class='select2-match'>");J.push(H(M.substring(K,K+I)));J.push("</span>");J.push(H(M.substring(K+I,M.length)))}function p(J){var M,I=0,K=null,N=J.quietMillis||100,L=J.url,H=this;return function(O){window.clearTimeout(M);M=window.setTimeout(function(){I+=1;var Q=I,S=J.data,P=L,U=J.transport||j.ajax,R=J.type||"GET",T={};S=S?S.call(H,O.term,O.page,O.context):null;P=(typeof P==="function")?P.call(H,O.term,O.page,O.context):P;if(null!==K){K.abort()}if(J.params){if(j.isFunction(J.params)){j.extend(T,J.params.call(H))}else{j.extend(T,J.params)}}j.extend(T,{url:P,dataType:J.dataType,data:S,type:R,cache:false,success:function(W){if(Q<I){return}var V=J.results(W,O.page);O.callback(V)}});K=U.call(H,T)},N)}}function s(I){var L=I,K,J,M=function(N){return""+N.text};if(j.isArray(L)){J=L;L={results:J}}if(j.isFunction(L)===false){J=L;L=function(){return J}}var H=L();if(H.text){M=H.text;if(!j.isFunction(M)){K=L.text;M=function(N){return N[K]}}}return function(P){var O=P.term,N={results:[]},Q;if(O===""){P.callback(L());return}Q=function(S,U){var T,R;S=S[0];if(S.children){T={};for(R in S){if(S.hasOwnProperty(R)){T[R]=S[R]}}T.children=[];j(S.children).each2(function(V,W){Q(W,T.children)});if(T.children.length||P.matcher(O,M(T),S)){U.push(T)}}else{if(P.matcher(O,M(S),S)){U.push(S)}}};j(L().results).each2(function(S,R){Q(R,N.results)});P.callback(N)}}function o(I){var H=j.isFunction(I);return function(L){var K=L.term,J={results:[]};j(H?I():I).each(function(){var M=this.text!==l,N=M?this.text:this;if(K===""||L.matcher(K,N)){J.results.push(M?this:{id:this,text:this})}});L.callback(J)}}function k(H,I){if(j.isFunction(H)){return true}if(!H){return false}throw new Error("formatterName must be a function or a falsy value")}function t(H){return j.isFunction(H)?H():H}function h(H){var I=0;j.each(H,function(J,K){if(K.children){I+=h(K.children)}else{I++}});return I}function A(P,Q,N,H){var I=P,R=false,K,O,L,J,M;if(!H.createSearchChoice||!H.tokenSeparators||H.tokenSeparators.length<1){return l}while(true){O=-1;for(L=0,J=H.tokenSeparators.length;L<J;L++){M=H.tokenSeparators[L];O=P.indexOf(M);if(O>=0){break}}if(O<0){break}K=P.substring(0,O);P=P.substring(O+M.length);if(K.length>0){K=H.createSearchChoice(K,Q);if(K!==l&&K!==null&&H.id(K)!==l&&H.id(K)!==null){R=false;for(L=0,J=Q.length;L<J;L++){if(q(H.id(K),H.id(Q[L]))){R=true;break}}if(!R){N(K)}}}}if(I!==P){return P}}function x(H,I){var J=function(){};J.prototype=new H;J.prototype.constructor=J;J.prototype.parent=H.prototype;J.prototype=j.extend(J.prototype,I);return J}e=x(Object,{bind:function(I){var H=this;return function(){I.apply(H,arguments)}},init:function(K){var J,I,L=".select2-results",H;this.opts=K=this.prepareOpts(K);this.id=K.id;if(K.element.data("select2")!==l&&K.element.data("select2")!==null){this.destroy()}this.enabled=true;this.container=this.createContainer();this.containerId="s2id_"+(K.element.attr("id")||"autogen"+u());this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1");this.container.attr("id",this.containerId);this.body=E(function(){return K.element.closest("body")});y(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.css(t(K.containerCss));this.container.addClass(t(K.containerCssClass));this.elementTabIndex=this.opts.element.attr("tabIndex");this.opts.element.data("select2",this).addClass("select2-offscreen").bind("focus.select2",function(){j(this).select2("focus")}).attr("tabIndex","-1").before(this.container);this.container.data("select2",this);this.dropdown=this.container.find(".select2-drop");this.dropdown.addClass(t(K.dropdownCssClass));this.dropdown.data("select2",this);this.results=J=this.container.find(L);this.search=I=this.container.find("input.select2-input");I.attr("tabIndex",this.elementTabIndex);this.resultsPage=0;this.context=null;this.initContainer();v(this.results);this.dropdown.delegate(L,"mousemove-filtered touchstart touchmove touchend",this.bind(this.highlightUnderEvent));f(80,this.results);this.dropdown.delegate(L,"scroll-debounced",this.bind(this.loadMoreIfNeeded));if(j.fn.mousewheel){J.mousewheel(function(Q,R,O,N){var P=J.scrollTop(),M;if(N>0&&P-N<=0){J.scrollTop(0);d(Q)}else{if(N<0&&J.get(0).scrollHeight-J.scrollTop()+N<=J.height()){J.scrollTop(J.get(0).scrollHeight-J.height());d(Q)}}})}B(I);I.bind("keyup-change input paste",this.bind(this.updateResults));I.bind("focus",function(){I.addClass("select2-focused")});I.bind("blur",function(){I.removeClass("select2-focused")});this.dropdown.delegate(L,"mouseup",this.bind(function(M){if(j(M.target).closest(".select2-result-selectable").length>0){this.highlightUnderEvent(M);this.selectHighlighted(M)}}));this.dropdown.bind("click mouseup mousedown",function(M){M.stopPropagation()});if(j.isFunction(this.opts.initSelection)){this.initSelection();this.monitorSource()}if(K.element.is(":disabled")||K.element.is("[readonly='readonly']")){this.disable()}},destroy:function(){var H=this.opts.element.data("select2");if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null}if(H!==l){H.container.remove();H.dropdown.remove();H.opts.element.removeClass("select2-offscreen").removeData("select2").unbind(".select2").attr({tabIndex:this.elementTabIndex}).show()}},prepareOpts:function(L){var J,I,H,K;J=L.element;if(J.get(0).tagName.toLowerCase()==="select"){this.select=I=L.element}if(I){j.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in L){throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}})}L=j.extend({},{populateResults:function(M,Q,S){var R,P,U,O,N=this.opts.id,T=this;R=function(ab,V,aa){var ac,X,ah,ae,Y,ag,W,af,ad,Z;ab=L.sortResults(ab,V,S);for(ac=0,X=ab.length;ac<X;ac=ac+1){ah=ab[ac];Y=(ah.disabled===true);ae=(!Y)&&(N(ah)!==l);ag=ah.children&&ah.children.length>0;W=j("<li></li>");W.addClass("select2-results-dept-"+aa);W.addClass("select2-result");W.addClass(ae?"select2-result-selectable":"select2-result-unselectable");if(Y){W.addClass("select2-disabled")}if(ag){W.addClass("select2-result-with-children")}W.addClass(T.opts.formatResultCssClass(ah));af=j(document.createElement("div"));af.addClass("select2-result-label");Z=L.formatResult(ah,af,S,T.opts.escapeMarkup);if(Z!==l){af.html(Z)}W.append(af);if(ag){ad=j("<ul></ul>");ad.addClass("select2-result-sub");R(ah.children,ad,aa+1);W.append(ad)}W.data("select2-data",ah);V.append(W)}};R(Q,M,0)}},j.fn.select2.defaults,L);if(typeof(L.id)!=="function"){H=L.id;L.id=function(M){return M[H]}}if(j.isArray(L.element.data("select2Tags"))){if("tags" in L){throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+L.element.attr("id")}L.tags=L.element.data("select2Tags")}if(I){L.query=this.bind(function(P){var O={results:[],more:false},N=P.term,M,R,Q;Q=function(S,U){var T;if(S.is("option")){if(P.matcher(N,S.text(),S)){U.push({id:S.attr("value"),text:S.text(),element:S.get(),css:S.attr("class"),disabled:q(S.attr("disabled"),"disabled")})}}else{if(S.is("optgroup")){T={text:S.attr("label"),children:[],element:S.get(),css:S.attr("class")};S.children().each2(function(V,W){Q(W,T.children)});if(T.children.length>0){U.push(T)}}}};M=J.children();if(this.getPlaceholder()!==l&&M.length>0){R=M[0];if(j(R).text()===""){M=M.not(R)}}M.each2(function(S,T){Q(T,O.results)});P.callback(O)});L.id=function(M){return M.id};L.formatResultCssClass=function(M){return M.css}}else{if(!("query" in L)){if("ajax" in L){K=L.element.data("ajax-url");if(K&&K.length>0){L.ajax.url=K}L.query=p.call(L.element,L.ajax)}else{if("data" in L){L.query=s(L.data)}else{if("tags" in L){L.query=o(L.tags);if(L.createSearchChoice===l){L.createSearchChoice=function(M){return{id:M,text:M}}}if(L.initSelection===l){L.initSelection=function(M,O){var N=[];j(m(M.val(),L.separator)).each(function(){var R=this,Q=this,P=L.tags;if(j.isFunction(P)){P=P()}j(P).each(function(){if(q(this.id,R)){Q=this.text;return false}});N.push({id:R,text:Q})});O(N)}}}}}}}if(typeof(L.query)!=="function"){throw"query function not defined for Select2 "+L.element.attr("id")}return L},monitorSource:function(){var H=this.opts.element,I;H.bind("change.select2",this.bind(function(J){if(this.opts.element.data("select2-change-triggered")!==true){this.initSelection()}}));I=this.bind(function(){var L,K,J=this;L=this.opts.element.attr("disabled")!=="disabled";K=this.opts.element.attr("readonly")==="readonly";L=L&&!K;if(this.enabled!==L){if(L){this.enable()}else{this.disable()}}y(this.container,this.opts.element,this.opts.adaptContainerCssClass);this.container.addClass(t(this.opts.containerCssClass));y(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass);this.dropdown.addClass(t(this.opts.dropdownCssClass))});H.bind("propertychange.select2 DOMAttrModified.select2",I);if(typeof WebKitMutationObserver!=="undefined"){if(this.propertyObserver){delete this.propertyObserver;this.propertyObserver=null}this.propertyObserver=new WebKitMutationObserver(function(J){J.forEach(I)});this.propertyObserver.observe(H.get(0),{attributes:true,subtree:false})}},triggerChange:function(H){H=H||{};H=j.extend({},H,{type:"change",val:this.val()});this.opts.element.data("select2-change-triggered",true);this.opts.element.trigger(H);this.opts.element.data("select2-change-triggered",false);this.opts.element.click();if(this.opts.blurOnChange){this.opts.element.blur()}},enable:function(){if(this.enabled){return}this.enabled=true;this.container.removeClass("select2-container-disabled");this.opts.element.removeAttr("disabled")},disable:function(){if(!this.enabled){return}this.close();this.enabled=false;this.container.addClass("select2-container-disabled");this.opts.element.attr("disabled","disabled")},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var N=this.container.offset(),W=this.container.outerHeight(false),I=this.container.outerWidth(false),M=this.dropdown.outerHeight(false),P=j(window).scrollLeft()+j(window).width(),S=j(window).scrollTop()+j(window).height(),H=N.top+W,V=N.left,T=H+M<=S,R=(N.top-M)>=this.body().scrollTop(),J=this.dropdown.outerWidth(false),K=V+J<=P,L=this.dropdown.hasClass("select2-drop-above"),O,U,Q;if(this.body().css("position")!=="static"){O=this.body().offset();H-=O.top;V-=O.left}if(L){U=true;if(!R&&T){U=false}}else{U=false;if(!T&&R){U=true}}if(!K){V=N.left+I-J}if(U){H=N.top-M;this.container.addClass("select2-drop-above");this.dropdown.addClass("select2-drop-above")}else{this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")}Q=j.extend({top:H,left:V,width:I},t(this.opts.dropdownCss));this.dropdown.css(Q)},shouldOpen:function(){var H;if(this.opened()){return false}H=j.Event("opening");this.opts.element.trigger(H);return !H.isDefaultPrevented()},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above");this.dropdown.removeClass("select2-drop-above")},open:function(){if(!this.shouldOpen()){return false}window.setTimeout(this.bind(this.opening),1);return true},opening:function(){var N=this.containerId,H="scroll."+N,L="resize."+N,K="orientationchange."+N,I;this.clearDropdownAlignmentPreference();this.container.addClass("select2-dropdown-open").addClass("select2-container-active");if(this.dropdown[0]!==this.body().children().last()[0]){this.dropdown.detach().appendTo(this.body())}this.updateResults(true);I=j("#select2-drop-mask");if(I.length==0){I=j(document.createElement("div"));I.attr("id","select2-drop-mask").attr("class","select2-drop-mask");I.hide();I.appendTo(this.body());I.bind("mousedown touchstart",function(P){var Q=j("#select2-drop"),O;if(Q.length>0){O=Q.data("select2");if(O.opts.selectOnBlur){O.selectHighlighted({noFocus:true})}O.close()}})}if(this.dropdown.prev()[0]!==I[0]){this.dropdown.before(I)}j("#select2-drop").removeAttr("id");this.dropdown.attr("id","select2-drop");I.css(J());I.show();this.dropdown.show();this.positionDropdown();this.dropdown.addClass("select2-drop-active");this.ensureHighlightVisible();var M=this;this.container.parents().add(window).each(function(){j(this).bind(L+" "+H+" "+K,function(O){j("#select2-drop-mask").css(J());M.positionDropdown()})});this.focusSearch();function J(){return{width:Math.max(document.documentElement.scrollWidth,j(window).width()),height:Math.max(document.documentElement.scrollHeight,j(window).height())}}},close:function(){if(!this.opened()){return}var K=this.containerId,H="scroll."+K,J="resize."+K,I="orientationchange."+K;this.container.parents().add(window).each(function(){j(this).unbind(H).unbind(J).unbind(I)});this.clearDropdownAlignmentPreference();j("#select2-drop-mask").hide();this.dropdown.removeAttr("id");this.dropdown.hide();this.container.removeClass("select2-dropdown-open");this.results.empty();this.clearSearch();this.search.removeClass("select2-active");this.opts.element.trigger(j.Event("close"))},clearSearch:function(){},getMaximumSelectionSize:function(){return t(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var K=this.results,J,H,O,N,L,M,I;H=this.highlight();if(H<0){return}if(H==0){K.scrollTop(0);return}J=this.findHighlightableChoices();O=j(J[H]);N=O.offset().top+O.outerHeight(true);if(H===J.length-1){I=K.find("li.select2-more-results");if(I.length>0){N=I.offset().top+I.outerHeight(true)}}L=K.offset().top+K.outerHeight(true);if(N>L){K.scrollTop(K.scrollTop()+(N-L))}M=O.offset().top-K.offset().top;if(M<0&&O.css("display")!="none"){K.scrollTop(K.scrollTop()+M)}},findHighlightableChoices:function(){var H=this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)");return this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)")},moveHighlight:function(K){var J=this.findHighlightableChoices(),I=this.highlight();while(I>-1&&I<J.length){I+=K;var H=j(J[I]);if(H.hasClass("select2-result-selectable")&&!H.hasClass("select2-disabled")&&!H.hasClass("select2-selected")){this.highlight(I);break}}},highlight:function(I){var K=this.findHighlightableChoices(),H,J;if(arguments.length===0){return b(K.filter(".select2-highlighted")[0],K.get())}if(I>=K.length){I=K.length-1}if(I<0){I=0}this.results.find(".select2-highlighted").removeClass("select2-highlighted");H=j(K[I]);H.addClass("select2-highlighted");this.ensureHighlightVisible();J=H.data("select2-data");if(J){this.opts.element.trigger({type:"highlight",val:this.id(J),choice:J})}},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(I){var H=j(I.target).closest(".select2-result-selectable");if(H.length>0&&!H.is(".select2-highlighted")){var J=this.findHighlightableChoices();this.highlight(J.index(H))}else{if(H.length==0){this.results.find(".select2-highlighted").removeClass("select2-highlighted")}}},loadMoreIfNeeded:function(){var L=this.results,K=L.find("li.select2-more-results"),O,N=-1,M=this.resultsPage+1,H=this,J=this.search.val(),I=this.context;if(K.length===0){return}O=K.offset().top-L.offset().top-L.height();if(O<=this.opts.loadMorePadding){K.addClass("select2-active");this.opts.query({element:this.opts.element,term:J,page:M,context:I,matcher:this.opts.matcher,callback:this.bind(function(P){if(!H.opened()){return}H.opts.populateResults.call(this,L,P.results,{term:J,page:M,context:I});H.postprocessResults(P,false,false);if(P.more===true){K.detach().appendTo(L).text(H.opts.formatLoadMore(M+1));window.setTimeout(function(){H.loadMoreIfNeeded()},10)}else{K.remove()}H.positionDropdown();H.resultsPage=M;H.context=P.context})})}},tokenize:function(){},updateResults:function(P){var S=this.search,N=this.results,H=this.opts,M,R=this,Q,L=S.val(),J=j.data(this.container,"select2-last-term");if(P!==true&&J&&q(L,J)){return}j.data(this.container,"select2-last-term",L);if(P!==true&&(this.showSearchInput===false||!this.opened())){return}function O(){N.scrollTop(0);S.removeClass("select2-active");R.positionDropdown()}function I(T){N.html(T);O()}var K=this.getMaximumSelectionSize();if(K>=1){M=this.data();if(j.isArray(M)&&M.length>=K&&k(H.formatSelectionTooBig,"formatSelectionTooBig")){I("<li class='select2-selection-limit'>"+H.formatSelectionTooBig(K)+"</li>");return}}if(S.val().length<H.minimumInputLength){if(k(H.formatInputTooShort,"formatInputTooShort")){I("<li class='select2-no-results'>"+H.formatInputTooShort(S.val(),H.minimumInputLength)+"</li>")}else{I("")}return}if(H.maximumInputLength&&S.val().length>H.maximumInputLength){if(k(H.formatInputTooLong,"formatInputTooLong")){I("<li class='select2-no-results'>"+H.formatInputTooLong(S.val(),H.maximumInputLength)+"</li>")}else{I("")}return}if(H.formatSearching&&this.findHighlightableChoices().length===0){I("<li class='select2-searching'>"+H.formatSearching()+"</li>")}S.addClass("select2-active");Q=this.tokenize();if(Q!=l&&Q!=null){S.val(Q)}this.resultsPage=1;H.query({element:H.element,term:S.val(),page:this.resultsPage,context:null,matcher:H.matcher,callback:this.bind(function(U){var T;if(!this.opened()){this.search.removeClass("select2-active");return}this.context=(U.context===l)?null:U.context;if(this.opts.createSearchChoice&&S.val()!==""){T=this.opts.createSearchChoice.call(null,S.val(),U.results);if(T!==l&&T!==null&&R.id(T)!==l&&R.id(T)!==null){if(j(U.results).filter(function(){return q(R.id(this),R.id(T))}).length===0){U.results.unshift(T)}}}if(U.results.length===0&&k(H.formatNoMatches,"formatNoMatches")){I("<li class='select2-no-results'>"+H.formatNoMatches(S.val())+"</li>");return}N.empty();R.opts.populateResults.call(this,N,U.results,{term:S.val(),page:this.resultsPage,context:null});if(U.more===true&&k(H.formatLoadMore,"formatLoadMore")){N.append("<li class='select2-more-results'>"+R.opts.escapeMarkup(H.formatLoadMore(this.resultsPage))+"</li>");window.setTimeout(function(){R.loadMoreIfNeeded()},10)}this.postprocessResults(U,P);O();this.opts.element.trigger({type:"loaded",data:U})})})},cancel:function(){this.close()},blur:function(){if(this.opts.selectOnBlur){this.selectHighlighted({noFocus:true})}this.close();this.container.removeClass("select2-container-active");if(this.search[0]===document.activeElement){this.search.blur()}this.clearSearch();this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){r(this.search)},selectHighlighted:function(I){var H=this.highlight(),J=this.results.find(".select2-highlighted"),K=J.closest(".select2-result").data("select2-data");if(K){this.highlight(H);this.onSelect(K,I)}},getPlaceholder:function(){return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder},initContainerWidth:function(){function I(){var M,K,N,L,J;if(this.opts.width==="off"){return null}else{if(this.opts.width==="element"){return this.opts.element.outerWidth(false)===0?"auto":this.opts.element.outerWidth(false)+"px"}else{if(this.opts.width==="copy"||this.opts.width==="resolve"){M=this.opts.element.attr("style");if(M!==l){K=M.split(";");for(L=0,J=K.length;L<J;L=L+1){N=K[L].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/);if(N!==null&&N.length>=1){return N[1]}}}if(this.opts.width==="resolve"){M=this.opts.element.css("width");if(M.indexOf("%")>0){return M}return(this.opts.element.outerWidth(false)===0?"auto":this.opts.element.outerWidth(false)+"px")}return null}else{if(j.isFunction(this.opts.width)){return this.opts.width()}else{return this.opts.width}}}}}var H=I.call(this);if(H!==null){this.container.css("width",H)}}});w=x(e,{createContainer:function(){var H=j(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span></span><abbr class='select2-search-choice-close' style='display:none;'></abbr>","   <div><b></b></div>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop' style='display:none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return H},disable:function(){if(!this.enabled){return}this.parent.disable.apply(this,arguments);this.focusser.attr("disabled","disabled")},enable:function(){if(this.enabled){return}this.parent.enable.apply(this,arguments);this.focusser.removeAttr("disabled")},opening:function(){this.parent.opening.apply(this,arguments);this.focusser.attr("disabled","disabled");this.opts.element.trigger(j.Event("open"))},close:function(){if(!this.opened()){return}this.parent.close.apply(this,arguments);this.focusser.removeAttr("disabled");r(this.focusser)},focus:function(){if(this.opened()){this.close()}else{this.focusser.removeAttr("disabled");this.focusser.focus()}},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments);this.focusser.removeAttr("disabled");this.focusser.focus()},initContainer:function(){var J,I=this.container,K=this.dropdown,H=false;this.showSearch(this.opts.minimumResultsForSearch>=0);this.selection=J=I.find(".select2-choice");this.focusser=I.find(".select2-focusser");this.focusser.attr("id","s2id_autogen"+u());j("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id"));this.search.bind("keydown",this.bind(function(L){if(!this.enabled){return}if(L.which===c.PAGE_UP||L.which===c.PAGE_DOWN){d(L);return}switch(L.which){case c.UP:case c.DOWN:this.moveHighlight((L.which===c.UP)?-1:1);d(L);return;case c.TAB:case c.ENTER:this.selectHighlighted();d(L);return;case c.ESC:this.cancel(L);d(L);return}}));this.search.bind("blur",this.bind(function(L){if(document.activeElement===this.body().get(0)){window.setTimeout(this.bind(function(){this.search.focus()}),0)}}));this.focusser.bind("keydown",this.bind(function(L){if(!this.enabled){return}if(L.which===c.TAB||c.isControl(L)||c.isFunctionKey(L)||L.which===c.ESC){return}if(this.opts.openOnEnter===false&&L.which===c.ENTER){d(L);return}if(L.which==c.DOWN||L.which==c.UP||(L.which==c.ENTER&&this.opts.openOnEnter)){this.open();d(L);return}if(L.which==c.DELETE||L.which==c.BACKSPACE){if(this.opts.allowClear){this.clear()}d(L);return}}));B(this.focusser);this.focusser.bind("keyup-change input",this.bind(function(L){if(this.opened()){return}this.open();if(this.showSearchInput!==false){this.search.val(this.focusser.val())}this.focusser.val("");d(L)}));J.delegate("abbr","mousedown",this.bind(function(L){if(!this.enabled){return}this.clear();F(L);this.close();this.selection.focus()}));J.bind("mousedown",this.bind(function(L){H=true;if(this.opened()){this.close()}else{if(this.enabled){this.open()}}d(L);H=false}));K.bind("mousedown",this.bind(function(){this.search.focus()}));J.bind("focus",this.bind(function(L){d(L)}));this.focusser.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")})).bind("blur",this.bind(function(){if(!this.opened()){this.container.removeClass("select2-container-active")}}));this.search.bind("focus",this.bind(function(){this.container.addClass("select2-container-active")}));this.initContainerWidth();this.setPlaceholder()},clear:function(H){var I=this.selection.data("select2-data");if(I){this.opts.element.val("");this.selection.find("span").empty();this.selection.removeData("select2-data");this.setPlaceholder();if(H!==false){this.opts.element.trigger({type:"removed",val:this.id(I),choice:I});this.triggerChange({removed:I})}}},initSelection:function(){var I;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.close();this.setPlaceholder()}else{var H=this;this.opts.initSelection.call(null,this.opts.element,function(J){if(J!==l&&J!==null){H.updateSelection(J);H.close();H.setPlaceholder()}})}},prepareOpts:function(){var H=this.parent.prepareOpts.apply(this,arguments);if(H.element.get(0).tagName.toLowerCase()==="select"){H.initSelection=function(I,K){var J=I.find(":selected");if(j.isFunction(K)){K({id:J.attr("value"),text:J.text(),element:J})}}}else{if("data" in H){H.initSelection=H.initSelection||function(J,L){var K=J.val();var I=null;H.query({matcher:function(M,P,N){var O=q(K,H.id(N));if(O){I=N}return O},callback:!j.isFunction(L)?j.noop:function(){L(I)}})}}}return H},getPlaceholder:function(){if(this.select){if(this.select.find("option").first().text()!==""){return l}}return this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var H=this.getPlaceholder();if(this.opts.element.val()===""&&H!==l){if(this.select&&this.select.find("option:first").text()!==""){return}this.selection.find("span").html(this.opts.escapeMarkup(H));this.selection.addClass("select2-default");this.selection.find("abbr").hide()}},postprocessResults:function(M,I,L){var K=0,H=this,N=true;this.findHighlightableChoices().each2(function(O,P){if(q(H.id(P.data("select2-data")),H.opts.element.val())){K=O;return false}});if(L!==false){this.highlight(K)}if(I===true){var J=this.opts.minimumResultsForSearch;N=J<0?false:h(M.results)>=J;this.showSearch(N)}},showSearch:function(H){this.showSearchInput=H;this.dropdown.find(".select2-search")[H?"removeClass":"addClass"]("select2-search-hidden");j(this.dropdown,this.container)[H?"addClass":"removeClass"]("select2-with-searchbox")},onSelect:function(J,I){var H=this.opts.element.val();this.opts.element.val(this.id(J));this.updateSelection(J);this.opts.element.trigger({type:"selected",val:this.id(J),choice:J});this.close();if(!I||!I.noFocus){this.selection.focus()}if(!q(H,this.id(J))){this.triggerChange()}},updateSelection:function(J){var H=this.selection.find("span"),I;this.selection.data("select2-data",J);H.empty();I=this.opts.formatSelection(J,H);if(I!==l){H.append(this.opts.escapeMarkup(I))}this.selection.removeClass("select2-default");if(this.opts.allowClear&&this.getPlaceholder()!==l){this.selection.find("abbr").show()}},val:function(){var K,I=false,J=null,H=this;if(arguments.length===0){return this.opts.element.val()}K=arguments[0];if(arguments.length>1){I=arguments[1]}if(this.select){this.select.val(K).find(":selected").each2(function(L,M){J={id:M.attr("value"),text:M.text(),element:M.get(0)};return false});this.updateSelection(J);this.setPlaceholder();if(I){this.triggerChange()}}else{if(this.opts.initSelection===l){throw new Error("cannot call val() if initSelection() is not defined")}if(!K&&K!==0){this.clear(I);if(I){this.triggerChange()}return}this.opts.element.val(K);this.opts.initSelection(this.opts.element,function(L){H.opts.element.val(!L?"":H.id(L));H.updateSelection(L);H.setPlaceholder();if(I){H.triggerChange()}})}},clearSearch:function(){this.search.val("");this.focusser.val("")},data:function(I){var H;if(arguments.length===0){H=this.selection.data("select2-data");if(H==l){H=null}return H}else{if(!I||I===""){this.clear()}else{this.opts.element.val(!I?"":this.id(I));this.updateSelection(I)}}}});G=x(e,{createContainer:function(){var H=j(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["    <ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi' style='display:none;'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return H},prepareOpts:function(){var H=this.parent.prepareOpts.apply(this,arguments);if(H.element.get(0).tagName.toLowerCase()==="select"){H.initSelection=function(I,K){var J=[];I.find(":selected").each2(function(L,M){J.push({id:M.attr("value"),text:M.text(),element:M[0]})});K(J)}}else{if("data" in H){H.initSelection=H.initSelection||function(I,L){var J=m(I.val(),H.separator);var K=[];H.query({matcher:function(M,P,N){var O=j.grep(J,function(Q){return q(Q,H.id(N))}).length;if(O){K.push(N)}return O},callback:!j.isFunction(L)?j.noop:function(){L(K)}})}}}return H},initContainer:function(){var H=".select2-choices",I;this.searchContainer=this.container.find(".select2-search-field");this.selection=I=this.container.find(H);this.search.attr("id","s2id_autogen"+u());j("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id"));this.search.bind("input paste",this.bind(function(){if(!this.enabled){return}if(!this.opened()){this.open()}}));this.search.bind("keydown",this.bind(function(K){if(!this.enabled){return}if(K.which===c.BACKSPACE&&this.search.val()===""){this.close();var L,J=I.find(".select2-search-choice-focus");if(J.length>0){this.unselect(J.first());this.search.width(10);d(K);return}L=I.find(".select2-search-choice:not(.select2-locked)");if(L.length>0){L.last().addClass("select2-search-choice-focus")}}else{I.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")}if(this.opened()){switch(K.which){case c.UP:case c.DOWN:this.moveHighlight((K.which===c.UP)?-1:1);d(K);return;case c.ENTER:case c.TAB:this.selectHighlighted();d(K);return;case c.ESC:this.cancel(K);d(K);return}}if(K.which===c.TAB||c.isControl(K)||c.isFunctionKey(K)||K.which===c.BACKSPACE||K.which===c.ESC){return}if(K.which===c.ENTER){if(this.opts.openOnEnter===false){return}else{if(K.altKey||K.ctrlKey||K.shiftKey||K.metaKey){return}}}this.open();if(K.which===c.PAGE_UP||K.which===c.PAGE_DOWN){d(K)}if(K.which===c.ENTER){d(K)}}));this.search.bind("keyup",this.bind(this.resizeSearch));this.search.bind("blur",this.bind(function(J){this.container.removeClass("select2-container-active");this.search.removeClass("select2-focused");if(!this.opened()){this.clearSearch()}J.stopImmediatePropagation()}));this.container.delegate(H,"mousedown",this.bind(function(J){if(!this.enabled){return}if(j(J.target).closest(".select2-search-choice").length>0){return}this.clearPlaceholder();this.open();this.focusSearch();J.preventDefault()}));this.container.delegate(H,"focus",this.bind(function(){if(!this.enabled){return}this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active");this.clearPlaceholder()}));this.initContainerWidth();this.clearSearch()},enable:function(){if(this.enabled){return}this.parent.enable.apply(this,arguments);this.search.removeAttr("disabled")},disable:function(){if(!this.enabled){return}this.parent.disable.apply(this,arguments);this.search.attr("disabled",true)},initSelection:function(){var I;if(this.opts.element.val()===""&&this.opts.element.text()===""){this.updateSelection([]);this.close();this.clearSearch()}if(this.select||this.opts.element.val()!==""){var H=this;this.opts.initSelection.call(null,this.opts.element,function(J){if(J!==l&&J!==null){H.updateSelection(J);H.close();H.clearSearch()}})}},clearSearch:function(){var H=this.getPlaceholder();if(H!==l&&this.getVal().length===0&&this.search.hasClass("select2-focused")===false){this.search.val(H).addClass("select2-default");this.search.width(this.getMaxSearchWidth())}else{this.search.val("").width(10)}},clearPlaceholder:function(){if(this.search.hasClass("select2-default")){this.search.val("").removeClass("select2-default")}},opening:function(){this.clearPlaceholder();this.resizeSearch();this.parent.opening.apply(this,arguments);this.focusSearch();this.opts.element.trigger(j.Event("open"))},close:function(){if(!this.opened()){return}this.parent.close.apply(this,arguments)},focus:function(){this.close();this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(K){var J=[],I=[],H=this;j(K).each(function(){if(b(H.id(this),J)<0){J.push(H.id(this));I.push(this)}});K=I;this.selection.find(".select2-search-choice").remove();j(K).each(function(){H.addSelectedChoice(this)});H.postprocessResults()},tokenize:function(){var H=this.search.val();H=this.opts.tokenizer(H,this.data(),this.bind(this.onSelect),this.opts);if(H!=null&&H!=l){this.search.val(H);if(H.length>0){this.open()}}},onSelect:function(I,H){this.addSelectedChoice(I);this.opts.element.trigger({type:"selected",val:this.id(I),choice:I});if(this.select||!this.opts.closeOnSelect){this.postprocessResults()}if(this.opts.closeOnSelect){this.close();this.search.width(10)}else{if(this.countSelectableResults()>0){this.search.width(10);this.resizeSearch();if(this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()){this.updateResults(true)}this.positionDropdown()}else{this.close();this.search.width(10)}}this.triggerChange({added:I});if(!H||!H.noFocus){this.focusSearch()}},cancel:function(){this.close();this.focusSearch()},addSelectedChoice:function(K){var I=!K.locked,O=j("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),N=j("<li class='select2-search-choice select2-locked'><div></div></li>");var H=I?O:N,M=this.id(K),L=this.getVal(),J;J=this.opts.formatSelection(K,H.find("div"));if(J!=l){H.find("div").replaceWith("<div>"+this.opts.escapeMarkup(J)+"</div>")}if(I){H.find(".select2-search-choice-close").bind("mousedown",d).bind("click dblclick",this.bind(function(P){if(!this.enabled){return}j(P.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(j(P.target));this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus");this.close();this.focusSearch()})).dequeue();d(P)})).bind("focus",this.bind(function(){if(!this.enabled){return}this.container.addClass("select2-container-active");this.dropdown.addClass("select2-drop-active")}))}H.data("select2-data",K);H.insertBefore(this.searchContainer);L.push(M);this.setVal(L)},unselect:function(I){var K=this.getVal(),J,H;I=I.closest(".select2-search-choice");if(I.length===0){throw"Invalid argument: "+I+". Must be .select2-search-choice"}J=I.data("select2-data");if(!J){return}H=b(this.id(J),K);if(H>=0){K.splice(H,1);this.setVal(K);if(this.select){this.postprocessResults()}}I.remove();this.opts.element.trigger({type:"removed",val:this.id(J),choice:J});this.triggerChange({removed:J})},postprocessResults:function(){var J=this.getVal(),K=this.results.find(".select2-result"),I=this.results.find(".select2-result-with-children"),H=this;K.each2(function(M,L){var N=H.id(L.data("select2-data"));if(b(N,J)>=0){L.addClass("select2-selected");L.find(".select2-result-selectable").addClass("select2-selected")}});I.each2(function(M,L){if(!L.is(".select2-result-selectable")&&L.find(".select2-result-selectable:not(.select2-selected)").length===0){L.addClass("select2-selected")}});if(this.highlight()==-1){H.highlight(0)}},getMaxSearchWidth:function(){return this.selection.width()-n(this.search)},resizeSearch:function(){var M,K,J,H,I,L=n(this.search);M=z(this.search)+10;K=this.search.offset().left;J=this.selection.width();H=this.selection.offset().left;I=J-(K-H)-L;if(I<M){I=J-L}if(I<40){I=J-L}if(I<=0){I=M}this.search.width(I)},getVal:function(){var H;if(this.select){H=this.select.val();return H===null?[]:H}else{H=this.opts.element.val();return m(H,this.opts.separator)}},setVal:function(I){var H;if(this.select){this.select.val(I)}else{H=[];j(I).each(function(){if(b(this,H)<0){H.push(this)}});this.opts.element.val(H.length===0?"":H.join(this.opts.separator))}},val:function(){var K,I=false,J=[],H=this;if(arguments.length===0){return this.getVal()}K=arguments[0];if(arguments.length>1){I=arguments[1]}if(!K&&K!==0){this.opts.element.val("");this.updateSelection([]);this.clearSearch();if(I){this.triggerChange()}return}this.setVal(K);if(this.select){this.opts.initSelection(this.select,this.bind(this.updateSelection));if(I){this.triggerChange()}}else{if(this.opts.initSelection===l){throw new Error("val() cannot be called if initSelection() is not defined")}this.opts.initSelection(this.opts.element,function(M){var L=j(M).map(H.id);H.setVal(L);H.updateSelection(M);H.clearSearch();if(I){H.triggerChange()}})}this.clearSearch()},onSortStart:function(){if(this.select){throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.")}this.search.width(0);this.searchContainer.hide()},onSortEnd:function(){var I=[],H=this;this.searchContainer.show();this.searchContainer.appendTo(this.searchContainer.parent());this.resizeSearch();this.selection.find(".select2-search-choice").each(function(){I.push(H.opts.id(j(this).data("select2-data")))});this.setVal(I);this.triggerChange()},data:function(I){var H=this,J;if(arguments.length===0){return this.selection.find(".select2-search-choice").map(function(){return j(this).data("select2-data")}).get()}else{if(!I){I=[]}J=j.map(I,function(K){return H.opts.id(K)});this.setVal(J);this.updateSelection(I);this.clearSearch()}}});j.fn.select2=function(){var K=Array.prototype.slice.call(arguments,0),L,J,M,I,H=["val","destroy","opened","open","close","focus","isFocused","container","onSortStart","onSortEnd","enable","disable","positionDropdown","data"];this.each(function(){if(K.length===0||typeof(K[0])==="object"){L=K.length===0?{}:j.extend({},K[0]);L.element=j(this);if(L.element.get(0).tagName.toLowerCase()==="select"){I=L.element.attr("multiple")}else{I=L.multiple||false;if("tags" in L){L.multiple=I=true}}J=I?new G():new w();J.init(L)}else{if(typeof(K[0])==="string"){if(b(K[0],H)<0){throw"Unknown method: "+K[0]}M=l;J=j(this).data("select2");if(J===l){return}if(K[0]==="container"){M=J.container}else{M=J[K[0]].apply(J,K.slice(1))}if(M!==l){return false}}else{throw"Invalid arguments to select2 plugin: "+K}}});return(M===l)?this:M};j.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:true,openOnEnter:true,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(I,J,L,H){var K=[];i(I.text,L.term,K,H);return K.join("")},formatSelection:function(I,H){return I?I.text:l},sortResults:function(I,H,J){return I},formatResultCssClass:function(H){return l},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(H,I){var J=I-H.length;return"Please enter "+J+" more character"+(J==1?"":"s")},formatInputTooLong:function(I,H){var J=I.length-H;return"Please delete "+J+" character"+(J==1?"":"s")},formatSelectionTooBig:function(H){return"You can only select "+H+" item"+(H==1?"":"s")},formatLoadMore:function(H){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(H){return H.id},matcher:function(H,I){return(""+I).toUpperCase().indexOf((""+H).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:A,escapeMarkup:function(H){var I={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","/":"&#47;"};return String(H).replace(/[&<>"'\/\\]/g,function(J){return I[J[0]]})},blurOnChange:false,selectOnBlur:false,adaptContainerCssClass:function(H){return H},adaptDropdownCssClass:function(H){return null}};window.Select2={query:{ajax:p,local:s,tags:o},util:{debounce:g,markMatch:i},"class":{"abstract":e,single:w,multi:G}}}(jQuery));(function(e,d,f){var g=e();e.fn.dropdownHover=function(h){g=g.add(this.parent());return this.each(function(){var n=e(this).parent(),m={delay:500,instantlyCloseOthers:true},l={delay:e(this).data("delay"),instantlyCloseOthers:e(this).data("close-others")},j=e.extend(true,{},m,h,l),k,i;n.hover(function(){if(b()){if(j.instantlyCloseOthers===true){g.removeClass("open")}d.clearTimeout(k);e(this).addClass("open")}},function(){if(b()){k=d.setTimeout(function(){n.removeClass("open")},j.delay)}});n.find(".dropdown-submenu").hover(function(){if(b()){d.clearTimeout(i)}e(this).children(".dropdown-menu").show()},function(){var o=e(this).children(".dropdown-menu");if(b()){i=d.setTimeout(function(){o.hide()},j.delay)}else{o.hide()}})})};var b=function(){return !!e("#cwspear-is-awesome").height()};e(document).ready(function(){e('[data-hover="dropdown"]').dropdownHover();e('<div class="nav-collapse collapse" style="visibility:hidden;position:fixed" id="cwspear-is-awesome">.</div>').appendTo("body")});var a=".dropdown-submenu:hover>.dropdown-menu{display:none}";var c=document.createElement("style");c.type="text/css";if(c.styleSheet){c.styleSheet.cssText=a}else{c.appendChild(document.createTextNode(a))}e("head")[0].appendChild(c)})(jQuery,this);